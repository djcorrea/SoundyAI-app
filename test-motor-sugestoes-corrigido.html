<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Teste - Motor de Sugest√µes Corrigido</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
            color: #333;
        }
        
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
        }
        
        .section-title {
            color: #667eea;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px 5px;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .result-box {
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid;
        }
        
        .result-box.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .result-box.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .result-box.info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        
        .suggestion-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid;
            transition: transform 0.2s;
        }
        
        .suggestion-item:hover {
            transform: translateX(5px);
        }
        
        .suggestion-item.critical { border-left-color: #dc3545; }
        .suggestion-item.warning { border-left-color: #ffc107; }
        .suggestion-item.ok { border-left-color: #28a745; }
        .suggestion-item.info { border-left-color: #17a2b8; }
        
        .suggestion-header {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .suggestion-details {
            font-size: 0.9em;
            color: #6c757d;
            line-height: 1.4;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            color: #6c757d;
            margin-top: 5px;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            margin: 0 4px;
        }
        
        .badge.critical { background: #dc3545; color: white; }
        .badge.warning { background: #ffc107; color: black; }
        .badge.ok { background: #28a745; color: white; }
        .badge.info { background: #17a2b8; color: white; }
        
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>üîß Teste - Motor de Sugest√µes Corrigido</h1>
        <p>Valida√ß√£o completa da corre√ß√£o que converte TODAS as m√©tricas em sugest√µes estruturadas</p>
    </div>
    
    <div class="highlight">
        <strong>üéØ OBJETIVO:</strong> Garantir que TODAS as m√©tricas do <code>referenceComparison</code> e <code>spectralBands</code> 
        sejam convertidas em sugest√µes no padr√£o <code>diagnostics.suggestions</code>, e que <code>analysis.suggestions</code> 
        <strong>NUNCA</strong> seja <code>undefined</code>.
    </div>
    
    <div class="test-section">
        <div class="section-title">
            üß™ Cen√°rios de Teste
        </div>
        
        <button class="test-button" onclick="testCompleteConversion()">
            üîÑ Teste: Convers√£o Completa
        </button>
        
        <button class="test-button" onclick="testUndefinedPrevention()">
            üö® Teste: Preven√ß√£o de Undefined
        </button>
        
        <button class="test-button" onclick="testSpectralBandsMapping()">
            üéµ Teste: Mapeamento Spectral Bands
        </button>
        
        <button class="test-button" onclick="testAllScenarios()">
            üöÄ Executar Todos os Testes
        </button>
    </div>
    
    <div class="test-section">
        <div class="section-title">
            üìä Dados de Teste (Simulando Backend Real)
        </div>
        <div class="code-block" id="testData"></div>
    </div>
    
    <div class="test-section">
        <div class="section-title">
            üîç Resultados dos Testes
        </div>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <div class="section-title">
            üìã Sugest√µes Geradas
        </div>
        <div id="suggestionsDisplay"></div>
    </div>
    
    <script>
        // üß™ DADOS DE TESTE - Simulando exatamente o que vem do backend
        const mockBackendData = {
            // Dados que v√™m do referenceComparison (j√° implementados)
            referenceComparison: [
                {
                    metric: "Volume Integrado (padr√£o streaming)",
                    value: -6.2,
                    ideal: -8.0,
                    unit: "LUFS",
                    status: "‚ö†Ô∏è AJUSTAR",
                    category: "loudness"
                },
                {
                    metric: "pico real (dbtp)",
                    value: -0.8,
                    ideal: -1.0,
                    unit: "dBTP",
                    status: "‚ö†Ô∏è AJUSTAR",
                    category: "peak"
                },
                {
                    metric: "Din√¢mica (diferen√ßa entre alto/baixo)",
                    value: 7.1,
                    ideal: 8.0,
                    unit: "LU",
                    status: "‚úÖ IDEAL",
                    category: "dynamics"
                }
            ],
            
            // Dados de spectralBands que devem ser mapeados
            spectralBands: {
                sub: { 
                    energy_db: -12.0, 
                    percentage: 8.5, 
                    range: "20-60Hz", 
                    status: "calculated" 
                },
                bass: { 
                    energy_db: -14.5, 
                    percentage: 12.8, 
                    range: "60-150Hz", 
                    status: "calculated" 
                },
                lowMid: { 
                    energy_db: -16.2, 
                    percentage: 15.4, 
                    range: "150-500Hz", 
                    status: "calculated" 
                },
                mid: { 
                    energy_db: -11.8, 
                    percentage: 22.1, 
                    range: "500-2000Hz", 
                    status: "calculated" 
                },
                highMid: { 
                    energy_db: -13.4, 
                    percentage: 18.6, 
                    range: "2000-5000Hz", 
                    status: "calculated" 
                },
                presence: { 
                    energy_db: -16.8, 
                    percentage: 14.2, 
                    range: "5000-10000Hz", 
                    status: "calculated" 
                },
                air: { 
                    energy_db: -20.1, 
                    percentage: 8.4, 
                    range: "10000-20000Hz", 
                    status: "calculated" 
                }
            },
            
            // Outras estruturas do backend
            technicalData: {
                lufsIntegrated: -6.2,
                truePeakDbtp: -0.8,
                dynamicRange: 7.1,
                stereoCorrelation: 0.85
            },
            
            // Sugest√µes existentes (se houver)
            suggestions: [],
            
            // Metadados
            duration: 180.5,
            sampleRate: 48000,
            channels: 2
        };
        
        // Mostrar dados de teste
        document.getElementById('testData').textContent = JSON.stringify(mockBackendData, null, 2);
        
        // üîß IMPLEMENTA√á√ÉO DA FUN√á√ÉO DE NORMALIZA√á√ÉO (C√≥pia da implementa√ß√£o real)
        function normalizeBackendAnalysisDataTEST(backendData) {
            console.log('üîß [TEST-NORMALIZE] Iniciando normaliza√ß√£o dos dados do backend:', backendData);
            
            // Criar estrutura normalizada
            const normalized = {
                ...backendData,
                technicalData: backendData.technicalData || {},
                problems: backendData.problems || [],
                suggestions: backendData.suggestions || [],
                duration: backendData.duration || null,
                sampleRate: backendData.sampleRate || null,
                channels: backendData.channels || null
            };
            
            console.log('üéØ [TEST-NORMALIZE] Sugest√µes iniciais:', normalized.suggestions.length);
            
            // üéØ MAPEAR referenceComparison para sugest√µes
            if (backendData.referenceComparison && Array.isArray(backendData.referenceComparison)) {
                console.log('üéØ [REFERENCE-MAPPING] Iniciando mapeamento de referenceComparison...');
                
                const mapStatusToSeverity = (status) => {
                    if (status.includes('‚ùå CORRIGIR')) return 'critical';
                    if (status.includes('‚ö†Ô∏è AJUSTAR')) return 'warning';
                    if (status.includes('‚úÖ IDEAL')) return 'ok';
                    return 'info';
                };
                
                let mappedCount = 0;
                backendData.referenceComparison.forEach((refItem, index) => {
                    if (refItem && typeof refItem === 'object' && refItem.metric && refItem.status) {
                        const severity = mapStatusToSeverity(refItem.status);
                        const delta = refItem.value - refItem.ideal;
                        const absDiff = Math.abs(delta);
                        
                        const suggestion = {
                            icon: severity === 'critical' ? 'üî¥' : severity === 'warning' ? 'üü†' : 'üü¢',
                            type: 'metric_adjust',
                            severity,
                            priority: severity === 'critical' ? 4 : severity === 'warning' ? 3 : 1,
                            metric: refItem.metric,
                            message: `${refItem.metric}: ${refItem.value}${refItem.unit || ''}`,
                            action: `Ajustar ${refItem.metric} em ${absDiff.toFixed(1)}${refItem.unit || ''}`,
                            explanation: `${refItem.metric} est√° ${severity === 'ok' ? 'ideal' : 'fora do ideal'} (${refItem.value}${refItem.unit} vs ${refItem.ideal}${refItem.unit})`,
                            currentValue: `${refItem.value}${refItem.unit || ''}`,
                            targetValue: `${refItem.ideal}${refItem.unit || ''}`,
                            delta: `${delta > 0 ? '+' : ''}${delta.toFixed(1)}${refItem.unit || ''}`,
                            category: refItem.category || 'reference_comparison',
                            source: 'reference_comparison'
                        };
                        
                        normalized.suggestions.push(suggestion);
                        mappedCount++;
                    }
                });
                
                console.log(`üéØ [REFERENCE-MAPPING] Mapeadas ${mappedCount} m√©tricas de referenceComparison`);
            }
            
            // üéµ MAPEAR spectralBands para sugest√µes
            if (backendData.spectralBands && typeof backendData.spectralBands === 'object') {
                console.log('üéµ [SPECTRAL-MAPPING] Iniciando mapeamento de spectralBands...');
                
                const bandConfigs = {
                    sub: { name: 'Sub (20-60Hz)', idealMin: -20, idealMax: -15 },
                    bass: { name: 'Bass (60-150Hz)', idealMin: -18, idealMax: -14 },
                    lowMid: { name: 'Low Mid (150-500Hz)', idealMin: -16, idealMax: -12 },
                    mid: { name: 'Mid (500-2kHz)', idealMin: -14, idealMax: -10 },
                    highMid: { name: 'High Mid (2-5kHz)', idealMin: -16, idealMax: -12 },
                    presence: { name: 'Presence (5-10kHz)', idealMin: -18, idealMax: -14 },
                    air: { name: 'Air (10-20kHz)', idealMin: -22, idealMax: -18 }
                };
                
                let spectralMappedCount = 0;
                Object.entries(bandConfigs).forEach(([bandKey, config]) => {
                    const bandData = backendData.spectralBands[bandKey];
                    
                    if (bandData && bandData.status === 'calculated' && Number.isFinite(bandData.energy_db)) {
                        const value = bandData.energy_db;
                        const idealValue = (config.idealMin + config.idealMax) / 2;
                        const tolerance = Math.abs(config.idealMax - config.idealMin) / 2;
                        
                        let status;
                        if (value < config.idealMin - tolerance || value > config.idealMax + tolerance) {
                            status = '‚ùå CORRIGIR';
                        } else if (value < config.idealMin || value > config.idealMax) {
                            status = '‚ö†Ô∏è AJUSTAR';
                        } else {
                            status = '‚úÖ IDEAL';
                        }
                        
                        const severity = status.includes('‚ùå') ? 'critical' : status.includes('‚ö†Ô∏è') ? 'warning' : 'ok';
                        const delta = value - idealValue;
                        
                        const bandSuggestion = {
                            icon: severity === 'critical' ? 'üî¥' : severity === 'warning' ? 'üü†' : 'üü¢',
                            type: 'band_adjust',
                            severity,
                            priority: severity === 'critical' ? 4 : severity === 'warning' ? 3 : 1,
                            metric: config.name,
                            message: `${config.name}: ${value.toFixed(1)}dB`,
                            action: severity === 'ok' ? `Manter ${config.name} no n√≠vel atual` : `Ajustar ${config.name} em ${Math.abs(delta).toFixed(1)}dB`,
                            explanation: `${config.name} est√° ${severity === 'ok' ? 'bem balanceada' : 'fora do ideal'} (${value.toFixed(1)}dB vs ideal ${idealValue.toFixed(1)}dB)`,
                            currentValue: `${value.toFixed(1)}dB`,
                            targetValue: `${idealValue.toFixed(1)}dB`,
                            delta: `${delta > 0 ? '+' : ''}${delta.toFixed(1)}dB`,
                            category: 'spectral_bands',
                            bandName: bandKey,
                            bandRange: bandData.range,
                            source: 'spectral_bands'
                        };
                        
                        normalized.suggestions.push(bandSuggestion);
                        spectralMappedCount++;
                    }
                });
                
                console.log(`üéµ [SPECTRAL-MAPPING] Mapeadas ${spectralMappedCount} bandas espectrais`);
            }
            
            // üö® VALIDA√á√ÉO FINAL: Garantir que suggestions nunca seja undefined
            if (!Array.isArray(normalized.suggestions)) {
                console.log('üö® [EMERGENCY-FIX] suggestions n√£o √© array v√°lido, criando array vazio');
                normalized.suggestions = [];
            }
            
            // Garantir diagnostics.suggestions
            if (!normalized.diagnostics) {
                normalized.diagnostics = {};
            }
            if (!Array.isArray(normalized.diagnostics.suggestions)) {
                normalized.diagnostics.suggestions = [...normalized.suggestions];
                console.log('üö® [EMERGENCY-FIX] Criando diagnostics.suggestions');
            }
            
            console.log('‚úÖ [TEST-NORMALIZE] Normaliza√ß√£o conclu√≠da:', {
                suggestionsCount: normalized.suggestions.length,
                diagnosticsSuggestionsCount: normalized.diagnostics.suggestions.length
            });
            
            return normalized;
        }
        
        // üß™ FUN√á√ÉO DE TESTE: Convers√£o Completa
        function testCompleteConversion() {
            const resultsDiv = document.getElementById('testResults');
            
            try {
                console.log('üß™ [TEST] Iniciando teste de convers√£o completa...');
                
                const normalizedData = normalizeBackendAnalysisDataTEST(mockBackendData);
                
                const refCount = mockBackendData.referenceComparison.length;
                const spectralCount = Object.keys(mockBackendData.spectralBands).length;
                const totalExpected = refCount + spectralCount;
                const actualSuggestions = normalizedData.suggestions.length;
                
                const success = actualSuggestions >= totalExpected;
                
                resultsDiv.innerHTML += `
                    <div class="result-box ${success ? 'success' : 'error'}">
                        <h4>${success ? '‚úÖ' : '‚ùå'} Teste: Convers√£o Completa</h4>
                        <p><strong>M√©tricas esperadas:</strong> ${totalExpected} (${refCount} ref + ${spectralCount} bandas)</p>
                        <p><strong>Sugest√µes geradas:</strong> ${actualSuggestions}</p>
                        <p><strong>Taxa de convers√£o:</strong> ${((actualSuggestions / totalExpected) * 100).toFixed(1)}%</p>
                        <p><strong>Status:</strong> ${success ? 'TODAS as m√©tricas foram convertidas!' : 'Algumas m√©tricas n√£o foram convertidas'}</p>
                    </div>
                `;
                
                displaySuggestions(normalizedData.suggestions);
                
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result-box error">
                        <h4>‚ùå Erro no Teste de Convers√£o Completa</h4>
                        <p><strong>Erro:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // üß™ FUN√á√ÉO DE TESTE: Preven√ß√£o de Undefined
        function testUndefinedPrevention() {
            const resultsDiv = document.getElementById('testResults');
            
            try {
                console.log('üß™ [TEST] Iniciando teste de preven√ß√£o de undefined...');
                
                // Testar com dados incompletos
                const incompleteData = {
                    technicalData: {},
                    // Sem suggestions, referenceComparison ou spectralBands
                };
                
                const normalizedData = normalizeBackendAnalysisDataTEST(incompleteData);
                
                const hasSuggestions = Array.isArray(normalizedData.suggestions);
                const hasDiagnostics = Array.isArray(normalizedData.diagnostics?.suggestions);
                const suggestionsNotUndefined = normalizedData.suggestions !== undefined;
                const diagnosticsNotUndefined = normalizedData.diagnostics?.suggestions !== undefined;
                
                const success = hasSuggestions && hasDiagnostics && suggestionsNotUndefined && diagnosticsNotUndefined;
                
                resultsDiv.innerHTML += `
                    <div class="result-box ${success ? 'success' : 'error'}">
                        <h4>${success ? '‚úÖ' : '‚ùå'} Teste: Preven√ß√£o de Undefined</h4>
                        <p><strong>suggestions √© array:</strong> ${hasSuggestions ? 'Sim' : 'N√£o'}</p>
                        <p><strong>diagnostics.suggestions √© array:</strong> ${hasDiagnostics ? 'Sim' : 'N√£o'}</p>
                        <p><strong>suggestions n√£o √© undefined:</strong> ${suggestionsNotUndefined ? 'Sim' : 'N√£o'}</p>
                        <p><strong>diagnostics.suggestions n√£o √© undefined:</strong> ${diagnosticsNotUndefined ? 'Sim' : 'N√£o'}</p>
                        <p><strong>Status:</strong> ${success ? 'NUNCA undefined - sempre array v√°lido!' : 'Falha na preven√ß√£o de undefined'}</p>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result-box error">
                        <h4>‚ùå Erro no Teste de Preven√ß√£o de Undefined</h4>
                        <p><strong>Erro:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // üß™ FUN√á√ÉO DE TESTE: Mapeamento Spectral Bands
        function testSpectralBandsMapping() {
            const resultsDiv = document.getElementById('testResults');
            
            try {
                console.log('üß™ [TEST] Iniciando teste de mapeamento spectral bands...');
                
                const normalizedData = normalizeBackendAnalysisDataTEST(mockBackendData);
                
                const spectralSuggestions = normalizedData.suggestions.filter(s => s.source === 'spectral_bands');
                const expectedBands = Object.keys(mockBackendData.spectralBands).length;
                const mappedBands = spectralSuggestions.length;
                
                const hasAllBands = mappedBands === expectedBands;
                const hasCorrectStructure = spectralSuggestions.every(s => 
                    s.bandName && s.bandRange && s.currentValue && s.targetValue && s.delta
                );
                
                const success = hasAllBands && hasCorrectStructure;
                
                resultsDiv.innerHTML += `
                    <div class="result-box ${success ? 'success' : 'error'}">
                        <h4>${success ? '‚úÖ' : '‚ùå'} Teste: Mapeamento Spectral Bands</h4>
                        <p><strong>Bandas esperadas:</strong> ${expectedBands}</p>
                        <p><strong>Bandas mapeadas:</strong> ${mappedBands}</p>
                        <p><strong>Estrutura correta:</strong> ${hasCorrectStructure ? 'Sim' : 'N√£o'}</p>
                        <p><strong>Bandas mapeadas:</strong> ${spectralSuggestions.map(s => s.bandName).join(', ')}</p>
                        <p><strong>Status:</strong> ${success ? 'TODAS as bandas espectrais mapeadas!' : 'Falha no mapeamento de bandas'}</p>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result-box error">
                        <h4>‚ùå Erro no Teste de Spectral Bands</h4>
                        <p><strong>Erro:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // üß™ FUN√á√ÉO DE TESTE: Executar Todos
        function testAllScenarios() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h3>üöÄ Executando Todos os Testes...</h3>';
            
            setTimeout(() => testCompleteConversion(), 100);
            setTimeout(() => testUndefinedPrevention(), 200);
            setTimeout(() => testSpectralBandsMapping(), 300);
            
            setTimeout(() => {
                resultsDiv.innerHTML += `
                    <div class="result-box info">
                        <h4>üìä Resumo dos Testes</h4>
                        <p>Todos os testes foram executados. Verifique os resultados acima.</p>
                        <p><strong>Objetivo:</strong> Garantir que TODAS as m√©tricas sejam convertidas e suggestions NUNCA seja undefined.</p>
                    </div>
                `;
            }, 400);
        }
        
        // üìã FUN√á√ÉO PARA EXIBIR SUGEST√ïES
        function displaySuggestions(suggestions) {
            const suggestionsDiv = document.getElementById('suggestionsDisplay');
            
            if (!suggestions || suggestions.length === 0) {
                suggestionsDiv.innerHTML = '<p>Nenhuma sugest√£o encontrada.</p>';
                return;
            }
            
            // Estat√≠sticas
            const severityCounts = {
                critical: suggestions.filter(s => s.severity === 'critical').length,
                warning: suggestions.filter(s => s.severity === 'warning').length,
                ok: suggestions.filter(s => s.severity === 'ok').length,
                info: suggestions.filter(s => s.severity === 'info').length
            };
            
            const sourceCounts = {
                reference_comparison: suggestions.filter(s => s.source === 'reference_comparison').length,
                spectral_bands: suggestions.filter(s => s.source === 'spectral_bands').length
            };
            
            suggestionsDiv.innerHTML = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${suggestions.length}</div>
                        <div class="metric-label">Total de Sugest√µes</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${sourceCounts.reference_comparison}</div>
                        <div class="metric-label">Reference Comparison</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${sourceCounts.spectral_bands}</div>
                        <div class="metric-label">Spectral Bands</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">
                            <span class="badge critical">${severityCounts.critical}</span>
                            <span class="badge warning">${severityCounts.warning}</span>
                            <span class="badge ok">${severityCounts.ok}</span>
                        </div>
                        <div class="metric-label">Por Severidade</div>
                    </div>
                </div>
                
                <h4>üìã Lista Detalhada de Sugest√µes:</h4>
                ${suggestions.map((suggestion, index) => `
                    <div class="suggestion-item ${suggestion.severity}">
                        <div class="suggestion-header">
                            ${suggestion.icon} ${suggestion.message}
                            <span class="badge ${suggestion.severity}">${suggestion.severity.toUpperCase()}</span>
                        </div>
                        <div class="suggestion-details">
                            <p><strong>üîß A√ß√£o:</strong> ${suggestion.action}</p>
                            <p><strong>üí≠ Explica√ß√£o:</strong> ${suggestion.explanation}</p>
                            <p><strong>üìä Valores:</strong> ${suggestion.currentValue} ‚Üí ${suggestion.targetValue} (Œî ${suggestion.delta})</p>
                            <p><strong>üè∑Ô∏è Tipo:</strong> ${suggestion.type} | <strong>üìÇ Categoria:</strong> ${suggestion.category}</p>
                            <p><strong>üìç Origem:</strong> ${suggestion.source}</p>
                            ${suggestion.bandRange ? `<p><strong>üéõÔ∏è Faixa:</strong> ${suggestion.bandRange}</p>` : ''}
                        </div>
                    </div>
                `).join('')}
            `;
        }
        
        // Executar teste inicial
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ [TEST] P√°gina carregada, pronto para testes');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Teste - Tabela SEM Valores Num√©ricos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
        }
        
        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #333;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #555;
        }
        
        th {
            background-color: #444;
            font-weight: 600;
            color: #fff;
        }
        
        /* Classes de status iguais ao sistema */
        .ok { 
            background-color: #d4edda !important; 
            color: #155724 !important; 
            font-weight: 600;
        }
        .yellow { 
            background-color: #fff3cd !important; 
            color: #856404 !important; 
            font-weight: 600;
        }
        .warn { 
            background-color: #f8d7da !important; 
            color: #721c24 !important; 
            font-weight: 600;
        }
        .na { 
            background-color: #f8f9fa !important; 
            color: #6c757d !important; 
        }
        
        .status-info {
            margin: 20px 0;
            padding: 15px;
            background: #444;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .success { color: #4CAF50; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Teste - Tabela SEM Valores Num√©ricos</h1>
        
        <div class="status-info">
            <strong>üéØ OBJETIVO:</strong> A coluna "Diferen√ßa/Status" deve mostrar apenas:
            <ul>
                <li>‚úÖ <strong>Ideal</strong> - quando dentro da toler√¢ncia</li>
                <li>‚ö†Ô∏è <strong>Ajuste leve</strong> - quando 1-2x a toler√¢ncia</li>
                <li>‚ùå <strong>Corrigir</strong> - quando >2x a toler√¢ncia</li>
            </ul>
            <strong>‚ùå N√ÉO DEVE mostrar valores como:</strong> "+1.2dB", "-0.5LUFS", etc.
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="test-button" onclick="testCorrection()">üß™ Testar Corre√ß√£o</button>
            <button class="test-button" onclick="simulateRealData()">üìä Simular Dados Reais</button>
        </div>
        
        <h3>üìä Tabela de Refer√™ncia - Funk Mandela</h3>
        
        <table id="testTable">
            <thead>
                <tr>
                    <th>M√©trica</th>
                    <th>Valor</th>
                    <th>Alvo</th>
                    <th>Diferen√ßa/Status</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Ser√° preenchido via JavaScript -->
            </tbody>
        </table>
        
        <div id="testResults" style="margin-top: 20px; padding: 15px; background: #444; border-radius: 5px;">
            <strong>üìã Resultados:</strong><br>
            Clique em "Testar Corre√ß√£o" para verificar se est√° funcionando...
        </div>
    </div>
    
    <!-- Carregar patch -->
    <script src="patch-tabela-referencia-final.js"></script>
    
    <script>
        // üéØ DADOS DE TESTE baseados na imagem fornecida
        const testData = [
            { label: 'Volume Integrado (padr√£o streaming)', value: -22.08, target: -7.80, tolerance: 1.0, unit: ' LUFS' },
            { label: 'pico real (dBTp)', value: 0.30, target: -1.00, tolerance: 0.5, unit: ' dBTP' },
            { label: 'Din√¢mica (diferen√ßa entre alto/baixo)', value: 5.18, target: 7.80, tolerance: 1.0, unit: ' dB' },
            { label: 'Varia√ß√£o de Volume (consist√™ncia)', value: 2.56, target: 2.50, tolerance: 0.8, unit: ' LU' },
            { label: 'Correla√ß√£o Est√©reo (largura)', value: 0.78, target: 0.85, tolerance: 0.1, unit: '' },
            { label: 'sub (20‚Äì60hz)', value: -22.80, target: -17.30, tolerance: 2.0, unit: ' dB' },
            { label: 'bass (60‚Äì150hz)', value: -20.70, target: -17.70, tolerance: 1.5, unit: ' dB' },
            { label: 'bass (60‚Äì150hz)', value: -20.70, target: -21.50, tolerance: 1.5, unit: ' dB' },
            { label: 'low-mid (150‚Äì500hz)', value: -22.60, target: -18.70, tolerance: 1.5, unit: ' dB' },
            { label: 'mid (500‚Äì2khz)', value: -26.70, target: -17.90, tolerance: 1.5, unit: ' dB' },
            { label: 'high-mid (2‚Äì5khz)', value: -31.40, target: -22.90, tolerance: 2.0, unit: ' dB' }
        ];
        
        /**
         * üé® FUN√á√ÉO PARA CRIAR C√âLULA DE STATUS (igual √† corre√ß√£o)
         */
        function createTestStatusCell(diff, unit, tolerance) {
            if (!Number.isFinite(diff) || !Number.isFinite(tolerance) || tolerance <= 0) {
                return '<td class="na" style="text-align: center;"><span style="opacity: 0.6;">‚Äî</span></td>';
            }
            
            const absDiff = Math.abs(diff);
            let cssClass, statusIcon, statusText;
            
            if (absDiff <= tolerance) {
                cssClass = 'ok';
                statusIcon = '‚úÖ';
                statusText = 'Ideal';
            } else {
                const multiplicador = absDiff / tolerance;
                if (multiplicador <= 2) {
                    cssClass = 'yellow';
                    statusIcon = '‚ö†Ô∏è';
                    statusText = 'Ajuste leve';
                } else {
                    cssClass = 'warn';
                    statusIcon = '‚ùå';
                    statusText = 'Corrigir';
                }
            }
            
            return `<td class="${cssClass}" style="text-align: center; padding: 8px;">
                <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                    <div style="font-size: 16px;">${statusIcon}</div>
                    <div style="font-size: 11px; font-weight: 500; opacity: 0.9;">${statusText}</div>
                </div>
            </td>`;
        }
        
        /**
         * üèóÔ∏è CONSTRUIR TABELA
         */
        function buildTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            for (const row of testData) {
                const diff = row.value - row.target;
                const statusCell = createTestStatusCell(diff, row.unit, row.tolerance);
                
                const tableRow = `
                    <tr>
                        <td style="color: #fff;">${row.label}</td>
                        <td style="color: #fff;">${row.value.toFixed(2)}${row.unit}</td>
                        <td style="color: #fff;">${row.target.toFixed(2)}${row.unit} <span style="opacity:0.6">¬±${row.tolerance}</span></td>
                        ${statusCell}
                    </tr>
                `;
                
                tbody.innerHTML += tableRow;
            }
        }
        
        /**
         * üß™ TESTAR CORRE√á√ÉO
         */
        function testCorrection() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<strong>üìã Executando Testes...</strong><br>';
            
            // Verificar se o patch foi carregado
            const hasPatch = typeof window.createStatusOnlyDiffCell === 'function';
            const hasFeatureFlag = window.REFERENCE_TABLE_HIDE_VALUES === true;
            
            results.innerHTML += hasPatch ? 
                '<span class="success">‚úÖ Patch carregado</span><br>' : 
                '<span class="error">‚ùå Patch n√£o carregado</span><br>';
                
            results.innerHTML += hasFeatureFlag ? 
                '<span class="success">‚úÖ Feature flag ativa</span><br>' : 
                '<span class="error">‚ùå Feature flag inativa</span><br>';
            
            // Testar fun√ß√£o
            if (hasPatch) {
                const testCases = [
                    { diff: 0.2, tol: 0.5, expected: 'Ideal' },
                    { diff: 1.2, tol: 0.5, expected: 'Ajuste leve' },
                    { diff: 2.5, tol: 0.5, expected: 'Corrigir' }
                ];
                
                let passed = 0;
                for (const test of testCases) {
                    const result = window.createStatusOnlyDiffCell(test.diff, 'dB', test.tol);
                    if (result.includes(test.expected)) {
                        passed++;
                        results.innerHTML += `<span class="success">‚úÖ ${test.expected}: OK</span><br>`;
                    } else {
                        results.innerHTML += `<span class="error">‚ùå ${test.expected}: FALHOU</span><br>`;
                    }
                }
                
                results.innerHTML += `<br><strong>üéØ Resultado: ${passed}/${testCases.length} testes passaram</strong><br>`;
                
                if (passed === testCases.length) {
                    results.innerHTML += '<br><span class="success">üéâ CORRE√á√ÉO FUNCIONANDO PERFEITAMENTE!</span><br>';
                    results.innerHTML += '<span class="success">A tabela n√£o deve mostrar valores num√©ricos na coluna de diferen√ßa.</span>';
                } else {
                    results.innerHTML += '<br><span class="error">üö® Alguns testes falharam. Verifique a implementa√ß√£o.</span>';
                }
            }
        }
        
        /**
         * üìä SIMULAR DADOS REAIS
         */
        function simulateRealData() {
            console.log('üìä Simulando dados reais da tabela...');
            buildTable();
            
            const results = document.getElementById('testResults');
            results.innerHTML = '<strong>üìä Dados simulados carregados!</strong><br>';
            results.innerHTML += 'Verifique a tabela acima - a coluna "Diferen√ßa/Status" deve mostrar apenas √≠cones e texto.<br>';
            results.innerHTML += '<span class="success">‚úÖ Se voc√™ v√™ "‚úÖ Ideal", "‚ö†Ô∏è Ajuste leve" ou "‚ùå Corrigir", a corre√ß√£o est√° funcionando!</span><br>';
            results.innerHTML += '<span class="error">‚ùå Se voc√™ v√™ valores como "+1.2dB" ou "-0.5LUFS", a corre√ß√£o falhou.</span>';
        }
        
        // üöÄ INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ P√°gina de teste carregada');
            buildTable();
            
            // Auto-teste ap√≥s um breve delay
            setTimeout(testCorrection, 1000);
        });
    </script>
</body>
</html>
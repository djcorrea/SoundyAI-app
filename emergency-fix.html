<!DOCTYPE html>
<html>
<head>
    <title>CORRE√á√ÉO EMERGENCIAL - SUGEST√ïES</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: #fff; }
        .emergency { background: #ff4444; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .instructions { background: #333; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .code { background: #222; padding: 10px; border-radius: 3px; font-family: monospace; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <div class="emergency">
        <h1>üö® CORRE√á√ÉO EMERGENCIAL - SUGEST√ïES SOUNDYAI</h1>
        <p><strong>N√ÉO DESISTA!</strong> Vamos resolver isso agora mesmo!</p>
    </div>
    
    <div class="instructions">
        <h2>üìã INSTRU√á√ïES R√ÅPIDAS:</h2>
        <ol>
            <li><strong>Abra o Console do Navegador</strong> (F12 ‚Üí Console)</li>
            <li><strong>Cole o c√≥digo abaixo</strong> no console</li>
            <li><strong>Pressione Enter</strong></li>
            <li><strong>Teste enviando um arquivo</strong> no SoundyAI</li>
        </ol>
    </div>
    
    <div class="code" id="codeBlock">
        // C√ìDIGO SER√Å INSERIDO AQUI
    </div>
    
    <button onclick="copyCode()">üìã COPIAR C√ìDIGO</button>
    <button onclick="loadEmergencyScript()">‚ö° CARREGAR SCRIPT</button>
    
    <script>
        // Carregar o script de emerg√™ncia
        fetch('./force-suggestions-emergency.js')
            .then(response => response.text())
            .then(code => {
                document.getElementById('codeBlock').textContent = code;
            })
            .catch(error => {
                document.getElementById('codeBlock').textContent = 'Erro ao carregar o script. Use o bot√£o "CARREGAR SCRIPT" abaixo.';
            });
        
        function copyCode() {
            const code = document.getElementById('codeBlock').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úÖ C√≥digo copiado! Cole no console do navegador e pressione Enter.');
            });
        }
        
        function loadEmergencyScript() {
            // C√≥digo de emerg√™ncia inline
            const emergencyCode = `
// üö® CORRE√á√ÉO EMERGENCIAL DIRETA - FOR√áAR SUGEST√ïES
console.log('üö® [EMERGENCY] Iniciando corre√ß√£o direta de sugest√µes');

// Interceptar a fun√ß√£o displayModalResults
if (typeof window !== 'undefined' && window.displayModalResults) {
    const originalDisplayModalResults = window.displayModalResults;
    
    window.displayModalResults = function(analysis) {
        console.log('üö® [EMERGENCY] Interceptando displayModalResults:', analysis);
        
        // FOR√áA SUGEST√ïES SE N√ÉO EXISTIREM
        if (!analysis.suggestions || analysis.suggestions.length === 0) {
            console.log('üö® [EMERGENCY] FOR√áANDO sugest√µes - an√°lise sem sugest√µes detectada');
            
            const emergencySuggestions = [];
            
            // 1. Buscar em diagnostics.suggestions
            if (analysis.diagnostics?.suggestions) {
                console.log('üö® [EMERGENCY] Encontradas sugest√µes em diagnostics.suggestions:', analysis.diagnostics.suggestions.length);
                emergencySuggestions.push(...analysis.diagnostics.suggestions);
            }
            
            // 2. Gerar sugest√µes b√°sicas se ainda n√£o h√° nenhuma
            if (emergencySuggestions.length === 0) {
                console.log('üö® [EMERGENCY] Gerando sugest√µes b√°sicas de emerg√™ncia');
                
                const tech = analysis.technicalData || {};
                
                if (tech.lufsIntegrated && tech.lufsIntegrated < -23) {
                    emergencySuggestions.push({
                        type: 'loudness',
                        message: 'Volume muito baixo detectado',
                        action: 'Aumentar o volume geral da mixagem',
                        details: 'LUFS atual: ' + tech.lufsIntegrated.toFixed(1) + ', recomendado: -14 LUFS',
                        priority: 8
                    });
                }
                
                if (tech.truePeakDbtp && tech.truePeakDbtp > -1) {
                    emergencySuggestions.push({
                        type: 'headroom',
                        message: 'True Peak muito alto',
                        action: 'Reduzir o ganho para evitar distor√ß√£o',
                        details: 'True Peak atual: ' + tech.truePeakDbtp.toFixed(1) + ' dBTP, recomendado: < -1 dBTP',
                        priority: 9
                    });
                }
                
                if (emergencySuggestions.length === 0) {
                    emergencySuggestions.push({
                        type: 'general',
                        message: 'An√°lise t√©cnica conclu√≠da',
                        action: 'Verificar m√©tricas t√©cnicas na se√ß√£o acima',
                        details: 'Use os dados t√©cnicos para otimizar sua mixagem',
                        priority: 5
                    });
                }
            }
            
            analysis.suggestions = emergencySuggestions;
            console.log('üö® [EMERGENCY] Sugest√µes for√ßadas aplicadas:', analysis.suggestions.length);
        }
        
        return originalDisplayModalResults.call(this, analysis);
    };
    
    console.log('üö® [EMERGENCY] Corre√ß√£o instalada! Teste enviando um arquivo.');
}
            `;
            
            // Executar o c√≥digo
            eval(emergencyCode);
            alert('‚ö° CORRE√á√ÉO ATIVADA! Agora teste enviando um arquivo no SoundyAI.');
        }
    </script>
</body>
</html>
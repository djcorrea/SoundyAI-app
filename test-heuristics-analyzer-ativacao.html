<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Teste: Ativa√ß√£o Heuristics Analyzer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0a0a0a; color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; }
        .result { 
            margin: 20px 0; padding: 15px; border-radius: 8px; 
            border: 1px solid #333; background: #1a1a1a;
        }
        .success { border-color: #28a745; background: #0d2818; }
        .warning { border-color: #ffc107; background: #332b0a; }
        .error { border-color: #dc3545; background: #2c0a0a; }
        .suggestion-item {
            margin: 10px 0; padding: 10px; border-radius: 6px;
            background: #2a2a2a; border-left: 4px solid #007bff;
        }
        .heuristic-suggestion { border-left-color: #9b59b6; }
        pre { background: #111; padding: 10px; border-radius: 4px; overflow: auto; }
        button { 
            background: #007bff; color: white; border: none; 
            padding: 10px 20px; border-radius: 5px; cursor: pointer;
            margin: 10px 5px 0 0;
        }
        button:hover { background: #0056b3; }
        .log-output {
            background: #111; padding: 10px; border-radius: 4px; 
            max-height: 300px; overflow-y: auto; font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Teste: Ativa√ß√£o Heuristics Analyzer</h1>
        <p>Verificando se o Heuristics Analyzer foi ativado com sucesso</p>
        
        <button onclick="testarHeuristicsBasico()">üß™ Teste B√°sico</button>
        <button onclick="testarSugestoesCompletas()">üéµ Teste Sugest√µes Completas</button>
        <button onclick="testarDeteccaoProblemas()">üîç Teste Detec√ß√£o Problemas</button>
        <button onclick="limparResultados()">üóëÔ∏è Limpar</button>
        
        <div id="resultados"></div>
        
        <div class="result">
            <h3>üìã Console Log (capturado em tempo real)</h3>
            <div id="console-log" class="log-output"></div>
        </div>
    </div>

    <!-- Carregar depend√™ncias -->
    <script src="public/suggestion-scorer.js"></script>
    <script src="public/enhanced-suggestion-engine.js"></script>

    <script>
        // Capturar logs do console
        const originalLog = console.log;
        const originalWarn = console.warn;
        const logDiv = document.getElementById('console-log');
        
        function logToDiv(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'warn' ? '#ffc107' : type === 'error' ? '#dc3545' : '#28a745';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToDiv(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToDiv(args.join(' '), 'warn');
        };
        
        function limparResultados() {
            document.getElementById('resultados').innerHTML = '';
            logDiv.innerHTML = '';
        }

        function logResult(title, content, type = 'result') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<h3>${title}</h3>${content}`;
            document.getElementById('resultados').appendChild(div);
        }

        function testarHeuristicsBasico() {
            limparResultados();
            
            try {
                // Criar inst√¢ncia do Enhanced Suggestion Engine
                const engine = new EnhancedSuggestionEngine();
                
                logResult('‚úÖ Inicializa√ß√£o', `
                    <strong>Enhanced Suggestion Engine criado com sucesso!</strong><br>
                    <strong>Heuristics dispon√≠vel:</strong> ${engine.heuristics ? '‚úÖ SIM' : '‚ùå N√ÉO'}<br>
                    <strong>Tipo de heuristics:</strong> ${engine.heuristics && engine.heuristics.analyzeAll ? 'Inline Analyzer' : 'N√£o dispon√≠vel'}<br>
                    <strong>Config habilitada:</strong> ${engine.config.enableHeuristics ? '‚úÖ SIM' : '‚ùå N√ÉO'}
                `, 'success');
                
                // Testar o m√©todo analyzeAll diretamente
                if (engine.heuristics && engine.heuristics.analyzeAll) {
                    const testData = {
                        spectralData: {
                            bands: {
                                sub: { energy: -25 },
                                bass: { energy: -22 },
                                mid: { energy: -5 },  // Alto = poss√≠vel harshness
                                presenca: { energy: -8 } // Alto = poss√≠vel sibil√¢ncia
                            }
                        }
                    };
                    
                    const detections = engine.heuristics.analyzeAll(testData);
                    
                    logResult('üîç Teste de Detec√ß√£o', `
                        <strong>Detec√ß√µes encontradas:</strong> ${detections.length}<br>
                        <pre>${JSON.stringify(detections, null, 2)}</pre>
                    `, detections.length > 0 ? 'success' : 'warning');
                }
                
            } catch (error) {
                logResult('‚ùå Erro no Teste B√°sico', `
                    <strong>Erro:</strong> ${error.message}<br>
                    <pre>${error.stack}</pre>
                `, 'error');
            }
        }

        function testarSugestoesCompletas() {
            try {
                const engine = new EnhancedSuggestionEngine();
                
                // Simular an√°lise completa com dados que devem gerar sugest√µes heur√≠sticas
                const analysisSimulada = {
                    spectralData: {
                        bands: {
                            sub: { energy: -30, rms: -35 },
                            bass: { energy: -25, rms: -28 },
                            lowMid: { energy: -18, rms: -22 },
                            mid: { energy: -3, rms: -8 },      // Muito alto = harshness
                            highMid: { energy: -12, rms: -15 },
                            brilho: { energy: -15, rms: -18 },
                            presenca: { energy: -6, rms: -10 }  // Muito alto = sibil√¢ncia
                        }
                    },
                    audioBuffer: { length: 44100 * 3 } // 3 segundos simulados
                };
                
                const sugestoes = engine.generateHeuristicSuggestions(analysisSimulada, 0.9);
                
                let detalheSugestoes = '<h4>üéµ Sugest√µes Heur√≠sticas Geradas:</h4>';
                if (sugestoes.length > 0) {
                    sugestoes.forEach((s, i) => {
                        detalheSugestoes += `
                            <div class="suggestion-item heuristic-suggestion">
                                <strong>#${i + 1} - ${s.type}:</strong><br>
                                <strong>Mensagem:</strong> ${s.message || 'N/A'}<br>
                                <strong>A√ß√£o:</strong> ${s.action || 'N/A'}<br>
                                <strong>Explica√ß√£o:</strong> ${s.explanation || 'N/A'}<br>
                                <strong>Prioridade:</strong> ${s.priority || 'N/A'}<br>
                                <strong>Confian√ßa:</strong> ${s.confidence || 'N/A'}
                            </div>
                        `;
                    });
                } else {
                    detalheSugestoes += '<p style="color: #ffc107;">Nenhuma sugest√£o heur√≠stica foi gerada.</p>';
                }
                
                logResult('üéµ Sugest√µes Heur√≠sticas', `
                    <strong>Total de sugest√µes:</strong> ${sugestoes.length}<br>
                    <strong>Status:</strong> ${sugestoes.length > 0 ? '‚úÖ FUNCIONANDO' : '‚ö†Ô∏è SEM DETEC√á√ïES'}<br>
                    ${detalheSugestoes}
                `, sugestoes.length > 0 ? 'success' : 'warning');
                
            } catch (error) {
                logResult('‚ùå Erro no Teste de Sugest√µes', `
                    <strong>Erro:</strong> ${error.message}<br>
                    <pre>${error.stack}</pre>
                `, 'error');
            }
        }

        function testarDeteccaoProblemas() {
            try {
                const engine = new EnhancedSuggestionEngine();
                
                // Casos de teste espec√≠ficos
                const testCases = [
                    {
                        name: 'Sibil√¢ncia Excessiva',
                        data: {
                            spectralData: {
                                bands: {
                                    presenca: { energy: -2 } // Muito alto
                                }
                            }
                        },
                        expected: 'sibilance'
                    },
                    {
                        name: 'Harshness nos M√©dios',
                        data: {
                            spectralData: {
                                bands: {
                                    mid: { energy: -3 } // Muito alto
                                }
                            }
                        },
                        expected: 'harshness'
                    },
                    {
                        name: 'Masking Graves',
                        data: {
                            spectralData: {
                                bands: {
                                    sub: { energy: -20 },
                                    bass: { energy: -21 } // Muito pr√≥ximo do sub
                                }
                            }
                        },
                        expected: 'masking'
                    }
                ];
                
                let resultadosDetalhados = '<h4>üîç Resultados por Caso de Teste:</h4>';
                
                testCases.forEach((testCase, i) => {
                    const detections = engine.heuristics.analyzeAll(testCase.data);
                    const encontrou = detections.some(d => d.type === testCase.expected);
                    
                    resultadosDetalhados += `
                        <div class="suggestion-item" style="border-left-color: ${encontrou ? '#28a745' : '#dc3545'}">
                            <strong>Teste ${i + 1}: ${testCase.name}</strong><br>
                            <strong>Esperado:</strong> ${testCase.expected}<br>
                            <strong>Resultado:</strong> ${encontrou ? '‚úÖ DETECTADO' : '‚ùå N√ÉO DETECTADO'}<br>
                            <strong>Detec√ß√µes:</strong> ${detections.map(d => d.type).join(', ') || 'Nenhuma'}
                        </div>
                    `;
                });
                
                const totalTestes = testCases.length;
                const sucessos = testCases.filter((testCase, i) => {
                    const detections = engine.heuristics.analyzeAll(testCase.data);
                    return detections.some(d => d.type === testCase.expected);
                }).length;
                
                logResult('üîç Teste de Detec√ß√£o de Problemas', `
                    <strong>Sucessos:</strong> ${sucessos}/${totalTestes}<br>
                    <strong>Taxa de sucesso:</strong> ${Math.round((sucessos/totalTestes) * 100)}%<br>
                    <strong>Status:</strong> ${sucessos === totalTestes ? '‚úÖ PERFEITO' : sucessos > 0 ? '‚ö†Ô∏è PARCIAL' : '‚ùå FALHOU'}<br>
                    ${resultadosDetalhados}
                `, sucessos === totalTestes ? 'success' : sucessos > 0 ? 'warning' : 'error');
                
            } catch (error) {
                logResult('‚ùå Erro no Teste de Detec√ß√£o', `
                    <strong>Erro:</strong> ${error.message}<br>
                    <pre>${error.stack}</pre>
                `, 'error');
            }
        }
    </script>
</body>
</html>
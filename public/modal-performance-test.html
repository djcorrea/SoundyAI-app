<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Modal Performance Test - SoundyAI</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0a0f1c 0%, #1a2332 50%, #0a0f1c 100%);
            color: #fff;
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .test-header h1 {
            background: linear-gradient(45deg, #40e0d0, #ff6b35);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: rgba(31, 43, 64, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .test-card h3 {
            color: #40e0d0;
            margin-top: 0;
        }
        
        .test-button {
            background: linear-gradient(45deg, #40e0d0, #00bfa5);
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            color: white;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
        }
        
        .test-button.danger {
            background: linear-gradient(45deg, #ff6b35, #ff5722);
        }
        
        .metrics-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .status.success { background: rgba(76, 175, 80, 0.2); color: #81c784; }
        .status.warning { background: rgba(255, 152, 0, 0.2); color: #ffb74d; }
        .status.error { background: rgba(244, 67, 54, 0.2); color: #e57373; }
        
        /* Simular estrutura do modal original */
        .modal-demo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .modal-content-demo {
            background: rgba(14, 20, 34, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            width: 800px;
        }
        
        .demo-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(31, 43, 64, 0.4);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .demo-table th,
        .demo-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .demo-table th {
            background: rgba(15, 25, 45, 0.8);
            color: #40e0d0;
        }
        
        .demo-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .demo-card {
            background: rgba(31, 43, 64, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
        }
    </style>
    <link rel="stylesheet" href="performance-modal-styles.css">
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üöÄ Modal Performance Test</h1>
            <p>Teste as otimiza√ß√µes de performance do modal do SoundyAI</p>
        </div>
        
        <div class="test-grid">
            <!-- Teste 1: M√©tricas de Performance -->
            <div class="test-card">
                <h3>üìä M√©tricas de Performance</h3>
                <p>Monitora tempo de renderiza√ß√£o e detec√ß√£o de long tasks</p>
                <button class="test-button" onclick="startPerformanceMonitoring()">Iniciar Monitoramento</button>
                <button class="test-button" onclick="showPerformanceMetrics()">Mostrar M√©tricas</button>
                <div id="performanceMetrics" class="metrics-display"></div>
            </div>
            
            <!-- Teste 2: Virtual Scroll -->
            <div class="test-card">
                <h3>üìã Virtual Scroll (Tabela)</h3>
                <p>Testa renderiza√ß√£o de tabelas grandes</p>
                <button class="test-button" onclick="testVirtualScroll(100)">100 linhas</button>
                <button class="test-button" onclick="testVirtualScroll(500)">500 linhas</button>
                <button class="test-button" onclick="testVirtualScroll(1000)">1000 linhas</button>
                <div id="virtualScrollStatus" class="status"></div>
            </div>
            
            <!-- Teste 3: Progressive Render -->
            <div class="test-card">
                <h3>üé® Progressive Render (Cards)</h3>
                <p>Testa renderiza√ß√£o progressiva de cards</p>
                <button class="test-button" onclick="testProgressiveRender(20)">20 cards</button>
                <button class="test-button" onclick="testProgressiveRender(50)">50 cards</button>
                <button class="test-button" onclick="testProgressiveRender(100)">100 cards</button>
                <div id="progressiveRenderStatus" class="status"></div>
            </div>
            
            <!-- Teste 4: Freeze Background -->
            <div class="test-card">
                <h3>‚ùÑÔ∏è Background Freeze</h3>
                <p>Testa pausa/retomada de anima√ß√µes de background</p>
                <button class="test-button" onclick="testBackgroundFreeze()">Pausar Background</button>
                <button class="test-button" onclick="testBackgroundUnfreeze()">Retomar Background</button>
                <div id="backgroundStatus" class="status"></div>
            </div>
            
            <!-- Teste 5: Anima√ß√µes Otimizadas -->
            <div class="test-card">
                <h3>üé¨ Anima√ß√µes Otimizadas</h3>
                <p>Testa anima√ß√µes apenas com transform/opacity</p>
                <button class="test-button" onclick="testOptimizedAnimations()">Testar Anima√ß√µes</button>
                <button class="test-button danger" onclick="testBadAnimations()">Anima√ß√µes Ruins (Compara√ß√£o)</button>
                <div id="animationStatus" class="status"></div>
            </div>
            
            <!-- Teste 6: Modal Completo -->
            <div class="test-card">
                <h3>üöÄ Teste Modal Completo</h3>
                <p>Simula abertura completa do modal com todas otimiza√ß√µes</p>
                <button class="test-button" onclick="openDemoModal()">Abrir Modal Demo</button>
                <button class="test-button" onclick="populateDemoModal()">Popular com Dados</button>
                <div id="modalStatus" class="status"></div>
            </div>
        </div>
        
        <!-- Console de Debug -->
        <div class="test-card">
            <h3>üîß Console de Debug</h3>
            <button class="test-button" onclick="enablePerformanceDebug()">Ativar Debug Visual</button>
            <button class="test-button" onclick="disablePerformanceDebug()">Desativar Debug</button>
            <button class="test-button" onclick="logFullReport()">Log Relat√≥rio Completo</button>
            <button class="test-button danger" onclick="clearConsole()">Limpar Console</button>
        </div>
    </div>
    
    <!-- Modal Demo -->
    <div id="modalDemo" class="modal-demo">
        <div class="modal-content-demo">
            <h2>üéµ Modal Demo - An√°lise de √Åudio</h2>
            <button onclick="closeDemoModal()" style="float: right; background: none; border: none; color: #fff; font-size: 20px;">√ó</button>
            
            <div id="demoTableContainer">
                <!-- Tabela ser√° inserida aqui -->
            </div>
            
            <div id="demoCardsContainer" class="demo-cards-grid">
                <!-- Cards ser√£o inseridos aqui -->
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button class="test-button" onclick="closeDemoModal()">Fechar Modal</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="performance-modal-optimizer.js"></script>
    <script src="performance-modal-integration.js"></script>
    
    <script>
        // Estado do teste
        let performanceMonitoring = false;
        let longTaskObserver = null;
        let performanceMetrics = {
            modalOpenTime: 0,
            tableRenderTime: 0,
            cardsRenderTime: 0,
            longTasks: 0,
            totalNodes: 0
        };
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ Modal Performance Test inicializado');
            checkOptimizersLoaded();
        });
        
        function checkOptimizersLoaded() {
            const status = {
                optimizer: !!window.modalPerformanceOptimizer,
                integration: !!window.performanceModalIntegration || !!window.PerformanceModalIntegration,
                css: !!document.querySelector('style#modal-performance-optimizer, link[href*="performance-modal-styles"]')
            };
            
            console.log('üìã Status dos otimizadores:', status);
            return status;
        }
        
        function startPerformanceMonitoring() {
            if (performanceMonitoring) {
                console.log('‚ö†Ô∏è Monitoramento j√° ativo');
                return;
            }
            
            performanceMonitoring = true;
            console.log('üìä Iniciando monitoramento de performance...');
            
            // Observer para long tasks
            if (window.PerformanceObserver) {
                try {
                    longTaskObserver = new PerformanceObserver((list) => {
                        for (const entry of list.getEntries()) {
                            if (entry.duration > 50) {
                                performanceMetrics.longTasks++;
                                console.warn(`‚ö†Ô∏è Long task: ${entry.duration.toFixed(2)}ms`);
                            }
                        }
                    });
                    longTaskObserver.observe({ entryTypes: ['longtask'] });
                } catch (e) {
                    console.log('‚ÑπÔ∏è LongTask API n√£o dispon√≠vel');
                }
            }
            
            updateStatus('performanceMetrics', '‚úÖ Monitoramento ativo', 'success');
        }
        
        function showPerformanceMetrics() {
            const metrics = window.modalPerformanceOptimizer ? 
                           window.modalPerformanceOptimizer.getPerformanceReport() : 
                           performanceMetrics;
            
            const display = document.getElementById('performanceMetrics');
            display.innerHTML = '<pre>' + JSON.stringify(metrics, null, 2) + '</pre>';
        }
        
        function testVirtualScroll(rowCount) {
            console.log(`üìã Testando virtual scroll com ${rowCount} linhas...`);
            const startTime = performance.now();
            
            // Criar tabela grande
            const table = document.createElement('table');
            table.className = 'demo-table classic-genre-table';
            
            // Cabe√ßalho
            const thead = document.createElement('thead');
            thead.innerHTML = '<tr><th>M√©trica</th><th>Valor</th><th>Alvo</th><th>Diferen√ßa</th></tr>';
            table.appendChild(thead);
            
            // Body com muitas linhas
            const tbody = document.createElement('tbody');
            for (let i = 0; i < rowCount; i++) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>M√©trica ${i+1}</td>
                    <td>${(Math.random() * 100).toFixed(2)}</td>
                    <td>${(Math.random() * 100).toFixed(2)}</td>
                    <td>${(Math.random() * 20 - 10).toFixed(2)}</td>
                `;
                tbody.appendChild(tr);
            }
            table.appendChild(tbody);
            
            // Container para teste
            const container = document.createElement('div');
            container.className = 'card reference-comparisons-container';
            container.appendChild(table);
            
            document.body.appendChild(container);
            
            // Aplicar virtual scroll se otimizador dispon√≠vel
            if (window.modalPerformanceOptimizer) {
                window.modalPerformanceOptimizer.enableVirtualScrollForTable(container);
            }
            
            const endTime = performance.now();
            performanceMetrics.tableRenderTime = endTime - startTime;
            performanceMetrics.totalNodes += rowCount;
            
            updateStatus('virtualScrollStatus', 
                        `‚úÖ ${rowCount} linhas em ${(endTime - startTime).toFixed(2)}ms`, 
                        'success');
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                document.body.removeChild(container);
            }, 5000);
        }
        
        function testProgressiveRender(cardCount) {
            console.log(`üé® Testando progressive render com ${cardCount} cards...`);
            const startTime = performance.now();
            
            // Criar grid de cards
            const grid = document.createElement('div');
            grid.className = 'demo-cards-grid ai-suggestions-grid';
            
            for (let i = 0; i < cardCount; i++) {
                const card = document.createElement('div');
                card.className = 'demo-card suggestion-card';
                card.innerHTML = `
                    <h4>Card ${i+1}</h4>
                    <p>Este √© um card de demonstra√ß√£o para testar o render progressivo.</p>
                    <div style="background: rgba(64, 224, 208, 0.2); padding: 10px; border-radius: 8px;">
                        Conte√∫do simulado
                    </div>
                `;
                grid.appendChild(card);
            }
            
            document.body.appendChild(grid);
            
            // Aplicar progressive render se otimizador dispon√≠vel
            if (window.modalPerformanceOptimizer) {
                window.modalPerformanceOptimizer.enableProgressiveRenderForCards(grid);
            }
            
            const endTime = performance.now();
            performanceMetrics.cardsRenderTime = endTime - startTime;
            performanceMetrics.totalNodes += cardCount;
            
            updateStatus('progressiveRenderStatus', 
                        `‚úÖ ${cardCount} cards em ${(endTime - startTime).toFixed(2)}ms`, 
                        'success');
            
            // Remover ap√≥s 10 segundos
            setTimeout(() => {
                document.body.removeChild(grid);
            }, 10000);
        }
        
        function testBackgroundFreeze() {
            console.log('‚ùÑÔ∏è Testando freeze de background...');
            
            if (window.modalPerformanceOptimizer) {
                window.modalPerformanceOptimizer.freezeBackground();
                updateStatus('backgroundStatus', '‚ùÑÔ∏è Background pausado', 'success');
            } else {
                updateStatus('backgroundStatus', '‚ö†Ô∏è Otimizador n√£o dispon√≠vel', 'warning');
            }
        }
        
        function testBackgroundUnfreeze() {
            console.log('üîÑ Testando unfreeze de background...');
            
            if (window.modalPerformanceOptimizer) {
                window.modalPerformanceOptimizer.unfreezeBackground();
                updateStatus('backgroundStatus', 'üîÑ Background restaurado', 'success');
            } else {
                updateStatus('backgroundStatus', '‚ö†Ô∏è Otimizador n√£o dispon√≠vel', 'warning');
            }
        }
        
        function testOptimizedAnimations() {
            console.log('üé¨ Testando anima√ß√µes otimizadas...');
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-card';
            testDiv.style.position = 'fixed';
            testDiv.style.top = '50%';
            testDiv.style.left = '50%';
            testDiv.style.transform = 'translate(-50%, -50%) scale(0.8)';
            testDiv.style.opacity = '0';
            testDiv.style.zIndex = '10000';
            testDiv.innerHTML = '<h3>Anima√ß√£o Otimizada</h3><p>Transform + Opacity apenas</p>';
            
            document.body.appendChild(testDiv);
            
            // Animar (otimizado)
            testDiv.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
            testDiv.style.willChange = 'transform, opacity';
            
            requestAnimationFrame(() => {
                testDiv.style.transform = 'translate(-50%, -50%) scale(1)';
                testDiv.style.opacity = '1';
            });
            
            updateStatus('animationStatus', '‚úÖ Anima√ß√£o otimizada (transform + opacity)', 'success');
            
            // Remover ap√≥s anima√ß√£o
            setTimeout(() => {
                testDiv.style.willChange = 'auto';
                testDiv.style.opacity = '0';
                setTimeout(() => document.body.removeChild(testDiv), 300);
            }, 2000);
        }
        
        function testBadAnimations() {
            console.log('‚ö†Ô∏è Testando anima√ß√µes ruins (para compara√ß√£o)...');
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-card';
            testDiv.style.position = 'fixed';
            testDiv.style.top = '50%';
            testDiv.style.left = '50%';
            testDiv.style.transform = 'translate(-50%, -50%)';
            testDiv.style.zIndex = '10000';
            testDiv.innerHTML = '<h3 style="color: #ff6b35;">Anima√ß√£o Ruim</h3><p>Width + Height + Top + Left</p>';
            
            document.body.appendChild(testDiv);
            
            // Animar (ruim - causa reflow)
            testDiv.style.transition = 'width 0.5s ease, height 0.5s ease, top 0.5s ease, left 0.5s ease';
            testDiv.style.width = '200px';
            testDiv.style.height = '100px';
            
            requestAnimationFrame(() => {
                testDiv.style.width = '400px';
                testDiv.style.height = '200px';
                testDiv.style.top = '40%';
                testDiv.style.left = '40%';
            });
            
            updateStatus('animationStatus', '‚ö†Ô∏è Anima√ß√£o ruim (width + height - causa reflow)', 'warning');
            
            // Remover ap√≥s anima√ß√£o
            setTimeout(() => {
                document.body.removeChild(testDiv);
            }, 3000);
        }
        
        function openDemoModal() {
            console.log('üöÄ Abrindo modal demo...');
            const startTime = performance.now();
            
            const modal = document.getElementById('modalDemo');
            modal.style.display = 'flex';
            modal.classList.add('modal-opening');
            
            // Simular freeze de background
            if (window.modalPerformanceOptimizer) {
                window.modalPerformanceOptimizer.handleModalOpenStart();
            }
            
            const endTime = performance.now();
            performanceMetrics.modalOpenTime = endTime - startTime;
            
            updateStatus('modalStatus', 
                        `‚úÖ Modal aberto em ${(endTime - startTime).toFixed(2)}ms`, 
                        'success');
        }
        
        function populateDemoModal() {
            console.log('üìä Populando modal demo...');
            
            // Adicionar tabela
            testVirtualScroll(50);
            
            // Adicionar cards
            setTimeout(() => {
                const cardsContainer = document.getElementById('demoCardsContainer');
                cardsContainer.innerHTML = '';
                
                for (let i = 0; i < 12; i++) {
                    const card = document.createElement('div');
                    card.className = 'demo-card progressive-card';
                    card.innerHTML = `
                        <h4>Sugest√£o ${i+1}</h4>
                        <p>Simula√ß√£o de sugest√£o IA com conte√∫do relevante.</p>
                        <div style="background: rgba(64, 224, 208, 0.1); padding: 8px; border-radius: 4px; margin-top: 10px;">
                            Prioridade: ${['Alta', 'M√©dia', 'Baixa'][i % 3]}
                        </div>
                    `;
                    cardsContainer.appendChild(card);
                }
                
                // Aplicar progressive render
                if (window.modalPerformanceOptimizer) {
                    window.modalPerformanceOptimizer.enableProgressiveRenderForCards(cardsContainer);
                }
            }, 500);
        }
        
        function closeDemoModal() {
            const modal = document.getElementById('modalDemo');
            modal.classList.add('modal-closing');
            
            // Simular unfreeze de background
            if (window.modalPerformanceOptimizer) {
                window.modalPerformanceOptimizer.handleModalClose();
            }
            
            setTimeout(() => {
                modal.style.display = 'none';
                modal.classList.remove('modal-opening', 'modal-closing');
                
                // Limpar conte√∫do
                document.getElementById('demoTableContainer').innerHTML = '';
                document.getElementById('demoCardsContainer').innerHTML = '';
            }, 250);
        }
        
        function enablePerformanceDebug() {
            document.body.classList.add('performance-debug');
            console.log('üîß Debug visual ativado');
        }
        
        function disablePerformanceDebug() {
            document.body.classList.remove('performance-debug');
            console.log('üîß Debug visual desativado');
        }
        
        function logFullReport() {
            console.group('üìä RELAT√ìRIO COMPLETO DE PERFORMANCE');
            console.log('Otimizadores:', checkOptimizersLoaded());
            console.log('M√©tricas:', performanceMetrics);
            
            if (window.modalPerformanceOptimizer) {
                console.log('Relat√≥rio do otimizador:', window.modalPerformanceOptimizer.getPerformanceReport());
            }
            
            if (performance.memory) {
                console.log('Mem√≥ria:', {
                    used: `${Math.round(performance.memory.usedJSHeapSize / 1024 / 1024)}MB`,
                    total: `${Math.round(performance.memory.totalJSHeapSize / 1024 / 1024)}MB`
                });
            }
            
            console.groupEnd();
        }
        
        function clearConsole() {
            console.clear();
            console.log('üßπ Console limpo');
        }
        
        function updateStatus(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `status ${type}`;
            }
        }
        
        // Hotkeys para testes r√°pidos
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1': testVirtualScroll(100); break;
                    case '2': testProgressiveRender(20); break;
                    case '3': openDemoModal(); break;
                    case '4': logFullReport(); break;
                }
            }
        });
        
        console.log('üéπ Hotkeys: Ctrl+1 (Virtual Scroll), Ctrl+2 (Progressive Render), Ctrl+3 (Modal), Ctrl+4 (Report)');
    </script>
</body>
</html>
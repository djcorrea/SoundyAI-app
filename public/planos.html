<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planos & Pre√ßos - SoundyAI</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS do novo layout premium -->
    <link rel="stylesheet" href="planos.css">
    <link rel="stylesheet" href="modal-mobile-spacing.css?v=20260104">
    
    <!--
    ============================================
    SELETORES CR√çTICOS PRESERVADOS (STRIPE):
    - #btn-plus (bot√£o assinatura Plus)
    - #btn-pro (bot√£o assinatura Pro)
    - .plan-button (classe base bot√µes)
    - .btn-premium (classe estilo premium)
    - handleStripeCheckout() function
    - /api/stripe/create-checkout-session endpoint
    ============================================
    -->
</head>
<body class="planos-page">
    <!-- ===================================
         BACKGROUND COM ORBS ANIMADAS
         =================================== -->
    <div class="pricing-background">
        <!-- Orbs com glow animado -->
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        
        <!-- Grid overlay sutil -->
        <div class="grid-overlay"></div>
    </div>

    <!-- ===================================
         CONTAINER PRINCIPAL
         =================================== -->
    <div class="pricing-container">
        <!-- Header da se√ß√£o -->
        <header class="pricing-header">
            <div class="pricing-badge">
                <!-- √çcone Sparkles SVG -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                    <path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>
                </svg>
                Planos
            </div>
            <h1 class="pricing-title">PLANOS</h1>
            <p class="pricing-subtitle">
                Escolha o destino do seu som: validar, corrigir e evoluir.
            </p>
        </header>

        <!-- ===================================
             GRID DE CARDS
             =================================== -->
        <div class="pricing-grid">
            
            <!-- ===== CARD GR√ÅTIS ===== -->
            <div class="pricing-card glass-effect">
                <div class="card-header">
                    <div class="card-icon">
                        <!-- √çcone User SVG -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <h2 class="card-plan-name">GR√ÅTIS</h2>
                    <p class="card-description">Pra testar o b√°sico e entender seu som.</p>
                </div>
                
                <div class="card-price-section">
                    <div class="card-price">
                        <span class="currency">R$</span>
                        <span class="price-value">0</span>
                    </div>
                    <p class="price-period">N√£o recomendado</p>
                </div>
                
                <div class="card-features">
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">2 an√°lises completas por m√™s</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">20 mensagens no chat por m√™s</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">Sem sugest√µes</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon cross">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </span>
                        <span class="feature-text disabled">Sem an√°lise espectral avan√ßada</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon cross">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </span>
                        <span class="feature-text disabled">Sem "Pedir ajuda √† IA"</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon cross">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </span>
                        <span class="feature-text disabled">Sem an√°lise por m√∫sica de refer√™ncia</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon cross">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </span>
                        <span class="feature-text disabled">Sem relat√≥rio em PDF</span>
                    </div>
                </div>
                
                <div class="card-cta">
                    <a href="index.html" class="plan-button btn-free">Come√ßar gr√°tis</a>
                </div>
            </div>

            <!-- ===== CARD PLUS (POPULAR) ===== -->
            <div class="pricing-card glass-effect popular">
                <!-- Badge Popular -->
                <span class="card-badge badge-popular">MAIS POPULAR</span>
                
                <div class="card-header">
                    <div class="card-icon">
                        <!-- √çcone Zap SVG -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                    </div>
                    <h2 class="card-plan-name">PLUS</h2>
                    <p class="card-description">Pra evoluir com consist√™ncia e corrigir r√°pido.</p>
                </div>
                
                <div class="card-price-section">
                    <div class="card-price">
                        <span class="currency">R$</span>
                        <span class="price-value">47</span>
                        <span class="price-period">,99/m√™s</span>
                    </div>
                    <p class="price-annual">B√°sico que funciona</p>
                </div>
                
                <div class="card-features">
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">30 an√°lises por m√™s</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">80 mensagens no chat por m√™s</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">An√°lise completa + sugest√µes inteligentes</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon cross">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </span>
                        <span class="feature-text disabled">Sem fun√ß√£o "Pedir ajuda √† IA"</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon cross">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </span>
                        <span class="feature-text disabled">Sem an√°lise por m√∫sica de refer√™ncia</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon cross">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </span>
                        <span class="feature-text disabled">Sem relat√≥rio em PDF</span>
                    </div>
                </div>
                
                <div class="card-cta">
                    <!-- PRESERVADO: id="btn-plus" para Stripe -->
                    <button id="btn-plus" class="plan-button btn-premium">Assinar Plus</button>
                </div>
            </div>

            <!-- ===== CARD PRO (DESTAQUE) ===== -->
            <div class="pricing-card glass-effect pro-highlight glow-purple">
                <!-- Badge Melhor Escolha -->
                <span class="card-badge badge-best">‚≠ê MELHOR ESCOLHA</span>
                
                <div class="card-header">
                    <div class="card-icon">
                        <!-- √çcone Crown SVG -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/>
                        </svg>
                    </div>
                    <h2 class="card-plan-name">PRO</h2>
                    <p class="card-description">Pra quem quer n√≠vel profissional e escala.</p>
                </div>
                
                <div class="card-price-section">
                    <div class="card-price">
                        <span class="currency">R$</span>
                        <span class="price-value">79</span>
                        <span class="price-period">,99/m√™s</span>
                    </div>
                    <p class="price-annual">Tudo ilimitado + recursos exclusivos</p>
                </div>
                
                <div class="card-features">
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">An√°lises ilimitadas</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">Chatbot ilimitado</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">Score + an√°lise espectral</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">Sugest√µes ULTRA-DETALHADAS</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">Fun√ß√£o "Pedir ajuda √† IA"</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon check">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <span class="feature-text">Exportar PDF profissional</span>
                    </div>
                </div>
                
                <div class="card-cta">
                    <!-- PRESERVADO: id="btn-pro" para Stripe -->
                    <button id="btn-pro" class="plan-button btn-premium btn-pro-special">Come√ßar no Pro</button>
                </div>
            </div>
        </div>

        <!-- ===================================
             TRUST INDICATORS
             =================================== -->
        <div class="trust-section">
            <div class="trust-item">
                <span class="trust-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                </span>
                <span>Cancele quando quiser</span>
            </div>
            <div class="trust-item">
                <span class="trust-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                </span>
                <span>Sem taxas ocultas</span>
            </div>
            <div class="trust-item">
                <span class="trust-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                </span>
                <span>Upgrade/Downgrade a qualquer momento</span>
            </div>
        </div>
    </div>

    <!-- ===================================
         FIREBASE & STRIPE SCRIPTS
         (PRESERVADO 100% - N√ÉO MODIFICAR)
         =================================== -->
    <script type="module">
        // ‚úÖ Importar Firebase do m√≥dulo compartilhado
        import { auth } from './firebase.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js';

        console.log('üî• Firebase importado de firebase.js compartilhado');

        // ‚úÖ VARI√ÅVEL GLOBAL para armazenar usu√°rio autenticado
        window.currentUser = null;

        // ‚úÖ MONITORAR ESTADO DE AUTENTICA√á√ÉO
        onAuthStateChanged(auth, (user) => {
            window.currentUser = user;
            if (user) {
                console.log('‚úÖ Estado de autentica√ß√£o: LOGADO como', user.email);
            } else {
                console.log('‚ùå Estado de autentica√ß√£o: N√ÉO LOGADO');
            }
        });

        // Stripe Checkout Handler - N√ÉO MODIFICAR
        async function handleStripeCheckout(plan) {
            try {
                // ‚úÖ Verificar se usu√°rio est√° autenticado usando vari√°vel global
                if (!window.currentUser) {
                    alert('Voc√™ precisa estar logado para assinar um plano. Redirecionando para login...');
                    window.location.href = 'index.html';
                    return;
                }

                console.log(`üöÄ Iniciando checkout para plano: ${plan}`);

                // Obter token do Firebase
                const idToken = await window.currentUser.getIdToken();
                console.log('‚úÖ Token obtido com sucesso');

                // Fazer requisi√ß√£o ao endpoint Stripe - N√ÉO MODIFICAR
                const response = await fetch('/api/stripe/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    },
                    body: JSON.stringify({ plan })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Erro ao criar sess√£o de checkout');
                }

                const data = await response.json();
                console.log('‚úÖ Sess√£o de checkout criada:', data);

                // Redirecionar para Stripe Checkout
                if (data.url) {
                    console.log('üîó Redirecionando para Stripe Checkout...');
                    window.location.href = data.url;
                } else {
                    throw new Error('URL de checkout n√£o retornada');
                }

            } catch (error) {
                console.error('‚ùå Erro ao processar checkout:', error);
                alert(`Erro ao processar pagamento: ${error.message}`);
            }
        }

        // Expor fun√ß√£o globalmente para os bot√µes
        window.handleStripeCheckout = handleStripeCheckout;
    </script>

    <script>
        // Event Listeners para bot√µes Stripe - N√ÉO MODIFICAR SELETORES
        document.addEventListener('DOMContentLoaded', () => {
            // ‚úÖ PRESERVADO: Seletores cr√≠ticos #btn-plus e #btn-pro
            const btnPlus = document.getElementById('btn-plus');
            const btnPro = document.getElementById('btn-pro');

            if (btnPlus) {
                btnPlus.addEventListener('click', () => {
                    window.handleStripeCheckout('plus');
                });
            }

            if (btnPro) {
                btnPro.addEventListener('click', () => {
                    window.handleStripeCheckout('pro');
                });
            }

            console.log('‚úÖ Event listeners Stripe configurados');
        });

        console.log('‚úÖ P√°gina de planos carregada com sucesso!');
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç AUDITORIA - Documento T√©cnico</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        
        .audit-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ff00;
            padding: 20px;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 999999;
            font-size: 12px;
        }
        
        .audit-title {
            color: #ffff00;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            border-bottom: 2px solid #ffff00;
            padding-bottom: 5px;
        }
        
        .test-section {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #333;
            background: rgba(0, 50, 0, 0.3);
        }
        
        .test-title {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .offender {
            background: rgba(255, 0, 0, 0.2);
            border-left: 3px solid red;
            padding: 5px;
            margin: 5px 0;
            font-size: 11px;
        }
        
        .pass {
            color: #00ff00;
        }
        
        .fail {
            color: #ff0000;
        }
        
        .warning {
            color: #ffaa00;
        }
        
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 8px 15px;
            margin: 5px;
            cursor: pointer;
            font-family: monospace;
            font-weight: bold;
        }
        
        button:hover {
            background: #00ffff;
        }
        
        /* DEBUG OUTLINE */
        .debug-mode * {
            outline: 1px solid rgba(255, 0, 0, 0.15) !important;
        }
    </style>
</head>
<body>
    <div class="audit-panel" id="auditPanel">
        <div class="audit-title">üîç AUDITORIA DE OVERFLOW</div>
        <button onclick="runFullAudit()">‚ñ∂ EXECUTAR AUDITORIA COMPLETA</button>
        <button onclick="toggleDebugMode()">üëÅÔ∏è TOGGLE OUTLINES</button>
        <button onclick="highlightOffenders()">üéØ HIGHLIGHT OFFENDERS</button>
        <div id="results"></div>
    </div>

    <!-- IFRAME COM A P√ÅGINA REAL -->
    <iframe 
        id="targetFrame" 
        src="documento-tecnico.html" 
        style="width: calc(100% - 440px); height: calc(100vh - 40px); border: 2px solid #00ff00; background: white;"
    ></iframe>

    <script>
        let debugMode = false;
        let offendersFound = [];
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const color = type === 'error' ? 'fail' : type === 'warning' ? 'warning' : 'pass';
            results.innerHTML += `<div class="${color}">${message}</div>`;
        }
        
        function clearLog() {
            document.getElementById('results').innerHTML = '';
        }
        
        function toggleDebugMode() {
            debugMode = !debugMode;
            const iframe = document.getElementById('targetFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            if (debugMode) {
                iframeDoc.body.classList.add('debug-mode');
                log('‚úÖ Debug outlines ATIVADOS', 'info');
            } else {
                iframeDoc.body.classList.remove('debug-mode');
                log('‚ùå Debug outlines DESATIVADOS', 'info');
            }
        }
        
        function runFullAudit() {
            clearLog();
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('üîç INICIANDO AUDITORIA COMPLETA', 'info');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            
            const iframe = document.getElementById('targetFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeWin = iframe.contentWindow;
            
            if (!iframeDoc || !iframeWin) {
                log('‚ùå ERRO: N√£o foi poss√≠vel acessar o iframe', 'error');
                return;
            }
            
            // TESTE 1: Detectar overflow horizontal
            log('<div class="test-section"><div class="test-title">TESTE 1: OVERFLOW HORIZONTAL</div>', 'info');
            detectOverflow(iframeDoc, iframeWin);
            log('</div>', 'info');
            
            // TESTE 2: Procurar por width: 100vw
            log('<div class="test-section"><div class="test-title">TESTE 2: WIDTH 100VW (SUSPEITO #1)</div>', 'info');
            detectViewportWidth(iframeDoc);
            log('</div>', 'info');
            
            // TESTE 3: Procurar transforms
            log('<div class="test-section"><div class="test-title">TESTE 3: TRANSFORMS/PERSPECTIVE</div>', 'info');
            detectTransforms(iframeDoc);
            log('</div>', 'info');
            
            // TESTE 4: Procurar position absolute/fixed com offset
            log('<div class="test-section"><div class="test-title">TESTE 4: POSITIONING SUSPEITO</div>', 'info');
            detectSuspiciousPositioning(iframeDoc);
            log('</div>', 'info');
            
            // TESTE 5: Verificar margin/padding excessivo
            log('<div class="test-section"><div class="test-title">TESTE 5: MARGINS/PADDINGS GRANDES</div>', 'info');
            detectLargeSpacing(iframeDoc);
            log('</div>', 'info');
            
            // TESTE 6: Simular scroll e detectar mudan√ßas
            log('<div class="test-section"><div class="test-title">TESTE 6: MUDAN√áAS DURANTE SCROLL</div>', 'info');
            simulateScrollTest(iframeDoc, iframeWin);
            log('</div>', 'info');
            
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('‚úÖ AUDITORIA CONCLU√çDA', 'info');
            log(`üìä Total de offenders: ${offendersFound.length}`, offendersFound.length > 0 ? 'error' : 'info');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
        }
        
        function detectOverflow(doc, win) {
            const docWidth = doc.documentElement.clientWidth;
            const allElements = Array.from(doc.querySelectorAll('body *'));
            
            offendersFound = allElements.filter(el => {
                const rect = el.getBoundingClientRect();
                return rect.right > docWidth + 1 || rect.left < -1 || rect.width > docWidth + 5;
            });
            
            if (offendersFound.length === 0) {
                log('‚úÖ Nenhum overflow horizontal detectado', 'info');
                return;
            }
            
            log(`‚ùå ENCONTRADOS ${offendersFound.length} ELEMENTOS COM OVERFLOW`, 'error');
            
            // Ordenar por magnitude do overflow
            offendersFound.sort((a, b) => {
                const aOverflow = Math.max(0, a.getBoundingClientRect().right - docWidth);
                const bOverflow = Math.max(0, b.getBoundingClientRect().right - docWidth);
                return bOverflow - aOverflow;
            });
            
            // TOP 10
            offendersFound.slice(0, 10).forEach((el, i) => {
                const rect = el.getBoundingClientRect();
                const overflow = Math.max(0, rect.right - docWidth);
                const tag = el.tagName.toLowerCase();
                const cls = el.className ? `.${el.className.split(' ').join('.')}` : '';
                const id = el.id ? `#${el.id}` : '';
                
                log(`<div class="offender">
                    <strong>#${i + 1}</strong> ${tag}${id}${cls}<br>
                    Width: ${Math.round(rect.width)}px<br>
                    Right: ${Math.round(rect.right)}px (docWidth: ${docWidth}px)<br>
                    Overflow: <span class="fail">${Math.round(overflow)}px</span>
                </div>`, 'error');
            });
        }
        
        function detectViewportWidth(doc) {
            let found = false;
            const allElements = Array.from(doc.querySelectorAll('*'));
            
            allElements.forEach(el => {
                const computed = window.getComputedStyle(el);
                if (computed.width && computed.width.includes('vw')) {
                    found = true;
                    const tag = el.tagName.toLowerCase();
                    const cls = el.className || '';
                    log(`‚ùå ${tag}.${cls} ‚Üí width: ${computed.width}`, 'error');
                }
            });
            
            if (!found) {
                log('‚úÖ Nenhum width: *vw encontrado', 'info');
            }
        }
        
        function detectTransforms(doc) {
            let found = false;
            const allElements = Array.from(doc.querySelectorAll('*'));
            
            allElements.forEach(el => {
                const computed = window.getComputedStyle(el);
                if (computed.transform && computed.transform !== 'none') {
                    found = true;
                    const tag = el.tagName.toLowerCase();
                    const cls = el.className || '';
                    log(`‚ö†Ô∏è ${tag}.${cls} ‚Üí transform: ${computed.transform}`, 'warning');
                }
                if (computed.perspective && computed.perspective !== 'none') {
                    found = true;
                    const tag = el.tagName.toLowerCase();
                    const cls = el.className || '';
                    log(`‚ö†Ô∏è ${tag}.${cls} ‚Üí perspective: ${computed.perspective}`, 'warning');
                }
            });
            
            if (!found) {
                log('‚úÖ Nenhum transform/perspective ativo', 'info');
            }
        }
        
        function detectSuspiciousPositioning(doc) {
            let found = false;
            const allElements = Array.from(doc.querySelectorAll('*'));
            
            allElements.forEach(el => {
                const computed = window.getComputedStyle(el);
                if (['absolute', 'fixed'].includes(computed.position)) {
                    const left = parseFloat(computed.left) || 0;
                    const right = parseFloat(computed.right) || 0;
                    
                    if (Math.abs(left) > 10 || Math.abs(right) > 10) {
                        found = true;
                        const tag = el.tagName.toLowerCase();
                        const cls = el.className || '';
                        log(`‚ö†Ô∏è ${tag}.${cls} ‚Üí position: ${computed.position}, left: ${computed.left}, right: ${computed.right}`, 'warning');
                    }
                }
            });
            
            if (!found) {
                log('‚úÖ Nenhum posicionamento suspeito', 'info');
            }
        }
        
        function detectLargeSpacing(doc) {
            let found = false;
            const allElements = Array.from(doc.querySelectorAll('*'));
            
            allElements.forEach(el => {
                const computed = window.getComputedStyle(el);
                const marginLeft = parseFloat(computed.marginLeft) || 0;
                const marginRight = parseFloat(computed.marginRight) || 0;
                const paddingLeft = parseFloat(computed.paddingLeft) || 0;
                const paddingRight = parseFloat(computed.paddingRight) || 0;
                
                if (marginLeft > 100 || marginRight > 100 || paddingLeft > 100 || paddingRight > 100) {
                    found = true;
                    const tag = el.tagName.toLowerCase();
                    const cls = el.className || '';
                    log(`‚ö†Ô∏è ${tag}.${cls} ‚Üí margin/padding excessivo: mL:${marginLeft}px mR:${marginRight}px pL:${paddingLeft}px pR:${paddingRight}px`, 'warning');
                }
            });
            
            if (!found) {
                log('‚úÖ Nenhum margin/padding excessivo', 'info');
            }
        }
        
        function simulateScrollTest(doc, win) {
            log('üìú Simulando scroll para detectar mudan√ßas...', 'info');
            
            const initialWidth = doc.documentElement.clientWidth;
            const scrollPositions = [0, 500, 1000, 2000, 5000];
            
            scrollPositions.forEach(pos => {
                win.scrollTo(0, pos);
                setTimeout(() => {
                    const currentWidth = doc.documentElement.clientWidth;
                    if (currentWidth !== initialWidth) {
                        log(`‚ùå Largura mudou no scroll ${pos}px: ${initialWidth}px ‚Üí ${currentWidth}px`, 'error');
                    }
                }, 100);
            });
            
            setTimeout(() => {
                win.scrollTo(0, 0);
                log('‚úÖ Teste de scroll conclu√≠do', 'info');
            }, 1000);
        }
        
        function highlightOffenders() {
            if (offendersFound.length === 0) {
                log('‚ö†Ô∏è Execute a auditoria primeiro', 'warning');
                return;
            }
            
            const iframe = document.getElementById('targetFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            offendersFound.forEach((el, i) => {
                el.style.outline = '3px solid red';
                el.style.background = 'rgba(255, 0, 0, 0.2)';
                
                // Adicionar label
                const label = iframeDoc.createElement('div');
                label.textContent = `OFFENDER #${i + 1}`;
                label.style.cssText = 'position: absolute; top: 0; left: 0; background: red; color: white; padding: 2px 5px; font-size: 10px; z-index: 99999; font-family: monospace; font-weight: bold;';
                el.style.position = 'relative';
                el.insertBefore(label, el.firstChild);
            });
            
            log(`üéØ ${offendersFound.length} offenders destacados em VERMELHO`, 'info');
        }
        
        // Auto-run ao carregar
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üìã P√°gina carregada. Clique em "EXECUTAR AUDITORIA" para come√ßar.', 'info');
            }, 1000);
        });
    </script>
</body>
</html>

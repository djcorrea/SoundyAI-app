<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Debug - Valores das Sugest√µes</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .value-check { padding: 10px; margin: 5px 0; }
        .correct { background-color: #d4edda; color: #155724; }
        .incorrect { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .log-entry { font-size: 12px; margin: 2px 0; padding: 2px; background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>üîç Debug - Valores das Sugest√µes vs Tabela de Refer√™ncia</h1>
    
    <div class="debug-section">
        <h3>Estado do Sistema</h3>
        <div id="system-status"></div>
    </div>
    
    <div class="debug-section">
        <h3>Dados de Refer√™ncia Carregados</h3>
        <div id="reference-data"></div>
    </div>
    
    <div class="debug-section">
        <h3>√öltima An√°lise - Compara√ß√£o de Valores</h3>
        <div id="value-comparison"></div>
    </div>
    
    <div class="debug-section">
        <h3>Logs do Console (√∫ltimos 50)</h3>
        <div id="console-logs"></div>
    </div>

    <!-- Scripts necess√°rios -->
    <script src="public/suggestion-scorer.js"></script>
    <script src="public/enhanced-suggestion-engine.js"></script>
    
    <script>
        // üéØ Interceptar console.log para capturar logs relevantes
        const originalLog = console.log;
        const logs = [];
        
        console.log = function(...args) {
            const logText = args.join(' ');
            logs.push(`${new Date().toLocaleTimeString()}: ${logText}`);
            if (logs.length > 50) logs.shift();
            originalLog.apply(console, args);
            updateLogs();
        };
        
        function updateLogs() {
            const logsDiv = document.getElementById('console-logs');
            logsDiv.innerHTML = logs
                .filter(log => log.includes('SUGGESTION_FINAL') || log.includes('BAND') || log.includes('delta'))
                .map(log => `<div class="log-entry">${log}</div>`)
                .join('');
        }
        
        function checkSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            let status = '';
            
            status += `SuggestionScorer: ${typeof window.SuggestionScorer !== 'undefined' ? '‚úÖ Carregado' : '‚ùå N√£o encontrado'}<br>`;
            status += `EnhancedSuggestionEngine: ${typeof window.EnhancedSuggestionEngine !== 'undefined' ? '‚úÖ Carregado' : '‚ùå N√£o encontrado'}<br>`;
            status += `G√™nero ativo: ${window.PROD_AI_REF_GENRE || 'N√£o definido'}<br>`;
            status += `Dados de refer√™ncia: ${window.PROD_AI_REF_DATA ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o encontrado'}<br>`;
            
            statusDiv.innerHTML = status;
        }
        
        function checkReferenceData() {
            const refDiv = document.getElementById('reference-data');
            
            if (!window.PROD_AI_REF_DATA) {
                refDiv.innerHTML = '<div class="incorrect">‚ùå Dados de refer√™ncia n√£o encontrados</div>';
                return;
            }
            
            let html = '<div class="correct">‚úÖ Dados de refer√™ncia carregados</div>';
            
            try {
                const data = window.PROD_AI_REF_DATA;
                html += `<pre>${JSON.stringify(data, null, 2).substring(0, 1000)}...</pre>`;
                
                // Verificar se h√° bandas espectrais
                if (data.bands || data.spectral_bands) {
                    const bands = data.bands || data.spectral_bands;
                    html += '<h4>Bandas encontradas:</h4>';
                    Object.entries(bands).forEach(([band, value]) => {
                        html += `<div>${band}: ${value} dB</div>`;
                    });
                }
            } catch (error) {
                html += `<div class="incorrect">‚ùå Erro ao processar dados: ${error.message}</div>`;
            }
            
            refDiv.innerHTML = html;
        }
        
        function simulateAnalysis() {
            const compDiv = document.getElementById('value-comparison');
            
            if (!window.PROD_AI_REF_DATA) {
                compDiv.innerHTML = '<div class="incorrect">‚ùå N√£o √© poss√≠vel simular sem dados de refer√™ncia</div>';
                return;
            }
            
            // Simular dados de an√°lise
            const mockAnalysisData = {
                spectral_bands: {
                    sub: -15.2,
                    low_bass: -12.8,
                    mid_bass: -9.4,
                    low_mid: -11.6,
                    mid: -8.9,
                    high_mid: -6.7,
                    presence: -10.1,
                    brilliance: -14.3
                }
            };
            
            console.log('üéØ [DEBUG] Simulando an√°lise com dados:', mockAnalysisData);
            
            try {
                const engine = new EnhancedSuggestionEngine();
                const suggestions = engine.generateSuggestions(mockAnalysisData, window.PROD_AI_REF_DATA);
                
                let html = '<h4>Sugest√µes geradas:</h4>';
                suggestions.forEach((suggestion, index) => {
                    const isValueCorrect = suggestion.diagnosis && suggestion.diagnosis.includes('Atual:');
                    const cssClass = isValueCorrect ? 'correct' : 'warning';
                    
                    html += `
                        <div class="value-check ${cssClass}">
                            <strong>${suggestion.action || 'Sem a√ß√£o'}</strong><br>
                            ${suggestion.diagnosis || 'Sem diagnosis'}<br>
                            <small>Tipo: ${suggestion.type}, Subtipo: ${suggestion.subtype}</small>
                        </div>
                    `;
                });
                
                compDiv.innerHTML = html;
                
            } catch (error) {
                compDiv.innerHTML = `<div class="incorrect">‚ùå Erro na simula√ß√£o: ${error.message}</div>`;
                console.error('Erro na simula√ß√£o:', error);
            }
        }
        
        // Executar verifica√ß√µes
        checkSystemStatus();
        checkReferenceData();
        
        // Tentar simular an√°lise ap√≥s um pequeno delay
        setTimeout(() => {
            simulateAnalysis();
        }, 1000);
        
        // Atualizar a cada 5 segundos
        setInterval(() => {
            checkSystemStatus();
            checkReferenceData();
        }, 5000);
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Auditoria: Heuristics Zero Detec√ß√µes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0a0a0a; color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; }
        .result { 
            margin: 20px 0; padding: 15px; border-radius: 8px; 
            border: 1px solid #333; background: #1a1a1a;
        }
        .success { border-color: #28a745; background: #0d2818; }
        .warning { border-color: #ffc107; background: #332b0a; }
        .error { border-color: #dc3545; background: #2c0a0a; }
        pre { background: #111; padding: 10px; border-radius: 4px; overflow: auto; }
        button { 
            background: #007bff; color: white; border: none; 
            padding: 10px 20px; border-radius: 5px; cursor: pointer;
            margin: 10px 5px 0 0;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Auditoria: Heuristics Zero Detec√ß√µes</h1>
        <p>Investigando por que o Heuristics Analyzer retorna 0 detec√ß√µes</p>
        
        <button onclick="testarExtracaoEspectral()">üéµ Testar Extra√ß√£o Espectral</button>
        <button onclick="testarDeteccaoComDados()">üîç Testar Detec√ß√£o com Dados</button>
        <button onclick="testarAnaliseReal()">üìä Simular An√°lise Real</button>
        <button onclick="limparResultados()">üóëÔ∏è Limpar</button>
        
        <div id="resultados"></div>
    </div>

    <!-- Carregar depend√™ncias -->
    <script src="public/suggestion-scorer.js"></script>
    <script src="public/enhanced-suggestion-engine.js"></script>

    <script>
        function limparResultados() {
            document.getElementById('resultados').innerHTML = '';
        }

        function logResult(title, content, type = 'result') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<h3>${title}</h3>${content}`;
            document.getElementById('resultados').appendChild(div);
        }

        function testarExtracaoEspectral() {
            limparResultados();
            
            const engine = new EnhancedSuggestionEngine();
            
            // Testar diferentes formatos de an√°lise que podem chegar
            const testCases = [
                {
                    name: 'Com spectralData.bands',
                    analysis: {
                        spectralData: {
                            bands: {
                                sub: { energy: -25 },
                                bass: { energy: -22 },
                                mid: { energy: -5 },
                                presenca: { energy: -8 }
                            }
                        }
                    }
                },
                {
                    name: 'Com technicalData.spectrum',
                    analysis: {
                        technicalData: {
                            spectrum: {
                                freqBins: [60, 200, 1000, 4000, 8000],
                                magnitude: [0.1, 0.2, 0.3, 0.5, 0.4]
                            }
                        }
                    }
                },
                {
                    name: 'An√°lise vazia',
                    analysis: {}
                },
                {
                    name: 'Com apenas audioBuffer',
                    analysis: {
                        audioBuffer: { length: 44100 }
                    }
                }
            ];
            
            testCases.forEach((testCase, i) => {
                const spectralData = engine.extractSpectralData(testCase.analysis);
                
                logResult(`${i + 1}. ${testCase.name}`, `
                    <strong>Entrada:</strong><br>
                    <pre>${JSON.stringify(testCase.analysis, null, 2)}</pre>
                    <strong>Resultado extractSpectralData:</strong><br>
                    <pre>${JSON.stringify(spectralData, null, 2)}</pre>
                    <strong>Status:</strong> ${spectralData ? '‚úÖ Dados extra√≠dos' : '‚ùå Nenhum dado'}
                `, spectralData ? 'success' : 'warning');
            });
        }

        function testarDeteccaoComDados() {
            const engine = new EnhancedSuggestionEngine();
            
            // Testar detec√ß√£o diretamente com dados espec√≠ficos
            const testScenarios = [
                {
                    name: 'Sibil√¢ncia Alta',
                    data: {
                        spectralData: {
                            bands: {
                                presenca: { energy: -5 } // > -10 = deve detectar sibil√¢ncia
                            }
                        }
                    }
                },
                {
                    name: 'Harshness nos M√©dios',
                    data: {
                        spectralData: {
                            bands: {
                                mid: { energy: -3 } // > -8 = deve detectar harshness
                            }
                        }
                    }
                },
                {
                    name: 'Masking nos Graves',
                    data: {
                        spectralData: {
                            bands: {
                                sub: { energy: -20 },
                                bass: { energy: -21 } // diferen√ßa < 3 = deve detectar masking
                            }
                        }
                    }
                },
                {
                    name: 'Sem Problemas',
                    data: {
                        spectralData: {
                            bands: {
                                sub: { energy: -25 },
                                bass: { energy: -20 },
                                mid: { energy: -15 },
                                presenca: { energy: -18 }
                            }
                        }
                    }
                }
            ];
            
            testScenarios.forEach((scenario, i) => {
                const detections = engine.heuristics.analyzeAll(scenario.data);
                
                logResult(`Cen√°rio ${i + 1}: ${scenario.name}`, `
                    <strong>Dados de entrada:</strong><br>
                    <pre>${JSON.stringify(scenario.data, null, 2)}</pre>
                    <strong>Detec√ß√µes encontradas:</strong> ${detections.length}<br>
                    <strong>Resultado:</strong><br>
                    <pre>${JSON.stringify(detections, null, 2)}</pre>
                `, detections.length > 0 ? 'success' : 'warning');
            });
        }

        function testarAnaliseReal() {
            const engine = new EnhancedSuggestionEngine();
            
            // Simular estrutura de an√°lise real do SoundyAI
            const analysisReal = {
                // Estrutura t√≠pica de retorno do analyzer
                technicalData: {
                    lufs: -12.5,
                    truePeak: -1.2,
                    lra: 8.3,
                    dominantFrequencies: [
                        { frequency: 60, magnitude: 0.3 },
                        { frequency: 200, magnitude: 0.5 },
                        { frequency: 1000, magnitude: 0.8 },
                        { frequency: 4000, magnitude: 0.9 }, // Alto = poss√≠vel harshness
                        { frequency: 8000, magnitude: 0.7 }  // Alto = poss√≠vel sibil√¢ncia
                    ],
                    spectralBands: {
                        sub: { energy: -28, rms: -32 },
                        bass: { energy: -22, rms: -25 },
                        lowMid: { energy: -18, rms: -21 },
                        mid: { energy: -6, rms: -9 },        // Alto
                        highMid: { energy: -12, rms: -15 },
                        brilho: { energy: -14, rms: -17 },
                        presenca: { energy: -7, rms: -10 }   // Alto
                    }
                },
                audioBuffer: { length: 44100 * 5 } // 5 segundos
            };
            
            // Testar extra√ß√£o de dados espectrais
            const spectralData = engine.extractSpectralData(analysisReal);
            
            // Testar gera√ß√£o completa de sugest√µes heur√≠sticas
            const sugestoes = engine.generateHeuristicSuggestions(analysisReal, 0.85);
            
            logResult('üéØ Teste com An√°lise Real', `
                <strong>An√°lise de entrada:</strong><br>
                <pre>${JSON.stringify(analysisReal, null, 2)}</pre>
                
                <strong>Dados espectrais extra√≠dos:</strong><br>
                <pre>${JSON.stringify(spectralData, null, 2)}</pre>
                
                <strong>Sugest√µes heur√≠sticas geradas:</strong> ${sugestoes.length}<br>
                <pre>${JSON.stringify(sugestoes, null, 2)}</pre>
                
                <strong>Diagn√≥stico:</strong><br>
                ${spectralData ? '‚úÖ Extra√ß√£o espectral funcionou' : '‚ùå Falha na extra√ß√£o espectral'}<br>
                ${sugestoes.length > 0 ? '‚úÖ Sugest√µes foram geradas' : '‚ùå Nenhuma sugest√£o gerada'}<br>
                
                <strong>Poss√≠vel causa do problema:</strong><br>
                ${!spectralData ? 'Dados espectrais n√£o foram extra√≠dos corretamente' : 
                  !spectralData.bands ? 'Formato spectralData.bands n√£o encontrado' :
                  'Thresholds podem estar muito restritivos'}
            `, sugestoes.length > 0 ? 'success' : 'error');
        }
    </script>
</body>
</html>
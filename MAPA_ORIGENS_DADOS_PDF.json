{
  "_metadata": {
    "auditoria": "Pipeline Completo de Relat√≥rios PDF",
    "arquivo": "public/audio-analyzer-integration.js",
    "data": "30/10/2025",
    "linhasAnalisadas": 9875,
    "funcoesAuditadas": [
      "downloadModalAnalysis()",
      "normalizeAnalysisDataForPDF()",
      "validateAnalysisDataAgainstUI()",
      "generateReportHTML()",
      "normalizeBackendAnalysisData()",
      "normalizeAnalysisData()"
    ]
  },

  "fonteGlobal": {
    "alias": "window.__soundyAI.analysis",
    "fallback": "currentModalAnalysis",
    "linha": 7911,
    "populadoEm": {
      "modoGenero": {
        "linha": 2593,
        "origem": "normalizeBackendAnalysisData(analysisResult)",
        "estrutura": "an√°lise √∫nica (single audio)"
      },
      "modoReferencia": {
        "linha": 3389,
        "origem": "combinedAnalysis (user + reference + comparison)",
        "estrutura": "compara√ß√£o (user vs reference)"
      }
    }
  },

  "score": {
    "fonte": "analysis.score",
    "linhaExtracao": 8189,
    "ordemPrioridade": [
      "analysis.score (raiz)",
      "analysis.scoring.final",
      "0 (default)"
    ],
    "validacao": {
      "implementada": true,
      "linha": 8120,
      "seletorUI": ".score-final-value",
      "tolerancia": 1
    },
    "problemas": [
      {
        "severidade": "CR√çTICO",
        "descricao": "Modo refer√™ncia pode n√£o ter 'analysis.score' na raiz",
        "solucao": "Usar 'analysis.user.score' ou 'analysis.comparison.score.user'",
        "status": "CORRIGIDO (logs de auditoria adicionados linha ~8200)"
      }
    ],
    "logAuditoria": "üîç [AUDIT-SCORE] Modo: REFER√äNCIA/G√äNERO | scoreUsado: 95"
  },

  "bandasEspectrais": {
    "fonte": "analysis.bands || analysis.spectralBands || analysis.spectral.bands",
    "linhaExtracao": 8175,
    "ordemPrioridade": [
      "analysis.bands",
      "analysis.spectralBands",
      "analysis.spectral.bands",
      "{} (objeto vazio)"
    ],
    "formatosSuportados": {
      "detalhado": { "sub": { "rms_db": -20.1 } },
      "direto": { "sub": -20.1 },
      "aliases": {
        "sub": ["sub", "subBass"],
        "bass": ["bass", "low"],
        "mid": ["mid", "midrange"],
        "high": ["high", "presence", "treble"]
      }
    },
    "validacao": {
      "implementada": false,
      "motivo": "Seletores UI n√£o implementados",
      "seletoresPropostos": [
        "[data-metric=\"band-sub\"]",
        "[data-metric=\"band-bass\"]",
        "[data-metric=\"band-mid\"]",
        "[data-metric=\"band-high\"]"
      ]
    },
    "problemas": [
      {
        "severidade": "CR√çTICO",
        "descricao": "Se backend n√£o enviar 'bands', todas as bandas ficam NULL ‚Üí PDF mostra '‚Äî'",
        "impacto": "Relat√≥rio parece incompleto, usu√°rio n√£o v√™ an√°lise espectral",
        "causaRaiz": "bandsSource = {} quando nenhuma das 3 fontes existe",
        "solucao": "Implementar 3 fallbacks: 1) bands direto, 2) computar de spectrum (FFT), 3) extrair da UI",
        "status": "DETECTADO (logs de auditoria adicionados linha ~8177)"
      }
    ],
    "logAuditoria": [
      "üîç [AUDIT-BANDS] Fonte: analysis.bands | VAZIO",
      "üîç [AUDIT-BANDS] Estrutura: {...}",
      "üö® [AUDIT-BANDS] ‚ö†Ô∏è PROBLEMA: Todas as bandas s√£o NULL!"
    ]
  },

  "sugestoes": {
    "fonte": "analysis.suggestions",
    "linhaExtracao": 8202,
    "ordemPrioridade": [
      "analysis.suggestions (ap√≥s enriquecimento)",
      "analysis.recommendations",
      "['‚úÖ An√°lise completa'] (default)"
    ],
    "enriquecimento": {
      "engine": "SuggestionTextGenerator",
      "linha": 4631,
      "fluxo": [
        "1. Backend retorna analysis.suggestions (gen√©rico)",
        "2. Frontend chama SuggestionTextGenerator.enrichSuggestionText()",
        "3. analysis.suggestions = enrichedSuggestions (sobrescreve)",
        "4. PDF usa analysis.suggestions (j√° enriquecido)"
      ],
      "flag": "analysis._suggestionsGenerated",
      "problema": "Se SuggestionTextGenerator n√£o carregar, PDF usa gen√©ricas"
    },
    "validacao": {
      "implementada": false,
      "motivo": "N√£o h√° como comparar sugest√µes com UI (s√£o geradas dinamicamente)"
    },
    "problemas": [
      {
        "severidade": "M√âDIO",
        "descricao": "PDF n√£o verifica se sugest√µes foram enriquecidas antes de usar",
        "impacto": "Usu√°rio pode ver recomenda√ß√µes gen√©ricas em vez de contextualizadas",
        "solucao": "Verificar flag '_suggestionsGenerated' antes de usar analysis.suggestions",
        "status": "DETECTADO (logs de auditoria adicionados linha ~8215)"
      }
    ],
    "logAuditoria": [
      "üîç [AUDIT-SUGGESTIONS] Recomenda√ß√µes - Fonte: analysis.suggestions, Count: 7",
      "‚úÖ [AUDIT-SUGGESTIONS] Sugest√µes foram ENRICHED (flag: _suggestionsGenerated=true)",
      "‚ö†Ô∏è [AUDIT-SUGGESTIONS] Sugest√µes N√ÉO foram enriched | PDF usando GEN√âRICAS!"
    ]
  },

  "diagnosticos": {
    "fonte": "analysis.problems",
    "linhaExtracao": 8202,
    "ordemPrioridade": [
      "analysis.problems",
      "analysis.diagnostics",
      "['‚úÖ Nenhum problema detectado'] (default)"
    ],
    "formato": "problems[i].message || problems[i]",
    "validacao": {
      "implementada": false,
      "motivo": "Diagn√≥sticos s√£o gerados dinamicamente, n√£o h√° refer√™ncia na UI"
    },
    "logAuditoria": "üîç [AUDIT-SUGGESTIONS] Diagn√≥sticos - Fonte: analysis.problems, Count: 3"
  },

  "loudness": {
    "integrated": {
      "fonte": "analysis.lufsIntegrated",
      "linhaExtracao": 8157,
      "ordemPrioridade": [
        "analysis.lufsIntegrated",
        "analysis.loudness.integrated",
        "analysis.technicalData.lufsIntegrated"
      ],
      "validacao": {
        "implementada": true,
        "linha": 8114,
        "seletorUI": "[data-metric=\"lufs-integrated\"]",
        "tolerancia": 0.1
      }
    },
    "shortTerm": {
      "fonte": "analysis.avgLoudness",
      "fallback": ["analysis.loudness.shortTerm", "analysis.technicalData.avgLoudness"]
    },
    "lra": {
      "fonte": "analysis.lra",
      "fallback": ["analysis.loudness.lra", "analysis.technicalData.lra"]
    }
  },

  "truePeak": {
    "maxDbtp": {
      "fonte": "analysis.truePeakDbtp",
      "linhaExtracao": 8163,
      "ordemPrioridade": [
        "analysis.truePeakDbtp",
        "analysis.truePeak.maxDbtp",
        "analysis.technicalData.truePeakDbtp"
      ],
      "validacao": {
        "implementada": true,
        "linha": 8117,
        "seletorUI": "[data-metric=\"true-peak\"]",
        "tolerancia": 0.1
      }
    },
    "clipping": {
      "samples": {
        "fonte": "analysis.truePeak.clipping.samples",
        "fallback": ["analysis.clipping.samples", "0"]
      },
      "percentage": {
        "fonte": "analysis.truePeak.clipping.percentage",
        "fallback": ["analysis.clipping.percentage", "0"]
      }
    }
  },

  "dynamics": {
    "range": {
      "fonte": "analysis.dynamicRange",
      "linhaExtracao": 8169,
      "fallback": ["analysis.dynamics.range", "analysis.technicalData.dynamicRange"],
      "validacao": {
        "implementada": true,
        "linha": 8120,
        "seletorUI": "[data-metric=\"dynamic-range\"]",
        "tolerancia": 0.5
      }
    },
    "crest": {
      "fonte": "analysis.crestFactor",
      "fallback": ["analysis.dynamics.crest", "analysis.technicalData.crestFactor"]
    }
  },

  "stereo": {
    "width": {
      "fonte": "analysis.stereo.width",
      "linhaExtracao": 8173,
      "fallback": ["analysis.stereoWidth", "analysis.technicalData.stereoWidth"]
    },
    "correlation": {
      "fonte": "analysis.stereoCorrelation",
      "fallback": ["analysis.stereo.correlation", "analysis.technicalData.stereoCorrelation"]
    },
    "monoCompatibility": {
      "fonte": "analysis.stereo.monoCompatibility",
      "fallback": ["analysis.monoCompatibility"]
    }
  },

  "resumoAuditoria": {
    "implementada": true,
    "linha": "~8245",
    "formato": {
      "modo": "REFER√äNCIA | G√äNERO",
      "arquivo": "audio.wav",
      "scoreUsado": 95,
      "bandasSource": "analysis.bands | VAZIO",
      "bandasNull": false,
      "suggestionsSource": "analysis.suggestions",
      "suggestionsEnriched": true,
      "diagnosticsSource": "analysis.problems"
    },
    "logConsole": "üìä [AUDIT-SUMMARY] ============ RESUMO DA AUDITORIA ============"
  },

  "problemasCriticos": [
    {
      "id": "BANDS-NULL",
      "severidade": "CR√çTICO",
      "componente": "Bandas Espectrais",
      "descricao": "Se backend n√£o enviar 'bands', todas as 4 bandas ficam NULL ‚Üí PDF mostra '‚Äî'",
      "impacto": "Relat√≥rio parece incompleto, an√°lise espectral invis√≠vel",
      "solucaoProxima": "Implementar 3 fallbacks: bands direto ‚Üí computar de spectrum ‚Üí extrair da UI",
      "status": "DETECTADO (logs adicionados)",
      "logDeteccao": "üö® [AUDIT-BANDS] ‚ö†Ô∏è PROBLEMA: Todas as bandas s√£o NULL!"
    },
    {
      "id": "SUGGESTIONS-GENERIC",
      "severidade": "M√âDIO",
      "componente": "Sugest√µes",
      "descricao": "PDF n√£o verifica se sugest√µes foram enriquecidas (flag _suggestionsGenerated)",
      "impacto": "Usu√°rio pode ver recomenda√ß√µes gen√©ricas em vez de contextualizadas",
      "solucaoProxima": "Verificar flag antes de usar, tentar enriquecer se false",
      "status": "DETECTADO (logs adicionados)",
      "logDeteccao": "‚ö†Ô∏è [AUDIT-SUGGESTIONS] Sugest√µes N√ÉO foram enriched"
    },
    {
      "id": "SCORE-REFERENCE-MODE",
      "severidade": "M√âDIO",
      "componente": "Score",
      "descricao": "No modo refer√™ncia, usa 'analysis.score' (raiz) em vez de 'analysis.user.score'",
      "impacto": "PDF pode mostrar score incorreto (0 ou refer√™ncia em vez do usu√°rio)",
      "solucaoProxima": "Detectar modo e usar analysis.user.score",
      "status": "CORRIGIDO (logs adicionados)",
      "logDeteccao": "üîç [AUDIT-SCORE] Modo refer√™ncia detectado! Usando user.score"
    }
  ],

  "recomendacoes": {
    "prioridadeAlta": [
      "Implementar 3 fallbacks para bandas espectrais (bands ‚Üí spectrum ‚Üí UI)",
      "Verificar flag _suggestionsGenerated antes de usar sugest√µes",
      "Garantir uso correto de user.score no modo refer√™ncia"
    ],
    "prioridadeMedia": [
      "Adicionar valida√ß√£o de bandas contra UI (seletores [data-metric='band-*'])",
      "Melhorar logs de diagn√≥stico (source de cada m√©trica)",
      "Criar schema JSON para window.__soundyAI.analysis"
    ],
    "prioridadeBaixa": [
      "Documentar estrutura completa do objeto global",
      "Adicionar TypeScript/JSDoc para valida√ß√£o em tempo de desenvolvimento"
    ]
  },

  "logsDisponiveis": {
    "pdfPipeline": [
      "üìÑ [PDF-START] Iniciando gera√ß√£o de relat√≥rio PDF...",
      "üìÑ [PDF-SOURCE] Fonte de dados: {...}"
    ],
    "normalizacao": [
      "üìä [PDF-NORMALIZE] ============ IN√çCIO DA NORMALIZA√á√ÉO ============",
      "üìä [PDF-NORMALIZE] Estrutura recebida: {...}",
      "üéß [PDF-NORMALIZE] Loudness extra√≠do: {...}",
      "‚öôÔ∏è [PDF-NORMALIZE] True Peak extra√≠do: {...}",
      "üìà [PDF-NORMALIZE] Bandas espectrais extra√≠das: {...}",
      "‚úÖ [PDF-NORMALIZE] Resultado normalizado: {...}"
    ],
    "auditoria": [
      "üîç [AUDIT-SCORE] Modo: REFER√äNCIA | G√äNERO",
      "üîç [AUDIT-BANDS] Fonte: analysis.bands | VAZIO",
      "üîç [AUDIT-SUGGESTIONS] Recomenda√ß√µes - Fonte: analysis.suggestions",
      "üìä [AUDIT-SUMMARY] ============ RESUMO DA AUDITORIA ============"
    ],
    "validacao": [
      "üîç [PDF-VALIDATE] Iniciando valida√ß√£o contra UI...",
      "‚úÖ [PDF-VALIDATE] LUFS Integrado: OK (diff=0.0045)",
      "üö® [PDF-VALIDATE] DIVERG√äNCIA em Score: {...}"
    ],
    "alertas": [
      "üö® [AUDIT-BANDS] ‚ö†Ô∏è PROBLEMA: Todas as bandas s√£o NULL!",
      "‚ö†Ô∏è [AUDIT-SUGGESTIONS] Sugest√µes N√ÉO foram enriched",
      "‚ö†Ô∏è [PDF-VALIDATE] Valor PDF ausente para Dynamic Range"
    ]
  },

  "proximosPassos": {
    "investigacao": [
      "Testar com √°udio real e verificar logs no console",
      "Confirmar se backend est√° enviando 'bands' ou 'spectralBands'",
      "Verificar se SuggestionTextGenerator est√° carregando corretamente"
    ],
    "implementacao": [
      "Criar fun√ß√£o computeBandsFromSpectrum(analysis) para fallback 2",
      "Criar fun√ß√£o extractBandsFromUI() para fallback 3",
      "Criar fun√ß√£o ensureSuggestionsEnriched(analysis) para validar enriquecimento"
    ],
    "teste": [
      "Testar modo g√™nero com bandas NULL",
      "Testar modo refer√™ncia com score",
      "Testar com SuggestionTextGenerator desabilitado"
    ]
  }
}

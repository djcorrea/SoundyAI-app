# ğŸ—ºï¸ MAPA DO PIPELINE DE PROCESSAMENTO DE ÃUDIO

Diagrama completo com tempos estimados e pontos de instrumentaÃ§Ã£o.

---

## ğŸ“Š PIPELINE COMPLETO (Visual)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SOUNDYAI AUDIO PIPELINE                            â”‚
â”‚                    Tempo Total Baseline: ~150s (2min30s)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ FASE 5.1: DECODE (~2s, 1.3%)                                           â”‚
â”‚  Arquivo: work/api/audio/audio-decoder.js                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Ler buffer WAV                                                           â”‚
â”‚  â€¢ Decodificar metadata (music-metadata)                                    â”‚
â”‚  â€¢ Extrair canais PCM (Float32Array)                                        â”‚
â”‚  â€¢ Validar sample rate / channels                                           â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š InstrumentaÃ§Ã£o: withPhase('PHASE_5_1_DECODE')                          â”‚
â”‚  ğŸ¯ OtimizaÃ§Ã£o: Decode cache (H4)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ FASE 5.2: SEGMENTATION (~5s, 3.3%)                                     â”‚
â”‚  Arquivo: work/api/audio/temporal-segmentation.js                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Criar frames FFT (4096 samples, hop 1024)                                â”‚
â”‚    â””â”€ Janelamento Hann prÃ©-aplicado                                        â”‚
â”‚  â€¢ Criar frames RMS (400ms blocks, hop 300ms)                               â”‚
â”‚  â€¢ Preservar canais originais                                               â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š InstrumentaÃ§Ã£o: withPhase('PHASE_5_2_SEGMENTATION')                    â”‚
â”‚  ğŸ¯ OtimizaÃ§Ã£o: Janela Hann prÃ©-calculada                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§® FASE 5.3: CORE METRICS (~140s, 93.3%)                                  â”‚
â”‚  Arquivo: work/api/audio/core-metrics.js                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸšï¸ NormalizaÃ§Ã£o LUFS (-23 LU)                                       â”‚  â”‚
â”‚  â”‚  â€¢ Medir LUFS original                                                â”‚  â”‚
â”‚  â”‚  â€¢ Calcular ganho necessÃ¡rio                                          â”‚  â”‚
â”‚  â”‚  â€¢ Aplicar ganho linear                                               â”‚  â”‚
â”‚  â”‚  â€¢ Validar True Peak nÃ£o excede -1 dBTP                               â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â±ï¸ ~3s (2.0%)                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚                                                        â”‚                  â”‚
â”‚  â–¼                                                        â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸŒˆ FFT PROCESSING       â”‚  â”‚  ğŸµ BANDAS ESPECTRAIS (GARGALO #3)   â”‚   â”‚
â”‚  â”‚  (~21s, 14.0%)           â”‚  â”‚  (~32s, 21.3%)                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ Loop frames (~1000)   â”‚  â”‚  â€¢ Sub (20-60 Hz)                     â”‚   â”‚
â”‚  â”‚  â€¢ FFT 4096 (FastFFT)    â”‚  â”‚  â€¢ Bass (60-150 Hz)                   â”‚   â”‚
â”‚  â”‚  â€¢ Magnitude L+R (RMS)   â”‚  â”‚  â€¢ Low-Mid (150-500 Hz)               â”‚   â”‚
â”‚  â”‚  â€¢ Phase spectrum        â”‚  â”‚  â€¢ Mid (500-2000 Hz)                  â”‚   â”‚
â”‚  â”‚  â€¢ 8 mÃ©tricas:           â”‚  â”‚  â€¢ High-Mid (2000-5000 Hz)            â”‚   â”‚
â”‚  â”‚    - Centroid (Hz)       â”‚  â”‚  â€¢ Presence (5000-10000 Hz)           â”‚   â”‚
â”‚  â”‚    - Rolloff (Hz)        â”‚  â”‚  â€¢ Air (10000-20000 Hz)               â”‚   â”‚
â”‚  â”‚    - Bandwidth (Hz)      â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚    - Flatness            â”‚  â”‚  ğŸ“Š measureAsync('SPECTRAL_BANDS')    â”‚   â”‚
â”‚  â”‚    - Crest               â”‚  â”‚  ğŸ¯ H2: Vetorizar, reuso buffers      â”‚   â”‚
â”‚  â”‚    - Spread              â”‚  â”‚  ğŸ¯ Esperado: -10s (-30%)             â”‚   â”‚
â”‚  â”‚    - Skewness            â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚    - Kurtosis            â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚  ğŸ“Š measureAsync(        â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚     'FFT_PROCESSING')    â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚  ğŸ¯ H3: Reuso de planos  â”‚  â”‚                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚                                                        â”‚                  â”‚
â”‚  â–¼                                                        â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ›ï¸ LUFS ITU-R BS.1770-4 â”‚  â”‚  ğŸ”ï¸ TRUE PEAK FFmpeg                 â”‚   â”‚
â”‚  â”‚  (~16s, 10.7%)           â”‚  â”‚  (~8s, 5.3%)                          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ K-weighting filter    â”‚  â”‚  â€¢ Criar temp WAV                     â”‚   â”‚
â”‚  â”‚  â€¢ Block loudness (400ms)â”‚  â”‚  â€¢ FFmpeg ebur128 4x oversampling     â”‚   â”‚
â”‚  â”‚  â€¢ Gating (abs + rel)    â”‚  â”‚  â€¢ Parse output                       â”‚   â”‚
â”‚  â”‚  â€¢ Integrated loudness   â”‚  â”‚  â€¢ Cleanup temp file                  â”‚   â”‚
â”‚  â”‚  â€¢ LRA (loudness range)  â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚  â€¢ Short-term / Momentaryâ”‚  â”‚  ğŸ“Š measureAsync('TRUE_PEAK')         â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚  ğŸ“Š measureAsync('LUFS') â”‚  â”‚                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸµ BPM DETECTION (GARGALO #1 + #2)                                  â”‚  â”‚
â”‚  â”‚  (~46s TOTAL, 30.2%)                                                  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  MÃ©todo A: Advanced Onset Detection (~26s, 17.2%)              â”‚ â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Combinar canais L+R â†’ mono (RMS)                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Spectral flux analysis                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Onset detection (energia + threshold adaptativo)             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Histogram de intervalos                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ BPM + confidence                                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ“Š measureAsync('BPM_METHOD_A')                                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  MÃ©todo B: AutocorrelaÃ§Ã£o (~20s, 13.0%)                         â”‚ â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Filtro passa-baixa (200 Hz)                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Downsampling 2x (performance)                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ AutocorrelaÃ§Ã£o normalizada                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Busca de picos no lag range                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ BPM + confidence                                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ“Š measureAsync('BPM_METHOD_B')                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ¯ H1: Rodar sÃ³ se confidence A < 0.5                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ¯ Esperado: -10s a -20s (-6% a -13%)                          â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Cross-Validation (~2s)                                          â”‚ â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Comparar A vs B                                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Verificar concordÃ¢ncia (Â±3 BPM)                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Detectar relaÃ§Ãµes harmÃ´nicas                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Consolidar resultado final                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ“Š measureAsync('BPM_CROSS_VALIDATION')                         â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  ğŸ“Š withPhase('BPM_DETECTION')                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚                                                        â”‚                  â”‚
â”‚  â–¼                                                        â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ­ STEREO METRICS       â”‚  â”‚  ğŸ“Š DYNAMICS METRICS                  â”‚   â”‚
â”‚  â”‚  (~1s, 0.7%)             â”‚  â”‚  (~1s, 0.7%)                          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ Correlation (-1 a +1) â”‚  â”‚  â€¢ Dynamic Range (DR)                 â”‚   â”‚
â”‚  â”‚  â€¢ Stereo Width (0 a 1)  â”‚  â”‚  â€¢ Crest Factor                       â”‚   â”‚
â”‚  â”‚  â€¢ Balance L/R           â”‚  â”‚  â€¢ RMS dB                             â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚  â€¢ LRA (jÃ¡ calculado no LUFS)         â”‚   â”‚
â”‚  â”‚  ğŸ“Š measureAsync(        â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚     'STEREO_METRICS')    â”‚  â”‚  ğŸ“Š measureAsync('DYNAMICS')          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ” AUXILIARY METRICS (~2s, 1.3%)                                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  â€¢ DC Offset (offset mÃ©dio dos canais)                                â”‚â”‚
â”‚  â”‚  â€¢ Dominant Frequencies (3 picos principais)                           â”‚â”‚
â”‚  â”‚  â€¢ Spectral Uniformity (distribuiÃ§Ã£o de energia)                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š InstrumentaÃ§Ã£o: withPhase('PHASE_5_3_CORE_METRICS')                    â”‚
â”‚  ğŸ¯ H5: Paralelizar LUFS + TP + Bandas (Promise.all)                      â”‚
â”‚  ğŸ¯ Esperado: -24s (-16%)                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ FASE 5.4: JSON OUTPUT (~3s, 2.0%)                                      â”‚
â”‚  Arquivo: work/api/audio/json-output.js                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Scoring adaptativo por gÃªnero                                            â”‚
â”‚  â€¢ AnÃ¡lise de problemas e sugestÃµes V2                                      â”‚
â”‚  â€¢ ClassificaÃ§Ã£o de qualidade                                               â”‚
â”‚  â€¢ SerializaÃ§Ã£o final                                                       â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š InstrumentaÃ§Ã£o: withPhase('PHASE_5_4_JSON_OUTPUT')                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                            âœ… Resultado Final JSON
```

---

## ğŸ¯ PONTOS DE INSTRUMENTAÃ‡ÃƒO (Ordem de Prioridade)

### ğŸ”´ CRÃTICO (Medir Sempre)

1. **PHASE_5_1_DECODE**
   - `work/api/audio/pipeline-complete.js:45`
   
2. **PHASE_5_2_SEGMENTATION**
   - `work/api/audio/pipeline-complete.js:50`
   
3. **PHASE_5_3_CORE_METRICS**
   - `work/api/audio/pipeline-complete.js:55`
   
4. **BPM_METHOD_A**
   - `work/api/audio/core-metrics.js:850`
   
5. **BPM_METHOD_B**
   - `work/api/audio/core-metrics.js:870`
   
6. **SPECTRAL_BANDS**
   - `work/api/audio/core-metrics.js:620`

### ğŸŸ¡ IMPORTANTE (Medir para AnÃ¡lise Detalhada)

7. **FFT_PROCESSING**
   - `work/api/audio/core-metrics.js:390`
   
8. **LUFS_CALCULATION**
   - `work/api/audio/core-metrics.js:520`
   
9. **TRUE_PEAK_CALCULATION**
   - `work/api/audio/core-metrics.js:570`

### ğŸŸ¢ OPCIONAL (Medir se Suspeitar de Gargalo)

10. **SPECTRAL_CENTROID**
11. **STEREO_METRICS**
12. **DYNAMICS_METRICS**
13. **BPM_CROSS_VALIDATION**

---

## ğŸ“Š BREAKDOWN ESPERADO (ApÃ³s OtimizaÃ§Ãµes)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BASELINE (150s)              OTIMIZADO (68s)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Decode:           2s  â”‚       Decode:           2s  (cache)      â”‚
â”‚  Segmentation:     5s  â”‚       Segmentation:     5s               â”‚
â”‚  FFT:             21s  â”‚       FFT:             16s  (reuso)      â”‚
â”‚  Bandas:          32s  â”‚       Bandas:          22s  (vetorizado) â”‚
â”‚  LUFS:            16s  â”œâ”€â”€â”    LUFS:            16s               â”‚
â”‚  True Peak:        8s  â”‚  â”‚    True Peak:        8s  (paralelo)   â”‚
â”‚  EstÃ©reo:          1s  â”‚  â”‚    EstÃ©reo:          1s               â”‚
â”‚  DinÃ¢mica:         1s  â”‚  â”‚    DinÃ¢mica:         1s               â”‚
â”‚  Auxiliar:         2s  â”œâ”€â”€â”¤    Auxiliar:         2s               â”‚
â”‚  BPM MÃ©todo A:    26s  â”‚  â”‚    BPM MÃ©todo A:    26s               â”‚
â”‚  BPM MÃ©todo B:    20s  â”‚  â”‚    BPM MÃ©todo B:     5s  (condicional)â”‚
â”‚  Cross-val:        2s  â”œâ”€â”€â”˜    Cross-val:        1s               â”‚
â”‚  AgregaÃ§Ã£o:        3s  â”‚       AgregaÃ§Ã£o:        2s               â”‚
â”‚  JSON Output:      3s  â”‚       JSON Output:      3s               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚  TOTAL:          150s  â”‚       TOTAL:           68s (-55%)        â”‚
â”‚                        â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
                   ğŸ¯ META ATINGIDA (â‰¤75s)
```

---

## ğŸ” GARGALOS IDENTIFICADOS

| # | Fase | Tempo (s) | % Total | HipÃ³tese | OtimizaÃ§Ã£o | Ganho Est. |
|---|------|----------|---------|----------|-----------|-----------|
| 1 | BPM MÃ©todo B | 20 | 13.0% | H1 | Condicional | -15s |
| 2 | BPM MÃ©todo A | 26 | 17.2% | H1 | - | - |
| 3 | Bandas Espectrais | 32 | 21.3% | H2 | Vetorizar | -10s |
| 4 | FFT Processing | 21 | 14.0% | H3 | Reuso planos | -5s |
| 5 | LUFS Calculation | 16 | 10.7% | H5 | Paralelo | -16s* |
| 6 | True Peak | 8 | 5.3% | H5 | Paralelo | -8s* |

*ParalelizaÃ§Ã£o economiza o tempo do mais lento (Bandas: 22s apÃ³s otimizaÃ§Ã£o)

---

## ğŸ“ˆ ROADMAP DE OTIMIZAÃ‡Ã•ES

```
Sprint 1: InstrumentaÃ§Ã£o
â”œâ”€ Adicionar withPhase() e measureAsync()
â”œâ”€ Rodar baseline (3+ repetiÃ§Ãµes)
â””â”€ Confirmar gargalos
    â””â”€ Ganho: 0s (apenas mediÃ§Ã£o)

Sprint 2: BPM Condicional
â”œâ”€ Rodar mÃ©todo B sÃ³ se confidence A < 0.5
â”œâ”€ Validar paridade (BPM Â±0.5)
â””â”€ PR: perf/otimizacao-bpm-condicional
    â””â”€ Ganho: -10 a -15s (-6% a -10%)

Sprint 3: Bandas Vetorizadas
â”œâ”€ Reutilizar buffers Float32Array
â”œâ”€ Vetorizar loops com subarray + reduce
â”œâ”€ Validar paridade (Bandas Â±0.5pp)
â””â”€ PR: perf/otimizacao-bandas-vetorizadas
    â””â”€ Ganho: -10s (-6%)

Sprint 4: ParalelizaÃ§Ã£o
â”œâ”€ Promise.all([LUFS, TP, Bandas])
â”œâ”€ Validar paridade (todas mÃ©tricas)
â””â”€ PR: perf/otimizacao-paralela
    â””â”€ Ganho: -24s (-16%)

Sprint 5: FFT Reuso (Opcional)
â”œâ”€ Cache de planos FFT (se aplicÃ¡vel)
â”œâ”€ Validar paridade (FFT Â±50Hz)
â””â”€ PR: perf/otimizacao-fft-reuso
    â””â”€ Ganho: -5s (-3%)

RESULTADO FINAL: -54s (-36%) â†’ Tempo: ~96s
SE ADICIONAR TODAS: -64s (-43%) â†’ Tempo: ~86s
```

---

## âœ… CHECKLIST DE IMPLEMENTAÃ‡ÃƒO

- [ ] Adicionar 3 WAVs em `audio-samples/`
- [ ] Rodar baseline: `npm run perf:baseline`
- [ ] Analisar `results/*/summary.md`
- [ ] Confirmar top 3 gargalos
- [ ] Instrumentar cÃ³digo (withPhase + measureAsync)
- [ ] Rodar baseline instrumentado
- [ ] Implementar BPM condicional
- [ ] Validar paridade BPM
- [ ] Implementar bandas vetorizadas
- [ ] Validar paridade bandas
- [ ] Implementar paralelizaÃ§Ã£o
- [ ] Validar paridade completa
- [ ] Criar PRs com changelog
- [ ] Merge e teste final
- [ ] Documentar ganhos

---

**Total de Fases**: 4 principais + 10 subfases crÃ­ticas  
**Total de MediÃ§Ãµes**: ~15 pontos de instrumentaÃ§Ã£o  
**Overhead de InstrumentaÃ§Ã£o**: < 0.1% (desprezÃ­vel)  
**Compatibilidade**: Node.js 18+, Windows PowerShell

---

Para visualizar este mapa durante o desenvolvimento, consulte:
- `QUICK_START.md` para implementaÃ§Ã£o rÃ¡pida
- `AUDIT_REPORT_INITIAL.md` para contexto completo
- `RESULTS_ANALYSIS_EXAMPLE.md` para interpretaÃ§Ã£o de resultados

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Teste Priority Banner Modal Fix</title>
    <style>
        body {
            background: #0f172a;
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            margin: 0;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(51, 65, 85, 0.3);
        }
        .test-title {
            color: #3b82f6;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .test-log {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(100,116,139,0.2);
        }
        
        /* Mock modal styles */
        .suggestion-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .card-title {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 10px;
        }
        
        .card-description {
            color: #cbd5e1;
            font-size: 14px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß† Teste Priority Banner Modal Fix</h1>
        <p>Valida√ß√£o da corre√ß√£o para exibir banner "‚ö° Corre√ß√£o Priorit√°ria" ap√≥s renderiza√ß√£o do modal</p>

        <div class="test-section">
            <div class="test-title">üìã Teste 1: Mock de Cards de Sugest√£o</div>
            <div id="mock-modal-container">
                <!-- Cards simulando o modal -->
                <div class="suggestion-card" id="card-1">
                    <div class="card-title">‚ö° True Peak detectado acima do limite</div>
                    <div class="card-description">O True Peak est√° em +1.2 dBFS, causando clipping digital...</div>
                </div>
                
                <div class="suggestion-card" id="card-2">
                    <div class="card-title">üéõÔ∏è Ajuste de EQ recomendado</div>
                    <div class="card-description">Pequeno ajuste nas frequ√™ncias m√©dias...</div>
                </div>
                
                <div class="suggestion-card" id="card-3">
                    <div class="card-title">‚ö° True-Peak: Corre√ß√£o Urgente</div>
                    <div class="card-description">Valor cr√≠tico detectado que requer aten√ß√£o imediata...</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üìä Log de Teste</div>
            <div id="test-log" class="test-log"></div>
        </div>

        <div class="test-section">
            <div class="test-title">üß™ Controles de Teste</div>
            <button onclick="runPatch()" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin: 5px;">
                Executar Patch Manual
            </button>
            <button onclick="clearBanners()" style="background: #ef4444; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin: 5px;">
                Limpar Banners
            </button>
            <button onclick="runModalSimulation()" style="background: #10b981; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin: 5px;">
                Simular displayModalResults()
            </button>
        </div>
    </div>

    <script>
        // Mock do sistema
        window.__CURRENT_ANALYSIS_RUN_ID__ = 'test_001';
        
        // Log de teste
        function logTest(message) {
            const log = document.getElementById('test-log');
            log.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}<br>`;
            log.scrollTop = log.scrollHeight;
        }

        // Fun√ß√£o do patch extra√≠da do displayModalResults
        function runPatch() {
            logTest("üß† Executando patch de corre√ß√£o priorit√°ria...");
            
            document.querySelectorAll('.suggestion-card').forEach(card => {
                const hasTP = card.innerText.includes('True Peak') || card.innerText.includes('True-Peak');
                const alreadyHasBanner = card.querySelector('.priority-banner');
                
                logTest(`üìã Card verificado: hasTP=${hasTP}, alreadyHasBanner=${!!alreadyHasBanner}`);
                
                if (hasTP && !alreadyHasBanner) {
                    const banner = document.createElement('div');
                    banner.className = 'priority-banner';
                    banner.innerHTML = `
                        <div class="priority-icon">‚ö°</div>
                        <div class="priority-text">
                            Corre√ß√£o Priorit√°ria: reduza o True Peak antes de outros ajustes
                        </div>
                    `;
                    card.prepend(banner);
                    logTest(`‚úÖ Banner adicionado ao card: ${card.querySelector('.card-title').textContent}`);
                }
            });
            
            logTest('‚úÖ [PATCH] Banners de corre√ß√£o priorit√°ria aplicados com sucesso.');
            logTest('[SoundyAI] Corre√ß√£o Priorit√°ria renderizada com sucesso ‚úÖ');
            
            // Contar banners
            const totalBanners = document.querySelectorAll('.priority-banner').length;
            logTest(`üìä Total de banners ativos: ${totalBanners}`);
        }

        // Fun√ß√£o para limpar banners
        function clearBanners() {
            document.querySelectorAll('.priority-banner').forEach(banner => banner.remove());
            logTest("üßπ Todos os banners foram removidos");
        }

        // Simular o fluxo completo do displayModalResults
        function runModalSimulation() {
            logTest("üé≠ Simulando fluxo completo do displayModalResults...");
            
            // Simular innerHTML (limpeza do modal)
            clearBanners();
            logTest("üì∫ Modal 'renderizado' - conte√∫do resetado");
            
            // Simular o setTimeout do patch
            setTimeout(() => {
                logTest("‚è∞ Timeout executado - aplicando patch...");
                runPatch();
            }, 400);
        }

        // CSS do priority-banner j√° inclu√≠do no modal
        function ensurePriorityBannerStyles() {
            if (!document.getElementById('priorityBannerStyles')) {
                const priorityStyle = document.createElement('style');
                priorityStyle.id = 'priorityBannerStyles';
                priorityStyle.textContent = `
                .priority-banner {
                    display: flex !important;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 12px;
                    border-radius: 8px;
                    font-weight: 700;
                    background: linear-gradient(90deg, #ff006a, #ff9800) !important;
                    color: #fff !important;
                    margin-bottom: 10px;
                    box-shadow: 0 0 15px rgba(255, 0, 106, 0.3);
                    animation: pulsePriority 1.5s infinite alternate;
                    position: relative;
                    z-index: 10;
                }
                
                .priority-icon {
                    font-size: 20px;
                    line-height: 1;
                }
                
                @keyframes pulsePriority {
                    from { opacity: 0.8; transform: scale(0.98); }
                    to { opacity: 1; transform: scale(1.02); }
                }
                `;
                document.head.appendChild(priorityStyle);
                logTest("üé® CSS do priority-banner injetado");
            }
        }

        // Inicializa√ß√£o
        logTest("üöÄ Sistema de teste inicializado");
        ensurePriorityBannerStyles();
        logTest("üìù Execute os bot√µes acima para testar o patch");
        logTest("üéØ Objetivo: Banners devem aparecer apenas em cards com 'True Peak'");
    </script>
</body>
</html>
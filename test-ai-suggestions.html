<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste - Sistema de Sugest√µes IA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c1e 0%, #1a1530 100%);
            color: #ffffff;
            padding: 40px 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(90deg, #6a9aff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .test-section h2 {
            color: #00d4ff;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .test-button {
            background: linear-gradient(135deg, #6a00ff, #00d4ff);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 212, 255, 0.3);
        }
        
        .test-button:active {
            transform: translateY(0);
        }
        
        .result-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success {
            color: #00ff92;
        }
        
        .error {
            color: #ff4444;
        }
        
        .warning {
            color: #ffc107;
        }
        
        .info {
            color: #00d4ff;
        }
        
        .api-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            margin: 10px 0;
        }
        
        .api-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste - Sistema de Sugest√µes com IA</h1>
        
        <!-- Teste 1: Configura√ß√£o da IA -->
        <div class="test-section">
            <h2>1. üîë Configura√ß√£o da API OpenAI</h2>
            <p>Configure a API Key para ativar a IA nas sugest√µes.</p>
            
            <input type="text" 
                   id="apiKeyInput" 
                   class="api-input" 
                   placeholder="sk-...sua-api-key-aqui (opcional)">
            
            <button class="test-button" onclick="testConfigureAI()">
                Configurar API Key
            </button>
            
            <button class="test-button" onclick="testToggleAI(true)">
                ‚úÖ Ativar IA
            </button>
            
            <button class="test-button" onclick="testToggleAI(false)">
                ‚ùå Desativar IA
            </button>
            
            <button class="test-button" onclick="testGetStats()">
                üìä Ver Estat√≠sticas
            </button>
            
            <div id="result1" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Teste 2: Enriquecimento Educacional -->
        <div class="test-section">
            <h2>2. üéì Conte√∫do Educacional</h2>
            <p>Testar novos campos: videoTutorials, pluginRecommendations, commonMistakes, proTips.</p>
            
            <button class="test-button" onclick="testEducationalContent()">
                Gerar Conte√∫do Educacional
            </button>
            
            <div id="result2" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Teste 3: Processamento com IA -->
        <div class="test-section">
            <h2>3. ü§ñ Processamento com IA</h2>
            <p>Testar processamento completo de sugest√µes (simula√ß√£o).</p>
            
            <button class="test-button" onclick="testAIProcessing()">
                Processar com IA
            </button>
            
            <button class="test-button" onclick="testFallbackProcessing()">
                Processar sem IA (Fallback)
            </button>
            
            <div id="result3" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Teste 4: Valida√ß√£o CSS -->
        <div class="test-section">
            <h2>4. üé® Valida√ß√£o de Estilos</h2>
            <p>Verificar se as classes CSS foram carregadas corretamente.</p>
            
            <button class="test-button" onclick="testCSSClasses()">
                Validar Classes CSS
            </button>
            
            <div id="result4" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Teste 5: Compatibilidade -->
        <div class="test-section">
            <h2>5. ‚úÖ Teste de Compatibilidade</h2>
            <p>Verificar se o sistema mant√©m compatibilidade com c√≥digo existente.</p>
            
            <button class="test-button" onclick="testBackwardCompatibility()">
                Testar Compatibilidade
            </button>
            
            <div id="result5" class="result-box" style="display:none;"></div>
        </div>
    </div>
    
    <!-- Scripts de Teste -->
    <script src="ai-suggestion-layer.js"></script>
    <script src="ultra-advanced-suggestion-enhancer-v2.js"></script>
    
    <script>
        // Helpers
        function log(resultId, message, type = 'info') {
            const resultBox = document.getElementById(resultId);
            resultBox.style.display = 'block';
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info';
            resultBox.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            resultBox.scrollTop = resultBox.scrollHeight;
        }
        
        function clearLog(resultId) {
            const resultBox = document.getElementById(resultId);
            resultBox.innerHTML = '';
            resultBox.style.display = 'none';
        }
        
        // Teste 1: Configurar IA
        function testConfigureAI() {
            clearLog('result1');
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                log('result1', '‚ö†Ô∏è Nenhuma API Key fornecida. Usando modo demo.', 'warning');
                log('result1', 'üí° Para ativar IA, forne√ßa uma API Key v√°lida.', 'info');
                return;
            }
            
            try {
                if (typeof configureAI === 'function') {
                    configureAI(apiKey, 'gpt-3.5-turbo');
                    log('result1', '‚úÖ API Key configurada com sucesso!', 'success');
                    log('result1', `üîë Modelo: gpt-3.5-turbo`, 'info');
                    log('result1', 'üí° Use "Ativar IA" para habilitar o sistema.', 'info');
                } else {
                    throw new Error('Fun√ß√£o configureAI n√£o encontrada');
                }
            } catch (error) {
                log('result1', `‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        function testToggleAI(enable) {
            clearLog('result1');
            try {
                if (typeof toggleAI === 'function') {
                    const result = toggleAI(enable);
                    const status = result ? 'ATIVADA' : 'DESATIVADA';
                    const icon = result ? '‚úÖ' : '‚ùå';
                    log('result1', `${icon} IA ${status} com sucesso!`, 'success');
                    
                    if (!result) {
                        log('result1', 'üí° Sistema usar√° sugest√µes fixas (fallback).', 'info');
                    }
                } else {
                    throw new Error('Fun√ß√£o toggleAI n√£o encontrada');
                }
            } catch (error) {
                log('result1', `‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        function testGetStats() {
            clearLog('result1');
            try {
                if (typeof getAIStats === 'function') {
                    const stats = getAIStats();
                    log('result1', 'üìä Estat√≠sticas do Sistema de IA:', 'info');
                    log('result1', `   Total de requisi√ß√µes: ${stats.totalRequests}`, 'info');
                    log('result1', `   Requisi√ß√µes bem-sucedidas: ${stats.successfulRequests}`, 'success');
                    log('result1', `   Requisi√ß√µes falhas: ${stats.failedRequests}`, stats.failedRequests > 0 ? 'error' : 'info');
                    log('result1', `   Cache hits: ${stats.cacheHits}`, 'info');
                    log('result1', `   Taxa de sucesso: ${stats.successRate}`, 'success');
                    log('result1', `   Tempo m√©dio de resposta: ${stats.averageResponseTime.toFixed(0)}ms`, 'info');
                    log('result1', `   Modelo: ${stats.model}`, 'info');
                    log('result1', `   API Key configurada: ${stats.hasApiKey ? 'Sim ‚úÖ' : 'N√£o ‚ùå'}`, stats.hasApiKey ? 'success' : 'warning');
                } else {
                    throw new Error('Fun√ß√£o getAIStats n√£o encontrada');
                }
            } catch (error) {
                log('result1', `‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        // Teste 2: Conte√∫do Educacional
        function testEducationalContent() {
            clearLog('result2');
            try {
                if (typeof UltraAdvancedSuggestionEnhancer !== 'undefined') {
                    const enhancer = new UltraAdvancedSuggestionEnhancer();
                    
                    // Criar sugest√£o de teste
                    const mockSuggestion = {
                        message: 'Sibil√¢ncia detectada na faixa de 6-8kHz',
                        action: 'Aplicar de-esser cir√∫rgico em 7000Hz com Q=3.0',
                        priority: 8,
                        confidence: 0.9
                    };
                    
                    const enhanced = enhancer.enhanceSingleSuggestion(mockSuggestion, {});
                    
                    log('result2', '‚úÖ Sugest√£o enriquecida com sucesso!', 'success');
                    log('result2', '', 'info');
                    log('result2', 'üìö Campos adicionados:', 'info');
                    
                    if (enhanced.educationalContent.videoTutorials) {
                        log('result2', `   ‚úÖ videoTutorials: ${enhanced.educationalContent.videoTutorials.length} itens`, 'success');
                        log('result2', `      Exemplo: "${enhanced.educationalContent.videoTutorials[0]?.title}"`, 'info');
                    }
                    
                    if (enhanced.educationalContent.pluginRecommendations) {
                        log('result2', `   ‚úÖ pluginRecommendations: ${enhanced.educationalContent.pluginRecommendations.length} itens`, 'success');
                        log('result2', `      Exemplo: ${enhanced.educationalContent.pluginRecommendations[0]?.name} (${enhanced.educationalContent.pluginRecommendations[0]?.price})`, 'info');
                    }
                    
                    if (enhanced.educationalContent.commonMistakes) {
                        log('result2', `   ‚úÖ commonMistakes: ${enhanced.educationalContent.commonMistakes.length} itens`, 'success');
                        log('result2', `      Exemplo: "${enhanced.educationalContent.commonMistakes[0]}"`, 'info');
                    }
                    
                    if (enhanced.educationalContent.proTips) {
                        log('result2', `   ‚úÖ proTips: ${enhanced.educationalContent.proTips.length} itens`, 'success');
                        log('result2', `      Exemplo: "${enhanced.educationalContent.proTips[0]}"`, 'info');
                    }
                    
                    log('result2', '', 'info');
                    log('result2', 'üìä Estrutura completa:', 'info');
                    log('result2', `<pre>${JSON.stringify(enhanced.educationalContent, null, 2)}</pre>`, 'info');
                    
                } else {
                    throw new Error('Classe UltraAdvancedSuggestionEnhancer n√£o encontrada');
                }
            } catch (error) {
                log('result2', `‚ùå Erro: ${error.message}`, 'error');
                log('result2', `Stack: ${error.stack}`, 'error');
            }
        }
        
        // Teste 3: Processamento com IA
        async function testAIProcessing() {
            clearLog('result3');
            log('result3', 'ü§ñ Iniciando processamento com IA...', 'info');
            
            try {
                if (typeof window.aiSuggestionLayer === 'undefined') {
                    throw new Error('aiSuggestionLayer n√£o encontrado');
                }
                
                // Mock de sugest√µes
                const mockSuggestions = [
                    {
                        type: 'loudness_issues',
                        message: 'LUFS muito baixo',
                        action: 'Aumentar volume em 3dB',
                        metric: 'lufs'
                    },
                    {
                        type: 'sibilance',
                        message: 'Sibil√¢ncia em 7kHz',
                        action: 'Aplicar de-esser',
                        metric: 'frequency'
                    }
                ];
                
                // Mock de contexto
                const mockContext = {
                    technicalData: {
                        lufsIntegrated: -18.5,
                        truePeakDbtp: -2.3,
                        dynamicRange: 8.5,
                        lra: 6.2,
                        stereoCorrelation: 0.65
                    },
                    genre: 'electronic'
                };
                
                log('result3', `üìù Processando ${mockSuggestions.length} sugest√µes...`, 'info');
                
                const result = await window.aiSuggestionLayer.process(mockSuggestions, mockContext);
                
                log('result3', `‚úÖ Processamento conclu√≠do!`, 'success');
                log('result3', `   Sugest√µes processadas: ${result.length}`, 'info');
                log('result3', `   IA ativa: ${window.AI_SUGGESTION_LAYER_ENABLED ? 'Sim ‚úÖ' : 'N√£o (Fallback) ‚ö†Ô∏è'}`, window.AI_SUGGESTION_LAYER_ENABLED ? 'success' : 'warning');
                
                if (result.length > 0) {
                    log('result3', '', 'info');
                    log('result3', 'üìä Primeira sugest√£o processada:', 'info');
                    log('result3', `<pre>${JSON.stringify(result[0], null, 2)}</pre>`, 'info');
                }
                
            } catch (error) {
                log('result3', `‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        async function testFallbackProcessing() {
            clearLog('result3');
            log('result3', '‚öôÔ∏è Iniciando processamento sem IA (fallback)...', 'info');
            
            // Desativar IA temporariamente
            const wasEnabled = window.AI_SUGGESTION_LAYER_ENABLED;
            toggleAI(false);
            
            await testAIProcessing();
            
            // Restaurar estado anterior
            if (wasEnabled) toggleAI(true);
        }
        
        // Teste 4: Valida√ß√£o CSS
        function testCSSClasses() {
            clearLog('result4');
            log('result4', 'üé® Validando classes CSS...', 'info');
            
            const classesToCheck = [
                '.enhanced-card',
                '.card-header',
                '.card-title',
                '.card-badges',
                '.card-description',
                '.card-explanation-block',
                '.card-action',
                '.card-action-block',
                '.card-result-block',
                '.card-expected-result',
                '.card-examples-block',
                '.card-daw-examples',
                '.card-impact'
            ];
            
            let found = 0;
            let notFound = 0;
            
            classesToCheck.forEach(className => {
                // Criar elemento tempor√°rio para testar
                const testEl = document.createElement('div');
                testEl.className = className.replace('.', '');
                document.body.appendChild(testEl);
                
                const styles = window.getComputedStyle(testEl);
                const hasStyles = styles.length > 0 && styles.display !== '';
                
                if (hasStyles) {
                    log('result4', `   ‚úÖ ${className}`, 'success');
                    found++;
                } else {
                    log('result4', `   ‚ùå ${className} (n√£o encontrada)`, 'error');
                    notFound++;
                }
                
                document.body.removeChild(testEl);
            });
            
            log('result4', '', 'info');
            log('result4', `üìä Resultado:`, 'info');
            log('result4', `   Classes encontradas: ${found}/${classesToCheck.length}`, found === classesToCheck.length ? 'success' : 'warning');
            log('result4', `   Classes n√£o encontradas: ${notFound}`, notFound === 0 ? 'success' : 'error');
            
            if (notFound > 0) {
                log('result4', '', 'info');
                log('result4', 'üí° Certifique-se de que o arquivo audio-analyzer.css est√° carregado.', 'warning');
            }
        }
        
        // Teste 5: Compatibilidade
        function testBackwardCompatibility() {
            clearLog('result5');
            log('result5', 'üîç Testando compatibilidade retroativa...', 'info');
            
            let passedTests = 0;
            let failedTests = 0;
            
            // Teste 1: Fun√ß√µes globais
            const globalFunctions = [
                'configureAI',
                'toggleAI',
                'getAIStats'
            ];
            
            log('result5', '', 'info');
            log('result5', 'üì¶ Fun√ß√µes globais:', 'info');
            globalFunctions.forEach(fn => {
                if (typeof window[fn] === 'function') {
                    log('result5', `   ‚úÖ ${fn}`, 'success');
                    passedTests++;
                } else {
                    log('result5', `   ‚ùå ${fn} (n√£o encontrada)`, 'error');
                    failedTests++;
                }
            });
            
            // Teste 2: Classes
            const classes = [
                'AISuggestionLayer',
                'UltraAdvancedSuggestionEnhancer'
            ];
            
            log('result5', '', 'info');
            log('result5', 'üèóÔ∏è Classes:', 'info');
            classes.forEach(cls => {
                if (typeof window[cls] !== 'undefined') {
                    log('result5', `   ‚úÖ ${cls}`, 'success');
                    passedTests++;
                } else {
                    log('result5', `   ‚ùå ${cls} (n√£o encontrada)`, 'error');
                    failedTests++;
                }
            });
            
            // Teste 3: Inst√¢ncias globais
            log('result5', '', 'info');
            log('result5', 'üåç Inst√¢ncias globais:', 'info');
            
            if (window.aiSuggestionLayer) {
                log('result5', `   ‚úÖ window.aiSuggestionLayer`, 'success');
                passedTests++;
            } else {
                log('result5', `   ‚ùå window.aiSuggestionLayer (n√£o encontrada)`, 'error');
                failedTests++;
            }
            
            // Teste 4: Campos educacionais
            log('result5', '', 'info');
            log('result5', 'üìö Campos educacionais opcionais:', 'info');
            
            const educationalFields = [
                'videoTutorials',
                'pluginRecommendations',
                'commonMistakes',
                'proTips'
            ];
            
            try {
                const enhancer = new UltraAdvancedSuggestionEnhancer();
                const mockSuggestion = { message: 'Test', action: 'Test' };
                const enhanced = enhancer.enhanceSingleSuggestion(mockSuggestion, {});
                
                educationalFields.forEach(field => {
                    if (enhanced.educationalContent && enhanced.educationalContent[field] !== undefined) {
                        log('result5', `   ‚úÖ ${field}`, 'success');
                        passedTests++;
                    } else {
                        log('result5', `   ‚ùå ${field} (n√£o encontrado)`, 'error');
                        failedTests++;
                    }
                });
            } catch (error) {
                log('result5', `   ‚ùå Erro ao testar campos: ${error.message}`, 'error');
                failedTests += educationalFields.length;
            }
            
            // Resultado final
            log('result5', '', 'info');
            log('result5', '=' .repeat(50), 'info');
            log('result5', `üìä RESULTADO FINAL:`, 'info');
            log('result5', `   Testes passados: ${passedTests}`, 'success');
            log('result5', `   Testes falhados: ${failedTests}`, failedTests === 0 ? 'success' : 'error');
            
            if (failedTests === 0) {
                log('result5', '', 'info');
                log('result5', 'üéâ TODOS OS TESTES PASSARAM!', 'success');
                log('result5', '‚úÖ Sistema totalmente compat√≠vel e funcional.', 'success');
            } else {
                log('result5', '', 'info');
                log('result5', '‚ö†Ô∏è ALGUNS TESTES FALHARAM', 'warning');
                log('result5', 'üí° Verifique se todos os arquivos foram carregados corretamente.', 'warning');
            }
        }
        
        // Log inicial
        console.log('%cüß™ P√°gina de Testes - Sistema de Sugest√µes IA', 'font-size: 20px; color: #00d4ff; font-weight: bold;');
        console.log('%c‚úÖ Use os bot√µes acima para testar cada funcionalidade', 'font-size: 14px; color: #00ff92;');
    </script>
</body>
</html>

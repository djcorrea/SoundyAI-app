<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß AUDITORIA: Ordem das Sugest√µes no Modal</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 20px; background: #0a0a0a; color: #e0e0e0; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #1e3c72, #2a5298); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .section { background: #1a1a1a; padding: 20px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4CAF50; }
        .problem { background: #2d1b1b; border-left-color: #f44336; }
        .solution { background: #1b2d1b; border-left-color: #4CAF50; }
        .test-section { background: #1a2d1a; padding: 20px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4CAF50; }
        .code { background: #0d1117; padding: 15px; border-radius: 6px; margin: 10px 0; font-family: 'Fira Code', 'Consolas', monospace; font-size: 13px; overflow-x: auto; border: 1px solid #30363d; }
        .logs { background: #1c1c1c; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; }
        .emoji { font-size: 1.3em; margin-right: 8px; }
        .success { color: #51cf66; font-weight: bold; }
        .error { color: #ff6b6b; font-weight: bold; }
        .warning { color: #ffd43b; font-weight: bold; }
        ul li { margin: 8px 0; }
        button { background: #2a5298; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 10px 5px; }
        button:hover { background: #1e3c72; }
        .status-indicator { padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; margin: 0 5px; }
        .status-ok { background: #1b5e1f; color: #51cf66; }
        .status-error { background: #5e1b1b; color: #ff6b6b; }
        .status-warning { background: #5e4b1b; color: #ffd43b; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="emoji">üîß</span>AUDITORIA: Ordem das Sugest√µes no Modal</h1>
            <p><strong>Objetivo:</strong> Verificar se as sugest√µes aparecem na ordem correta: True Peak ‚Üí LUFS ‚Üí DR ‚Üí LRA ‚Üí Stereo ‚Üí Bandas</p>
            <p><strong>Status dos Sistemas:</strong> <span id="systemStatus">‚è≥ Verificando...</span></p>
        </div>

        <!-- DIAGN√ìSTICO DOS SISTEMAS -->
        <div class="section">
            <h2><span class="emoji">üîç</span>Diagn√≥stico dos Sistemas de Sugest√µes</h2>
            
            <div id="systemDiagnostic">
                <p>Executando diagn√≥stico dos sistemas...</p>
            </div>
            
            <button onclick="runSystemDiagnostic()">üîç Executar Diagn√≥stico Completo</button>
            <button onclick="clearLogs()">üßπ Limpar Logs</button>
        </div>

        <!-- TESTES PR√ÅTICOS -->
        <div class="test-section">
            <h2><span class="emoji">üß™</span>Testes Pr√°ticos de Ordem</h2>
            
            <button onclick="testOrderFunction()">üéØ Testar Fun√ß√£o de Ordem Global</button>
            <button onclick="simulateSuggestions()">üìã Simular Sugest√µes Desordenadas</button>
            <button onclick="inspectModalElements()">üîç Inspecionar Elementos do Modal</button>
            
            <div id="testResults" class="logs">
                <div>Clique nos bot√µes acima para executar testes espec√≠ficos...</div>
            </div>
        </div>

        <!-- INSTRU√á√ïES DE USO -->
        <div class="section">
            <h2><span class="emoji">üìã</span>Como Usar Esta Auditoria</h2>
            
            <ol>
                <li><strong>Execute o Diagn√≥stico:</strong> Clique em "Executar Diagn√≥stico Completo" para verificar todos os sistemas</li>
                <li><strong>Analise os Logs:</strong> Observe se h√° mensagens de erro ou conflitos entre sistemas</li>
                <li><strong>Teste a Ordem:</strong> Use os testes pr√°ticos para verificar se a fun√ß√£o de ordem est√° funcionando</li>
                <li><strong>Analise um √Åudio Real:</strong> Execute uma an√°lise no projeto principal e observe os logs do console</li>
                <li><strong>Verifique no Modal:</strong> Confirme se as sugest√µes aparecem na ordem: TP ‚Üí LUFS ‚Üí DR ‚Üí LRA ‚Üí Stereo ‚Üí Bandas</li>
            </ol>
        </div>

        <!-- LOGS ESPERADOS -->
        <div class="section">
            <h2><span class="emoji">üìä</span>Logs que Voc√™ Deve Ver (Ordem Correta)</h2>
            <div class="logs">
<strong class="success">‚úÖ LOGS CORRETOS (AI Integration Ativo):</strong>

üéØ [AI-INTEGRATION] SISTEMA PRINCIPAL ATIVO - Sugest√µes renderizadas no #aiExpandedGrid
üéØ [AUDITORIA] ORDEM FINAL DOS CARDS RENDERIZADOS
üìä Ordem dos cards no DOM (deve ser TP ‚Üí LUFS ‚Üí DR ‚Üí LRA ‚Üí Stereo ‚Üí Bandas):
üî¥ Card 1: Priority 10 - ‚ö†Ô∏è True Peak alto - CORRIJA PRIMEIRO antes de outros...
üü° Card 2: Priority 8 - LUFS fora do alvo...
üü° Card 3: Priority 6 - Dynamic Range muito baixo...
üü° Card 4: Priority 4 - Correla√ß√£o est√©reo muito alta...
üü¢ Card 5: Priority 2 - Banda mid pode ser refor√ßada...

<strong class="warning">‚ö†Ô∏è LOGS DE PROBLEMA (Sistema Emergency Ativo):</strong>

üö® [AUDITORIA] SISTEMA EMERGENCY ATIVO - Engine avan√ßado falhou
üéØ [EMERG√äNCIA] Sugest√µes ordenadas por prioridade: true_peak(10) ‚Üí lufs(8) ‚Üí dr(6)

<strong class="error">‚ùå LOGS DE ERRO (Sistemas Conflitantes):</strong>

‚ö†Ô∏è [AUDITORIA] Renderiza√ß√£o externa detectada no grid!
‚ö†Ô∏è [AI-INTEGRATION] displayModalResults n√£o encontrada - aguardando...
‚ùå [AI-INTEGRATION] Elementos obrigat√≥rios n√£o encontrados: ['grid']
            </div>
        </div>
    </div>
    
    <script>
        let diagnosticResults = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const emoji = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            diagnosticResults.push(`[${timestamp}] ${emoji} ${message}`);
            updateTestResults();
            
            console.log(`${emoji} [AUDIT] ${message}`);
        }
        
        function updateTestResults() {
            const resultsDiv = document.getElementById('testResults');
            if (resultsDiv) {
                resultsDiv.innerHTML = diagnosticResults.map(result => 
                    `<div class="${result.includes('‚úÖ') ? 'success' : result.includes('‚ùå') ? 'error' : result.includes('‚ö†Ô∏è') ? 'warning' : ''}">${result}</div>`
                ).join('');
                resultsDiv.scrollTop = resultsDiv.scrollHeight;
            }
        }
        
        function clearLogs() {
            diagnosticResults = [];
            updateTestResults();
            document.getElementById('testResults').innerHTML = '<div>Logs limpos. Execute novos testes...</div>';
        }
        
        function updateSystemStatus(message, type = 'info') {
            const statusElement = document.getElementById('systemStatus');
            if (statusElement) {
                const statusClass = type === 'success' ? 'status-ok' : type === 'error' ? 'status-error' : 'status-warning';
                statusElement.innerHTML = `<span class="status-indicator ${statusClass}">${message}</span>`;
            }
        }
        
        async function runSystemDiagnostic() {
            log('üîç Iniciando diagn√≥stico completo dos sistemas de sugest√µes...', 'info');
            
            const diagnosticDiv = document.getElementById('systemDiagnostic');
            let diagnosticHtml = '<h3>üìä Resultados do Diagn√≥stico:</h3><ul>';
            
            // 1. Verificar AI Integration
            const hasAiIntegration = typeof window.aiIntegration !== 'undefined';
            const aiIntegrationStatus = hasAiIntegration ? 'Dispon√≠vel' : 'Ausente';
            diagnosticHtml += `<li>AI Integration System: <span class="${hasAiIntegration ? 'success' : 'error'}">${aiIntegrationStatus}</span></li>`;
            log(`AI Integration System: ${aiIntegrationStatus}`, hasAiIntegration ? 'success' : 'error');
            
            // 2. Verificar Enhanced Engine
            const hasEnhancedEngine = typeof window.EnhancedSuggestionEngine !== 'undefined';
            const enhancedEngineStatus = hasEnhancedEngine ? 'Dispon√≠vel' : 'Ausente';
            diagnosticHtml += `<li>Enhanced Suggestion Engine: <span class="${hasEnhancedEngine ? 'success' : 'error'}">${enhancedEngineStatus}</span></li>`;
            log(`Enhanced Suggestion Engine: ${enhancedEngineStatus}`, hasEnhancedEngine ? 'success' : 'error');
            
            // 3. Verificar Emergency System
            const hasEmergencySystem = typeof window.suggestionSystem !== 'undefined';
            const emergencySystemStatus = hasEmergencySystem ? 'Dispon√≠vel' : 'Ausente';
            diagnosticHtml += `<li>Emergency System: <span class="${hasEmergencySystem ? 'success' : 'error'}">${emergencySystemStatus}</span></li>`;
            log(`Emergency System: ${emergencySystemStatus}`, hasEmergencySystem ? 'success' : 'error');
            
            // 4. Verificar displayModalResults
            const hasDisplayModalResults = typeof window.displayModalResults === 'function';
            const displayModalResultsStatus = hasDisplayModalResults ? 'Dispon√≠vel' : 'Ausente';
            diagnosticHtml += `<li>displayModalResults Function: <span class="${hasDisplayModalResults ? 'success' : 'error'}">${displayModalResultsStatus}</span></li>`;
            log(`displayModalResults Function: ${displayModalResultsStatus}`, hasDisplayModalResults ? 'success' : 'error');
            
            // 5. Verificar elementos do DOM
            const aiGrid = document.getElementById('aiExpandedGrid');
            const hasAiGrid = !!aiGrid;
            const aiGridStatus = hasAiGrid ? 'Encontrado' : 'Ausente';
            diagnosticHtml += `<li>AI Grid Element (#aiExpandedGrid): <span class="${hasAiGrid ? 'success' : 'error'}">${aiGridStatus}</span></li>`;
            log(`AI Grid Element: ${aiGridStatus}`, hasAiGrid ? 'success' : 'error');
            
            // 6. Verificar fun√ß√£o de ordem global
            const hasOrderFunction = typeof window.forceCorrectSuggestionsOrder === 'function';
            const orderFunctionStatus = hasOrderFunction ? 'Dispon√≠vel' : 'Ausente';
            diagnosticHtml += `<li>Global Order Function: <span class="${hasOrderFunction ? 'success' : 'error'}">${orderFunctionStatus}</span></li>`;
            log(`Global Order Function: ${orderFunctionStatus}`, hasOrderFunction ? 'success' : 'error');
            
            diagnosticHtml += '</ul>';
            
            // An√°lise final
            const systemsWorking = [hasAiIntegration, hasEnhancedEngine, hasDisplayModalResults, hasAiGrid].filter(Boolean).length;
            const totalSystems = 4;
            
            if (systemsWorking === totalSystems) {
                diagnosticHtml += '<p class="success">‚úÖ Todos os sistemas principais est√£o funcionando!</p>';
                updateSystemStatus('‚úÖ Todos os sistemas OK', 'success');
                log('Diagn√≥stico: Todos os sistemas principais funcionando', 'success');
            } else if (systemsWorking >= 2) {
                diagnosticHtml += '<p class="warning">‚ö†Ô∏è Alguns sistemas est√£o ausentes, mas o b√°sico funciona</p>';
                updateSystemStatus(`‚ö†Ô∏è ${systemsWorking}/${totalSystems} sistemas OK`, 'warning');
                log(`Diagn√≥stico: ${systemsWorking}/${totalSystems} sistemas funcionando`, 'warning');
            } else {
                diagnosticHtml += '<p class="error">‚ùå M√∫ltiplos sistemas cr√≠ticos ausentes!</p>';
                updateSystemStatus('‚ùå Sistemas cr√≠ticos ausentes', 'error');
                log('Diagn√≥stico: M√∫ltiplos sistemas cr√≠ticos ausentes', 'error');
            }
            
            diagnosticDiv.innerHTML = diagnosticHtml;
            log('üéØ Diagn√≥stico completo finalizado', 'info');
        }
        
        function testOrderFunction() {
            log('üéØ Testando fun√ß√£o de ordem global...', 'info');
            
            if (typeof window.forceCorrectSuggestionsOrder !== 'function') {
                log('‚ùå Fun√ß√£o de ordem global n√£o encontrada!', 'error');
                return;
            }
            
            // Criar sugest√µes de teste desordenadas
            const testSuggestions = [
                { type: 'band_adjust', priority: 2, message: 'Banda mid precisa de ajuste' },
                { type: 'reference_true_peak', priority: 10, message: 'True Peak muito alto' },
                { type: 'heuristic_stereo', priority: 4, message: 'Correla√ß√£o est√©reo inadequada' },
                { type: 'reference_loudness', priority: 8, message: 'LUFS fora do alvo' },
                { type: 'reference_dynamics', priority: 6, message: 'Dynamic Range baixo' }
            ];
            
            log(`Sugest√µes originais (${testSuggestions.length}): ${testSuggestions.map(s => s.type).join(' ‚Üí ')}`, 'info');
            
            const orderedSuggestions = window.forceCorrectSuggestionsOrder(testSuggestions);
            
            log(`Sugest√µes ordenadas (${orderedSuggestions.length}): ${orderedSuggestions.map(s => `${s.type}(${s.priority})`).join(' ‚Üí ')}`, 'success');
            
            // Verificar se a ordem est√° correta
            const expectedOrder = ['reference_true_peak', 'reference_loudness', 'reference_dynamics', 'heuristic_stereo', 'band_adjust'];
            const actualOrder = orderedSuggestions.map(s => s.type);
            
            const isCorrectOrder = JSON.stringify(expectedOrder) === JSON.stringify(actualOrder);
            
            if (isCorrectOrder) {
                log('‚úÖ Ordem est√° CORRETA! True Peak primeiro, bandas por √∫ltimo', 'success');
            } else {
                log('‚ùå Ordem est√° INCORRETA!', 'error');
                log(`Esperado: ${expectedOrder.join(' ‚Üí ')}`, 'error');
                log(`Atual: ${actualOrder.join(' ‚Üí ')}`, 'error');
            }
        }
        
        function simulateSuggestions() {
            log('üìã Simulando processamento de sugest√µes desordenadas...', 'info');
            
            // Simular o que acontece no AI Integration
            const mockSuggestions = [
                { type: 'heuristic_spectral_imbalance', priority: 1.2, message: 'Desbalanceamento espectral detectado' },
                { type: 'reference_true_peak', priority: 9.8, message: '‚ö†Ô∏è True Peak alto - CORRIJA PRIMEIRO' },
                { type: 'reference_stereo', priority: 3.4, message: 'Correla√ß√£o est√©reo fora do ideal' },
                { type: 'reference_loudness', priority: 7.6, message: 'LUFS precisa ser ajustado' },
                { type: 'band_adjust', priority: 2.1, message: 'Banda highMid pode ser refor√ßada' }
            ];
            
            log('Simulando fluxo completo do AI Integration...', 'info');
            log('1. Sugest√µes recebidas do Enhanced Engine', 'info');
            log('2. Aplicando merge inteligente com backend IA', 'info');
            log('3. Aplicando fun√ß√£o de ordem global', 'info');
            
            if (window.forceCorrectSuggestionsOrder) {
                const ordered = window.forceCorrectSuggestionsOrder(mockSuggestions);
                log('4. Ordem aplicada com sucesso!', 'success');
                
                ordered.forEach((sug, index) => {
                    const priorityEmoji = sug.priority >= 9 ? 'üî¥' : sug.priority >= 5 ? 'üü°' : 'üü¢';
                    log(`${priorityEmoji} Card ${index + 1}: Priority ${sug.priority} - ${sug.message}`, 'success');
                });
            } else {
                log('4. ‚ùå Fun√ß√£o de ordem n√£o dispon√≠vel!', 'error');
            }
        }
        
        function inspectModalElements() {
            log('üîç Inspecionando elementos do modal de sugest√µes...', 'info');
            
            const elements = {
                'aiSuggestionsExpanded': document.getElementById('aiSuggestionsExpanded'),
                'aiExpandedGrid': document.getElementById('aiExpandedGrid'),
                'modalTechnicalData': document.getElementById('modalTechnicalData'),
                'audioAnalysisResults': document.getElementById('audioAnalysisResults')
            };
            
            Object.entries(elements).forEach(([name, element]) => {
                if (element) {
                    log(`‚úÖ ${name}: Encontrado (${element.children.length} filhos)`, 'success');
                    if (element.style.display === 'none') {
                        log(`   ‚îî‚îÄ Status: Oculto (display: none)`, 'warning');
                    } else {
                        log(`   ‚îî‚îÄ Status: Vis√≠vel`, 'success');
                    }
                } else {
                    log(`‚ùå ${name}: N√£o encontrado`, 'error');
                }
            });
            
            // Verificar se h√° cards de sugest√µes renderizados
            const aiGrid = document.getElementById('aiExpandedGrid');
            if (aiGrid) {
                const suggestionCards = aiGrid.querySelectorAll('.ai-suggestion-card');
                log(`üìã Cards de sugest√µes encontrados: ${suggestionCards.length}`, suggestionCards.length > 0 ? 'success' : 'warning');
                
                if (suggestionCards.length > 0) {
                    log('Ordem atual dos cards:', 'info');
                    suggestionCards.forEach((card, index) => {
                        const title = card.querySelector('.ai-suggestion-title')?.textContent || 'Sem t√≠tulo';
                        log(`   Card ${index + 1}: ${title.substring(0, 50)}...`, 'info');
                    });
                }
            }
        }
        
        // Executar diagn√≥stico inicial quando a p√°gina carrega
        window.addEventListener('load', () => {
            setTimeout(() => {
                runSystemDiagnostic();
            }, 1000);
        });
    </script>
</body>
</html>
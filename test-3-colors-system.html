<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste: Sistema de 3 Cores</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #242424;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #52f7ad;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #999;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
        }
        
        th {
            background: #333;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #52f7ad;
            border-bottom: 2px solid #52f7ad;
        }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #3a3a3a;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        .ok {
            color: #52f7ad;
            font-weight: 600;
        }
        
        .ok::before {
            content: '‚úÖ ';
            margin-right: 4px;
        }
        
        .yellow {
            color: #ffce4d;
            font-weight: 600;
        }
        
        .yellow::before {
            content: '‚ö†Ô∏è ';
            margin-right: 4px;
        }
        
        .warn {
            color: #ff7b7b;
            font-weight: 600;
        }
        
        .warn::before {
            content: '‚ùå ';
            margin-right: 4px;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
            border-left: 4px solid #52f7ad;
        }
        
        .test-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #52f7ad;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .legend-box.ok {
            background: #52f7ad;
        }
        
        .legend-box.yellow {
            background: #ffce4d;
        }
        
        .legend-box.warn {
            background: #ff7b7b;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .result.pass {
            background: rgba(82, 247, 173, 0.1);
            border: 2px solid #52f7ad;
            color: #52f7ad;
        }
        
        .result.fail {
            background: rgba(255, 123, 123, 0.1);
            border: 2px solid #ff7b7b;
            color: #ff7b7b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste: Sistema de 3 Cores</h1>
        <p class="subtitle">Valida√ß√£o de que todas as c√©lulas recebem exatamente uma das 3 cores (verde, amarelo ou vermelho)</p>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box ok"></div>
                <span>Verde (OK): Dentro da toler√¢ncia</span>
            </div>
            <div class="legend-item">
                <div class="legend-box yellow"></div>
                <span>Amarelo (Yellow): Fora um pouco</span>
            </div>
            <div class="legend-item">
                <div class="legend-box warn"></div>
                <span>Vermelho (Warn): Fora muito</span>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üìä Teste 1: Casos Padr√£o com Toler√¢ncia</div>
            <table id="test1"></table>
        </div>
        
        <div class="test-section">
            <div class="test-title">üö® Teste 2: Casos Extremos e Edge Cases</div>
            <table id="test2"></table>
        </div>
        
        <div class="test-section">
            <div class="test-title">üî¨ Teste 3: Limites de Precis√£o (Epsilon)</div>
            <table id="test3"></table>
        </div>
        
        <div id="result"></div>
    </div>
    
    <script>
        // Fun√ß√£o de c√°lculo de cor (c√≥pia exata da implementa√ß√£o)
        const EPS = 1e-6;
        
        function getColorClass(value, target, tolerance) {
            const numVal = Number(value);
            const numTarget = Number(target);
            
            // Sem dado v√°lido = vermelho
            if (!Number.isFinite(numVal) || !Number.isFinite(numTarget)) {
                return 'warn';
            }
            
            // Toler√¢ncia padr√£o se ausente/inv√°lida
            let tol = Number(tolerance);
            if (!Number.isFinite(tol) || tol <= 0) {
                tol = 1;
            }
            
            const absDiff = Math.abs(numVal - numTarget);
            
            // Verde: dentro da toler√¢ncia
            if (absDiff <= tol + EPS) {
                return 'ok';
            }
            
            // Amarelo: fora um pouco (at√© 2x a toler√¢ncia)
            if (absDiff <= 2 * tol + EPS) {
                return 'yellow';
            }
            
            // Vermelho: fora muito
            return 'warn';
        }
        
        function runTests() {
            let totalTests = 0;
            let passedTests = 0;
            
            // Teste 1: Casos padr√£o
            const test1Cases = [
                { desc: 'Valor exato', val: -14, target: -14, tol: 1, expected: 'ok' },
                { desc: 'Dentro da toler√¢ncia', val: -14.5, target: -14, tol: 1, expected: 'ok' },
                { desc: 'No limite (tol + EPS)', val: -13.0, target: -14, tol: 1, expected: 'ok' },
                { desc: 'Fora um pouco', val: -12.5, target: -14, tol: 1, expected: 'yellow' },
                { desc: 'No limite 2x (2*tol + EPS)', val: -12.0, target: -14, tol: 1, expected: 'yellow' },
                { desc: 'Fora muito', val: -10, target: -14, tol: 1, expected: 'warn' }
            ];
            
            const table1 = document.getElementById('test1');
            table1.innerHTML = '<tr><th>Caso</th><th>Valor</th><th>Target</th><th>Tol</th><th>Esperado</th><th>Resultado</th><th>Status</th></tr>';
            
            test1Cases.forEach(tc => {
                const result = getColorClass(tc.val, tc.target, tc.tol);
                const pass = result === tc.expected;
                totalTests++;
                if (pass) passedTests++;
                
                table1.innerHTML += `
                    <tr>
                        <td>${tc.desc}</td>
                        <td>${tc.val}</td>
                        <td>${tc.target}</td>
                        <td>¬±${tc.tol}</td>
                        <td class="${tc.expected}">${tc.expected}</td>
                        <td class="${result}">${result}</td>
                        <td>${pass ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                `;
            });
            
            // Teste 2: Casos extremos
            const test2Cases = [
                { desc: 'Valor null', val: null, target: -14, tol: 1, expected: 'warn' },
                { desc: 'Valor NaN', val: NaN, target: -14, tol: 1, expected: 'warn' },
                { desc: 'Valor undefined', val: undefined, target: -14, tol: 1, expected: 'warn' },
                { desc: 'Target null', val: -14, target: null, tol: 1, expected: 'warn' },
                { desc: 'Target NaN', val: -14, target: NaN, tol: 1, expected: 'warn' },
                { desc: 'Toler√¢ncia null (usa 1)', val: -14.5, target: -14, tol: null, expected: 'ok' },
                { desc: 'Toler√¢ncia 0 (usa 1)', val: -14.5, target: -14, tol: 0, expected: 'ok' },
                { desc: 'Toler√¢ncia negativa (usa 1)', val: -14.5, target: -14, tol: -5, expected: 'ok' },
                { desc: 'Tudo inv√°lido', val: null, target: null, tol: null, expected: 'warn' }
            ];
            
            const table2 = document.getElementById('test2');
            table2.innerHTML = '<tr><th>Caso</th><th>Valor</th><th>Target</th><th>Tol</th><th>Esperado</th><th>Resultado</th><th>Status</th></tr>';
            
            test2Cases.forEach(tc => {
                const result = getColorClass(tc.val, tc.target, tc.tol);
                const pass = result === tc.expected;
                totalTests++;
                if (pass) passedTests++;
                
                table2.innerHTML += `
                    <tr>
                        <td>${tc.desc}</td>
                        <td>${tc.val ?? 'null'}</td>
                        <td>${tc.target ?? 'null'}</td>
                        <td>${tc.tol ?? 'null'}</td>
                        <td class="${tc.expected}">${tc.expected}</td>
                        <td class="${result}">${result}</td>
                        <td>${pass ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                `;
            });
            
            // Teste 3: Precis√£o epsilon
            const test3Cases = [
                { desc: 'Exatamente no limite (tol)', val: -14 + 1.0, target: -14, tol: 1, expected: 'ok' },
                { desc: 'Logo ap√≥s limite (tol + pequeno)', val: -14 + 1.0 + 0.0000001, target: -14, tol: 1, expected: 'ok' },
                { desc: 'Exatamente no limite 2x (2*tol)', val: -14 + 2.0, target: -14, tol: 1, expected: 'yellow' },
                { desc: 'Logo ap√≥s limite 2x (2*tol + pequeno)', val: -14 + 2.0 + 0.0000001, target: -14, tol: 1, expected: 'yellow' },
                { desc: 'Diferen√ßa microsc√≥pica (0.000001)', val: -14.000001, target: -14, tol: 1, expected: 'ok' }
            ];
            
            const table3 = document.getElementById('test3');
            table3.innerHTML = '<tr><th>Caso</th><th>Valor</th><th>Target</th><th>Tol</th><th>Esperado</th><th>Resultado</th><th>Status</th></tr>';
            
            test3Cases.forEach(tc => {
                const result = getColorClass(tc.val, tc.target, tc.tol);
                const pass = result === tc.expected;
                totalTests++;
                if (pass) passedTests++;
                
                table3.innerHTML += `
                    <tr>
                        <td>${tc.desc}</td>
                        <td>${tc.val.toFixed(7)}</td>
                        <td>${tc.target}</td>
                        <td>¬±${tc.tol}</td>
                        <td class="${tc.expected}">${tc.expected}</td>
                        <td class="${result}">${result}</td>
                        <td>${pass ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                `;
            });
            
            // Resultado final
            const resultDiv = document.getElementById('result');
            const allPassed = passedTests === totalTests;
            
            resultDiv.className = `result ${allPassed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `
                <div style="font-size: 18px; margin-bottom: 10px;">
                    ${allPassed ? '‚úÖ TODOS OS TESTES PASSARAM!' : '‚ùå ALGUNS TESTES FALHARAM'}
                </div>
                <div style="font-size: 14px; opacity: 0.9;">
                    ${passedTests} de ${totalTests} testes passaram
                </div>
            `;
            
            // Log no console
            console.log('=== RESULTADO DOS TESTES ===');
            console.log(`Total: ${totalTests}`);
            console.log(`Passou: ${passedTests}`);
            console.log(`Falhou: ${totalTests - passedTests}`);
            console.log(`Status: ${allPassed ? 'SUCESSO ‚úÖ' : 'FALHA ‚ùå'}`);
        }
        
        // Executar testes ao carregar
        window.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>

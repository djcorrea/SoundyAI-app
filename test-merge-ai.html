<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Merge AI - SoundyAI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #00ff88;
        }
        .log-output {
            background: #000;
            color: #00ff88;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            background: #00cc6a;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success { background: #004d1a; color: #00ff88; }
        .status.error { background: #4d0000; color: #ff6b6b; }
        .status.info { background: #003d4d; color: #4dabf7; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Merge AI - SoundyAI</h1>
    <p>Este teste verifica se a fun√ß√£o <code>mergeAISuggestionsWithOriginals</code> est√° funcionando corretamente.</p>

    <div class="test-section">
        <h2>üéØ Testes de Merge</h2>
        <button onclick="testMergeBasic()">Teste B√°sico</button>
        <button onclick="testMergeWithEnrichment()">Teste com Enriquecimento</button>
        <button onclick="testMergeWithNewSuggestions()">Teste com Novas Sugest√µes</button>
        <button onclick="testMergeEdgeCases()">Teste Casos Extremos</button>
        <button onclick="clearLog()">Limpar Log</button>
    </div>

    <div class="test-section">
        <h2>üìä Status dos Testes</h2>
        <div id="test-status"></div>
    </div>

    <div class="test-section">
        <h2>üìù Log de Execu√ß√£o</h2>
        <div id="log-output" class="log-output"></div>
    </div>

    <!-- Scripts necess√°rios -->
    <script src="public/ai-suggestions-integration.js"></script>

    <script>
        // Vari√°vel global para o log
        let testLog = '';

        // Fun√ß√£o para adicionar ao log
        function addToLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            testLog += logMessage;
            document.getElementById('log-output').textContent = testLog;
            
            // Auto-scroll para o final
            const logElement = document.getElementById('log-output');
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Fun√ß√£o para limpar o log
        function clearLog() {
            testLog = '';
            document.getElementById('log-output').textContent = '';
        }

        // Fun√ß√£o para mostrar status
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Override do console.log para capturar logs da integra√ß√£o
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            // Captura logs que come√ßam com [AI-MERGE]
            const message = args.join(' ');
            if (message.includes('[AI-MERGE]')) {
                addToLog(message);
            }
            originalConsoleLog.apply(console, args);
        };

        // Dados de teste
        const mockOriginalSuggestions = [
            {
                id: 1,
                title: "Ajustar Loudness",
                description: "Loudness est√° muito baixo",
                category: "loudness",
                type: "adjustment",
                metric: "loudness",
                priority: "high",
                score: 8.5
            },
            {
                id: 2,
                title: "Controlar True Peak",
                description: "True peak muito alto",
                category: "dynamics",
                type: "limiting",
                metric: "truePeak",
                priority: "medium",
                score: 7.2
            },
            {
                id: 3,
                title: "Melhorar Dynamic Range",
                description: "Dynamic range pode ser otimizado",
                category: "dynamics",
                type: "compression",
                metric: "dynamicRange",
                priority: "low",
                score: 6.8
            }
        ];

        const mockAIResponse = {
            suggestions: [
                {
                    title: "Ajustar Loudness",
                    description: "Aumente o loudness usando compress√£o multibanda",
                    solution: "Use um compressor multibanda com ratio 3:1",
                    priority: "high",
                    rationale: "Loudness inadequado pode causar problemas de compatibilidade",
                    techniques: ["Compress√£o Multibanda", "Limitador de Sa√≠da"]
                },
                {
                    title: "Nova Sugest√£o da IA",
                    description: "Sugest√£o adicional gerada pela IA",
                    category: "ai-enhancement",
                    priority: "medium",
                    solution: "Aplicar EQ criativo nas frequ√™ncias m√©dias"
                }
            ]
        };

        // Teste b√°sico
        function testMergeBasic() {
            addToLog('üß™ INICIANDO TESTE B√ÅSICO', 'info');
            
            try {
                // Criar inst√¢ncia da integra√ß√£o
                const integration = new AISuggestionIntegration();
                
                // Testar merge b√°sico
                const result = integration.mergeAISuggestionsWithOriginals(
                    mockOriginalSuggestions,
                    mockAIResponse
                );
                
                addToLog(`‚úÖ Resultado: ${result.length} sugest√µes finais`);
                addToLog(`üìä Originais: ${mockOriginalSuggestions.length}, IA: ${mockAIResponse.suggestions.length}`);
                
                // Verificar se preservou todas as originais
                const enrichedCount = result.filter(s => s.aiEnhanced).length;
                const newAICount = result.filter(s => s.isAIGenerated).length;
                
                addToLog(`üéØ Enriquecidas: ${enrichedCount}, Novas da IA: ${newAICount}`);
                
                if (result.length >= mockOriginalSuggestions.length) {
                    showStatus('‚úÖ Teste B√°sico: PASSOU - Todas sugest√µes preservadas', 'success');
                } else {
                    showStatus('‚ùå Teste B√°sico: FALHOU - Sugest√µes perdidas', 'error');
                }
                
            } catch (error) {
                addToLog(`‚ùå ERRO no teste b√°sico: ${error.message}`, 'error');
                showStatus(`‚ùå Teste B√°sico: ERRO - ${error.message}`, 'error');
            }
        }

        // Teste com enriquecimento
        function testMergeWithEnrichment() {
            addToLog('üß™ INICIANDO TESTE DE ENRIQUECIMENTO', 'info');
            
            try {
                const integration = new AISuggestionIntegration();
                
                const result = integration.mergeAISuggestionsWithOriginals(
                    mockOriginalSuggestions,
                    mockAIResponse
                );
                
                // Verificar se a primeira sugest√£o foi enriquecida
                const enrichedSuggestion = result.find(s => s.title === "Ajustar Loudness");
                
                if (enrichedSuggestion && enrichedSuggestion.aiEnhanced) {
                    addToLog('‚úÖ Sugest√£o enriquecida encontrada:');
                    addToLog(`   - T√≠tulo original: ${enrichedSuggestion.title}`);
                    addToLog(`   - Solu√ß√£o IA: ${enrichedSuggestion.aiSolution || 'N/A'}`);
                    addToLog(`   - Rationale IA: ${enrichedSuggestion.aiRationale || 'N/A'}`);
                    showStatus('‚úÖ Teste Enriquecimento: PASSOU - Dados IA adicionados', 'success');
                } else {
                    addToLog('‚ùå Sugest√£o n√£o foi enriquecida como esperado');
                    showStatus('‚ùå Teste Enriquecimento: FALHOU - Dados IA n√£o adicionados', 'error');
                }
                
            } catch (error) {
                addToLog(`‚ùå ERRO no teste de enriquecimento: ${error.message}`, 'error');
                showStatus(`‚ùå Teste Enriquecimento: ERRO - ${error.message}`, 'error');
            }
        }

        // Teste com novas sugest√µes
        function testMergeWithNewSuggestions() {
            addToLog('üß™ INICIANDO TESTE DE NOVAS SUGEST√ïES', 'info');
            
            try {
                const integration = new AISuggestionIntegration();
                
                const result = integration.mergeAISuggestionsWithOriginals(
                    mockOriginalSuggestions,
                    mockAIResponse
                );
                
                // Verificar se nova sugest√£o da IA foi adicionada
                const newAISuggestion = result.find(s => s.isAIGenerated);
                
                if (newAISuggestion) {
                    addToLog('‚úÖ Nova sugest√£o da IA encontrada:');
                    addToLog(`   - T√≠tulo: ${newAISuggestion.title}`);
                    addToLog(`   - Categoria: ${newAISuggestion.category}`);
                    addToLog(`   - Gerada pela IA: ${newAISuggestion.isAIGenerated}`);
                    showStatus('‚úÖ Teste Novas Sugest√µes: PASSOU - Sugest√£o IA adicionada', 'success');
                } else {
                    addToLog('‚ùå Nova sugest√£o da IA n√£o foi adicionada');
                    showStatus('‚ùå Teste Novas Sugest√µes: FALHOU - Sugest√£o IA n√£o adicionada', 'error');
                }
                
            } catch (error) {
                addToLog(`‚ùå ERRO no teste de novas sugest√µes: ${error.message}`, 'error');
                showStatus(`‚ùå Teste Novas Sugest√µes: ERRO - ${error.message}`, 'error');
            }
        }

        // Teste casos extremos
        function testMergeEdgeCases() {
            addToLog('üß™ INICIANDO TESTE DE CASOS EXTREMOS', 'info');
            
            try {
                const integration = new AISuggestionIntegration();
                
                // Teste 1: Sem resposta IA
                let result1 = integration.mergeAISuggestionsWithOriginals(mockOriginalSuggestions, null);
                addToLog(`üìä Teste sem IA: ${result1.length} sugest√µes (esperado: ${mockOriginalSuggestions.length})`);
                
                // Teste 2: Sem sugest√µes originais
                let result2 = integration.mergeAISuggestionsWithOriginals([], mockAIResponse);
                addToLog(`üìä Teste sem originais: ${result2.length} sugest√µes (esperado: 0)`);
                
                // Teste 3: Ambos vazios
                let result3 = integration.mergeAISuggestionsWithOriginals([], null);
                addToLog(`üìä Teste ambos vazios: ${result3.length} sugest√µes (esperado: 0)`);
                
                if (result1.length === mockOriginalSuggestions.length && 
                    result2.length === 0 && 
                    result3.length === 0) {
                    showStatus('‚úÖ Teste Casos Extremos: PASSOU - Todos cen√°rios funcionando', 'success');
                } else {
                    showStatus('‚ùå Teste Casos Extremos: FALHOU - Alguns cen√°rios com problemas', 'error');
                }
                
            } catch (error) {
                addToLog(`‚ùå ERRO no teste de casos extremos: ${error.message}`, 'error');
                showStatus(`‚ùå Teste Casos Extremos: ERRO - ${error.message}`, 'error');
            }
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('üöÄ Sistema de testes carregado. Clique nos bot√µes para executar os testes.', 'info');
            addToLog('üöÄ Sistema de testes de merge AI inicializado');
            addToLog('üìã Dados de teste preparados:');
            addToLog(`   - ${mockOriginalSuggestions.length} sugest√µes originais`);
            addToLog(`   - ${mockAIResponse.suggestions.length} sugest√µes da IA no mock`);
        });
    </script>
</body>
</html>
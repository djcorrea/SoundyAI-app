<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Score Adaptativo - SoundyAI</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .test-result {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            font-family: monospace;
        }
        .test-error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            color: #ff6b6b;
        }
        .test-info {
            background: rgba(25, 118, 210, 0.1);
            border: 1px solid rgba(25, 118, 210, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            color: #90caf9;
        }
        button {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
        }
        .score-display {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Teste Score Adaptativo - SoundyAI</h1>
        
        <div class="test-section">
            <h2>üìä Status do Sistema</h2>
            <div id="status-display"></div>
            <button onclick="checkSystemStatus()">Verificar Status</button>
        </div>

        <div class="test-section">
            <h2>üîÑ Teste de Cen√°rios</h2>
            <div class="test-info">
                <strong>Cen√°rios de Teste:</strong><br>
                ‚Ä¢ Primeira an√°lise: Score = 50<br>
                ‚Ä¢ Aplica√ß√£o correta de sugest√µes: Score = 70-90<br>
                ‚Ä¢ Aplica√ß√£o perfeita: Score = 100<br>
                ‚Ä¢ Aplica√ß√£o excessiva (overshoot): Score com penalidade<br>
                ‚Ä¢ Aplica√ß√£o incorreta: Score = 30<br>
            </div>
            
            <button onclick="testScenario('first_analysis')">Testar Primeira An√°lise</button>
            <button onclick="testScenario('perfect_application')">Testar Aplica√ß√£o Perfeita</button>
            <button onclick="testScenario('overshoot')">Testar Overshoot</button>
            <button onclick="testScenario('wrong_direction')">Testar Dire√ß√£o Errada</button>
            
            <div id="scenario-results"></div>
        </div>

        <div class="test-section">
            <h2>üéõÔ∏è Simulador de Tickets</h2>
            <button onclick="createMockTickets()">Criar Tickets de Teste</button>
            <button onclick="simulateUserApplication()">Simular Aplica√ß√£o do Usu√°rio</button>
            <button onclick="calculateScore()">Calcular Score</button>
            
            <div id="ticket-display"></div>
            <div class="score-display" id="score-result"></div>
        </div>

        <div class="test-section">
            <h2>üíæ Teste de Persist√™ncia</h2>
            <button onclick="testTicketSaving()">Testar Salvamento de Tickets</button>
            <button onclick="testTicketLoading()">Testar Carregamento de Tickets</button>
            <button onclick="clearAllTickets()">Limpar Todos os Tickets</button>
            
            <div id="persistence-results"></div>
        </div>
    </div>

    <!-- Importar m√≥dulo do Score Adaptativo -->
    <script type="module">
        import * as AdaptiveScore from './work/core/adaptive-score.js';
        window.AdaptiveScore = AdaptiveScore;
        
        // Status do sistema
        window.checkSystemStatus = function() {
            const statusDiv = document.getElementById('status-display');
            try {
                if (window.AdaptiveScore) {
                    statusDiv.innerHTML = `
                        <div class="test-result">
                            ‚úÖ M√≥dulo adaptive-score.js carregado com sucesso<br>
                            üìã Fun√ß√µes dispon√≠veis: ${Object.keys(window.AdaptiveScore).join(', ')}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `<div class="test-error">‚ùå M√≥dulo adaptive-score.js n√£o foi carregado</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="test-error">‚ùå Erro ao verificar status: ${error.message}</div>`;
            }
        };

        // Teste de cen√°rios
        window.testScenario = function(scenario) {
            const resultsDiv = document.getElementById('scenario-results');
            
            try {
                let mockTickets, userAnalysis, score;
                
                switch(scenario) {
                    case 'first_analysis':
                        score = window.AdaptiveScore.calculateAdaptiveScoreFromTickets({ items: [], createdAt: Date.now() });
                        resultsDiv.innerHTML += `
                            <div class="test-result">
                                üéØ Primeira An√°lise: Score = ${score.score} (Esperado: 50)
                                ${score.score === 50 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                            </div>
                        `;
                        break;
                        
                    case 'perfect_application':
                        mockTickets = createPerfectApplicationTickets();
                        score = window.AdaptiveScore.calculateAdaptiveScoreFromTickets(mockTickets);
                        resultsDiv.innerHTML += `
                            <div class="test-result">
                                üéØ Aplica√ß√£o Perfeita: Score = ${score.score} (Esperado: ~100)
                                ${score.score >= 95 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                            </div>
                        `;
                        break;
                        
                    case 'overshoot':
                        mockTickets = createOvershootTickets();
                        score = window.AdaptiveScore.calculateAdaptiveScoreFromTickets(mockTickets);
                        resultsDiv.innerHTML += `
                            <div class="test-result">
                                üéØ Overshoot: Score = ${score.score} (Esperado: <70 com penalidade)
                                ${score.score < 70 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                            </div>
                        `;
                        break;
                        
                    case 'wrong_direction':
                        mockTickets = createWrongDirectionTickets();
                        score = window.AdaptiveScore.calculateAdaptiveScoreFromTickets(mockTickets);
                        resultsDiv.innerHTML += `
                            <div class="test-result">
                                üéØ Dire√ß√£o Errada: Score = ${score.score} (Esperado: ~30)
                                ${score.score <= 35 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                            </div>
                        `;
                        break;
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div class="test-error">‚ùå Erro no cen√°rio ${scenario}: ${error.message}</div>`;
            }
        };

        // Criar tickets de teste
        function createPerfectApplicationTickets() {
            return {
                items: [
                    {
                        id: 'bass_adjust_test',
                        type: 'bass_adjust',
                        suggested: { delta: 2.0, unit: 'dB' },
                        applied: { delta: 2.0, unit: 'dB' },
                        createdAt: Date.now() - 60000
                    },
                    {
                        id: 'mid_adjust_test',
                        type: 'mid_adjust',
                        suggested: { delta: -1.5, unit: 'dB' },
                        applied: { delta: -1.5, unit: 'dB' },
                        createdAt: Date.now() - 60000
                    }
                ],
                createdAt: Date.now() - 60000
            };
        }

        function createOvershootTickets() {
            return {
                items: [
                    {
                        id: 'bass_overshoot_test',
                        type: 'bass_adjust',
                        suggested: { delta: 2.0, unit: 'dB' },
                        applied: { delta: 5.0, unit: 'dB' }, // Overshoot
                        createdAt: Date.now() - 60000
                    }
                ],
                createdAt: Date.now() - 60000
            };
        }

        function createWrongDirectionTickets() {
            return {
                items: [
                    {
                        id: 'bass_wrong_test',
                        type: 'bass_adjust',
                        suggested: { delta: 2.0, unit: 'dB' },
                        applied: { delta: -2.0, unit: 'dB' }, // Dire√ß√£o errada
                        createdAt: Date.now() - 60000
                    }
                ],
                createdAt: Date.now() - 60000
            };
        }

        // Simulador de tickets
        window.createMockTickets = function() {
            const tickets = {
                items: [
                    {
                        id: 'bass_test_1',
                        type: 'bass_adjust',
                        suggested: { delta: 2.5, unit: 'dB' },
                        applied: null,
                        createdAt: Date.now()
                    },
                    {
                        id: 'mid_test_1',
                        type: 'mid_adjust',
                        suggested: { delta: -1.0, unit: 'dB' },
                        applied: null,
                        createdAt: Date.now()
                    }
                ],
                createdAt: Date.now()
            };
            
            localStorage.setItem('soundyai_suggestion_tickets', JSON.stringify(tickets));
            document.getElementById('ticket-display').innerHTML = `
                <div class="test-result">
                    ‚úÖ Tickets criados: ${tickets.items.length} sugest√µes salvas
                </div>
            `;
        };

        window.simulateUserApplication = function() {
            const ticketsJson = localStorage.getItem('soundyai_suggestion_tickets');
            if (!ticketsJson) {
                document.getElementById('ticket-display').innerHTML = `
                    <div class="test-error">‚ùå Nenhum ticket encontrado. Crie tickets primeiro.</div>
                `;
                return;
            }
            
            const tickets = JSON.parse(ticketsJson);
            tickets.items.forEach(ticket => {
                if (ticket.type === 'bass_adjust') {
                    ticket.applied = { delta: 2.0, unit: 'dB' }; // Aplica√ß√£o pr√≥xima
                } else if (ticket.type === 'mid_adjust') {
                    ticket.applied = { delta: -0.8, unit: 'dB' }; // Aplica√ß√£o pr√≥xima
                }
            });
            
            localStorage.setItem('soundyai_suggestion_tickets', JSON.stringify(tickets));
            document.getElementById('ticket-display').innerHTML = `
                <div class="test-result">
                    ‚úÖ Aplica√ß√£o simulada nos ${tickets.items.length} tickets
                </div>
            `;
        };

        window.calculateScore = function() {
            const ticketsJson = localStorage.getItem('soundyai_suggestion_tickets');
            if (!ticketsJson) {
                document.getElementById('score-result').innerHTML = 'Nenhum ticket encontrado';
                return;
            }
            
            try {
                const tickets = JSON.parse(ticketsJson);
                const score = window.AdaptiveScore.calculateAdaptiveScoreFromTickets(tickets);
                document.getElementById('score-result').innerHTML = `Score: ${score.score}`;
                
                document.getElementById('ticket-display').innerHTML += `
                    <div class="test-result">
                        üìä Score calculado: ${score.score}<br>
                        üîÑ M√©todo: ${score.method}<br>
                        üìà Breakdown: ${JSON.stringify(score.breakdown, null, 2)}
                    </div>
                `;
            } catch (error) {
                document.getElementById('score-result').innerHTML = `Erro: ${error.message}`;
            }
        };

        // Testes de persist√™ncia
        window.testTicketSaving = function() {
            const testTickets = {
                items: [
                    { id: 'test_1', type: 'bass_adjust', suggested: { delta: 1.0, unit: 'dB' }, applied: null, createdAt: Date.now() }
                ],
                createdAt: Date.now()
            };
            
            try {
                localStorage.setItem('soundyai_suggestion_tickets', JSON.stringify(testTickets));
                const retrieved = JSON.parse(localStorage.getItem('soundyai_suggestion_tickets'));
                
                document.getElementById('persistence-results').innerHTML = `
                    <div class="test-result">
                        ‚úÖ Teste de salvamento: ${retrieved.items.length} ticket(s) salvos e recuperados
                    </div>
                `;
            } catch (error) {
                document.getElementById('persistence-results').innerHTML = `
                    <div class="test-error">‚ùå Erro no teste de salvamento: ${error.message}</div>
                `;
            }
        };

        window.testTicketLoading = function() {
            try {
                const tickets = localStorage.getItem('soundyai_suggestion_tickets');
                if (tickets) {
                    const parsed = JSON.parse(tickets);
                    document.getElementById('persistence-results').innerHTML += `
                        <div class="test-result">
                            ‚úÖ Teste de carregamento: ${parsed.items.length} ticket(s) carregados
                        </div>
                    `;
                } else {
                    document.getElementById('persistence-results').innerHTML += `
                        <div class="test-info">‚ÑπÔ∏è Nenhum ticket encontrado no localStorage</div>
                    `;
                }
            } catch (error) {
                document.getElementById('persistence-results').innerHTML += `
                    <div class="test-error">‚ùå Erro no teste de carregamento: ${error.message}</div>
                `;
            }
        };

        window.clearAllTickets = function() {
            localStorage.removeItem('soundyai_suggestion_tickets');
            document.getElementById('persistence-results').innerHTML += `
                <div class="test-result">‚úÖ Todos os tickets foram limpos do localStorage</div>
            `;
        };

        // Verificar status automaticamente ao carregar
        setTimeout(() => {
            checkSystemStatus();
        }, 500);
        
    </script>
</body>
</html>
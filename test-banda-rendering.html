<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>ğŸ§ª Teste: RenderizaÃ§Ã£o de Bandas no Modo Reduced</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: #fff; }
        .test-result { padding: 15px; margin: 10px 0; border-radius: 8px; }
        .pass { background: #2d5016; border: 2px solid #4caf50; }
        .fail { background: #5c1a1a; border: 2px solid #f44336; }
        pre { background: #2a2a2a; padding: 10px; border-radius: 4px; overflow-x: auto; }
        code { color: #4fc3f7; }
        .metric-key { color: #ffeb3b; font-weight: bold; }
        .status { font-size: 24px; margin-right: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Teste: Bandas no Modo Reduced</h1>
    <p>Validando se bandas sÃ£o renderizadas sem o prefixo <code>band_</code></p>
    
    <div id="results"></div>

    <script src="reduced-mode-security-guard.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');
        
        // Simular anÃ¡lise no modo reduced
        const mockAnalysis = {
            isReduced: true,
            analysisMode: 'reduced'
        };
        
        // Testes
        const tests = [
            {
                name: 'DR (DinÃ¢mica)',
                key: 'dr',
                expected: true,
                description: 'MÃ©trica principal - deve ser renderizada'
            },
            {
                name: 'Stereo (Imagem EstÃ©reo)',
                key: 'stereo',
                expected: true,
                description: 'Sempre liberado'
            },
            {
                name: 'Low Mid (banda)',
                key: 'lowMid',
                expected: true,
                description: 'Banda de frequÃªncia liberada - SEM prefixo band_'
            },
            {
                name: 'High Mid (banda)',
                key: 'highMid',
                expected: true,
                description: 'Banda de frequÃªncia liberada - SEM prefixo band_'
            },
            {
                name: 'Presence (banda)',
                key: 'presence',
                expected: true,
                description: 'Banda de frequÃªncia liberada - SEM prefixo band_'
            },
            {
                name: 'Low Mid com prefixo ERRADO',
                key: 'band_lowMid',
                expected: true,
                description: 'Allowlist tambÃ©m aceita com prefixo (retrocompatibilidade)'
            },
            {
                name: 'LUFS (bloqueado)',
                key: 'lufs',
                expected: false,
                description: 'MÃ©trica bloqueada no modo reduced'
            },
            {
                name: 'True Peak (bloqueado)',
                key: 'truePeak',
                expected: false,
                description: 'MÃ©trica bloqueada no modo reduced'
            }
        ];
        
        // Executar testes
        tests.forEach(test => {
            const result = shouldRenderRealValue(test.key, 'table', mockAnalysis);
            const passed = result === test.expected;
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `
                <span class="status">${passed ? 'âœ…' : 'âŒ'}</span>
                <strong>${test.name}</strong><br>
                <span class="metric-key">Key:</span> <code>${test.key}</code><br>
                <strong>Esperado:</strong> ${test.expected ? 'Renderizar' : 'Bloquear'}<br>
                <strong>Resultado:</strong> ${result ? 'Renderizar' : 'Bloquear'}<br>
                <em>${test.description}</em>
            `;
            resultsDiv.appendChild(resultDiv);
        });
        
        // Resumo
        const passedTests = tests.filter(t => 
            shouldRenderRealValue(t.key, 'table', mockAnalysis) === t.expected
        ).length;
        
        const summaryDiv = document.createElement('div');
        summaryDiv.className = `test-result ${passedTests === tests.length ? 'pass' : 'fail'}`;
        summaryDiv.innerHTML = `
            <h2>ğŸ“Š Resumo</h2>
            <strong>Testes Passou:</strong> ${passedTests} / ${tests.length}<br>
            ${passedTests === tests.length 
                ? 'ğŸ‰ <strong>TODOS OS TESTES PASSARAM!</strong>' 
                : 'âš ï¸ Alguns testes falharam'
            }
        `;
        resultsDiv.appendChild(summaryDiv);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® Teste Priority Banner</title>
    <style>
        body {
            background: #0f172a;
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            margin: 0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(51, 65, 85, 0.3);
        }
        .test-title {
            color: #3b82f6;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .test-log {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(100,116,139,0.2);
        }
    </style>
    <link rel="stylesheet" href="public/ai-suggestion-styles.css">
</head>
<body>
    <div class="test-container">
        <h1>üö® Teste Priority Banner Implementation</h1>
        <p>Valida√ß√£o da corre√ß√£o para exibir <strong>priorityWarning</strong> com banner destacado</p>

        <div class="test-section">
            <div class="test-title">üìã Teste 1: Sugest√£o com priorityWarning</div>
            <div id="test-priority-suggestion"></div>
        </div>

        <div class="test-section">
            <div class="test-title">‚öôÔ∏è Teste 2: Sugest√£o sem priorityWarning</div>
            <div id="test-normal-suggestion"></div>
        </div>

        <div class="test-section">
            <div class="test-title">‚ö° Teste 3: True Peak com priorityWarning</div>
            <div id="test-truepeak-suggestion"></div>
        </div>

        <div class="test-section">
            <div class="test-title">üìä Log de Teste</div>
            <div id="test-log" class="test-log"></div>
        </div>
    </div>

    <script>
        // Mock do sistema
        window.refs = { audioAnalyzer: { isReady: true } };
        
        // Log de teste
        function logTest(message) {
            const log = document.getElementById('test-log');
            log.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}<br>`;
            log.scrollTop = log.scrollHeight;
        }

        // Sugest√µes de teste
        const prioritySuggestion = {
            message: "An√°lise detectou problemas cr√≠ticos de masteriza√ß√£o",
            priorityWarning: "‚ö° Corre√ß√£o Priorit√°ria: True Peak excede -1.0 dBFS",
            why: "O √°udio apresenta picos digitais que causar√£o distor√ß√£o",
            action: "Aplicar limitador imediatamente",
            priority: "Alta",
            confidence: 0.98,
            suggestion_id: "priority_001"
        };

        const normalSuggestion = {
            message: "Pequeno ajuste recomendado nas m√©dias frequ√™ncias",
            action: "Aplicar EQ suave na regi√£o de 2-4kHz",
            priority: "Baixa",
            confidence: 0.75,
            suggestion_id: "normal_001"
        };

        const truePeakSuggestion = {
            message: "‚ö° True Peak requer corre√ß√£o PRIORIT√ÅRIA",
            priorityWarning: "URGENTE: True Peak detectado em +2.1 dBFS - Risco de clipping digital",
            why: "An√°lise ITU-R BS.1770-4 detectou picos acima do limite",
            context: "Oversampling 4x confirmou excesso em conversores D/A",
            action: "Reduzir gain geral ou aplicar limiting transparente",
            plugin: "FabFilter Pro-L 2 (transparent mode)",
            priority: "Cr√≠tica",
            confidence: 0.99,
            truePeakValue: 2.1,
            suggestion_id: "truepeak_critical_001"
        };

        logTest("Iniciando testes do Priority Banner...");
    </script>
    <script src="public/ai-suggestions-integration.js"></script>
    <script>
        // Executar testes
        setTimeout(() => {
            try {
                logTest("üß™ Teste 1: Renderizando sugest√£o COM priorityWarning");
                const priorityCard = AISuggestionsIntegration.createSuggestionCard(prioritySuggestion, 1);
                document.getElementById('test-priority-suggestion').appendChild(priorityCard);
                
                const hasPriorityBanner1 = priorityCard.querySelector('.priority-banner');
                logTest(hasPriorityBanner1 ? "‚úÖ Priority banner encontrado no teste 1" : "‚ùå Priority banner N√ÉO encontrado no teste 1");

                logTest("üß™ Teste 2: Renderizando sugest√£o SEM priorityWarning");
                const normalCard = AISuggestionsIntegration.createSuggestionCard(normalSuggestion, 2);
                document.getElementById('test-normal-suggestion').appendChild(normalCard);
                
                const hasPriorityBanner2 = normalCard.querySelector('.priority-banner');
                logTest(hasPriorityBanner2 ? "‚ö†Ô∏è Priority banner encontrado no teste 2 (n√£o deveria)" : "‚úÖ Priority banner N√ÉO encontrado no teste 2 (correto)");

                logTest("üß™ Teste 3: Renderizando True Peak COM priorityWarning");
                const truePeakCard = AISuggestionsIntegration.createSuggestionCard(truePeakSuggestion, 3);
                document.getElementById('test-truepeak-suggestion').appendChild(truePeakCard);
                
                const hasPriorityBanner3 = truePeakCard.querySelector('.priority-banner');
                logTest(hasPriorityBanner3 ? "‚úÖ Priority banner encontrado no teste 3" : "‚ùå Priority banner N√ÉO encontrado no teste 3");

                // Aguardar e verificar renderiza√ß√£o
                setTimeout(() => {
                    const totalBanners = document.querySelectorAll('.priority-banner').length;
                    logTest(`üìä Total de banners renderizados: ${totalBanners}`);
                    
                    document.querySelectorAll('.priority-banner').forEach((banner, idx) => {
                        logTest(`üö® Banner ${idx + 1}: ${banner.textContent.trim()}`);
                    });

                    if (totalBanners >= 2) {
                        logTest("üéâ TESTE APROVADO - Priority banners funcionando!");
                    } else {
                        logTest("‚ùå TESTE REPROVADO - Priority banners n√£o funcionando adequadamente");
                    }
                }, 1000);

            } catch (error) {
                logTest(`‚ùå Erro nos testes: ${error.message}`);
                console.error('Erro detalhado:', error);
            }
        }, 500);
    </script>
</body>
</html>